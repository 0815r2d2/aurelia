(function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.t?define(["exports"],t):t((n=n||self).kernel={})})(this,function(n){"use strict";function t(n){return function(t){const Key=function Key(n,t,e){DI.inject(Key)(n,t,e)};return Key.resolve=function(e,r){return n(t,e,r)},Key}}function e(n){return DI.transient(n)}function r(n){return DI.singleton(n)}function i(n){return"function"==typeof n.register}function o(n){if(null==n||n===Object)throw Reporter.error(5)}function s(n,t,e){if(n instanceof y&&4===n.strategy){const r=n.state;let i=r.length;const o=Array(i);for(;i--;)o[i]=r[i].resolve(t,e);return o}return[n.resolve(t,e)]}function u(n,t,e,r){let i,o=e.length,s=Array(o);for(;o--;){if(null==(i=e[o]))throw Reporter.error(7,`Index ${o}.`);s[o]=n.get(i)}return void 0!==r&&(s=s.concat(r)),Reflect.construct(t,s)}const l=(function(){if("undefined"!=typeof global)return global;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;try{return Function("","return this")()}catch(n){return{}}})(),c=(function(){let n,t,e,r,i;if(null!=l.performance&&l.performance.now){const n=l.performance;return function(){return n.now()}}if(null!=l.process&&l.process.i){const o=function(){return(n()-r)/1e6};return t=l.process.i,e=(n=function(){let n;return 1e9*(n=t())[0]+n[1]})(),i=1e9*l.process.o(),r=e-i,o}})(),{s:f,u:a,l:h,h:m,m:v,v:w}=(function(){if(null!=l.performance&&l.performance.mark&&l.performance.measure&&l.performance.getEntriesByName&&l.performance.getEntriesByType&&l.performance.clearMarks&&l.performance.clearMeasures){const n=l.performance;return{s(name){n.mark(name)},u(name,t,e){n.measure(name,t,e)},l:name=>n.getEntriesByName(name),h:type=>n.getEntriesByType(type),m(name){n.clearMarks(name)},v(name){n.clearMeasures(name)}}}if(null!=l.process&&l.process.i){const n=[],t={},e=function(t,value){let e=0;const r=n.length,i=[];for(;r>e;e++)n[e][t]===value&&i.push(n[e]);return i},r=function(type,name){let t,e=n.length;for(;e--;)(t=n[e]).entryType!==type||void 0!==name&&t.name!==name||n.splice(e,1)};return{s(name){const e={name,entryType:"mark",startTime:c(),duration:0};n.push(e),t[name]=e},u(name,e,r){let i,o;if(void 0!==r&&void 0===t[r])throw new SyntaxError(`Failed to execute 'measure' on 'Performance': The mark '${r}' does not exist.`);if(void 0!==e&&void 0===t[e])throw new SyntaxError(`Failed to execute 'measure' on 'Performance': The mark '${e}' does not exist.`);i=t[e]?t[e].startTime:0,o=t[r]?t[r].startTime:c(),n.push({name,entryType:"measure",startTime:i,duration:o-i})},l:name=>e("name",name),h:type=>e("entryType",type),m(name){r("mark",name)},v(name){r("measure",name)}}}})(),d=(function(){const n=["moz","webkit"],t="AnimationFrame";let e=l[`request${t}`],r=l[`cancel${t}`]||l[`cancelRequest${t}`];for(let i=0;!e&&2>i;++i)e=l[`${n[i]}Request${t}`],r=l[`${n[i]}Cancel${t}`]||l[`${n[i]}CancelRequest${t}`];if(!e||!r){let n=0,t=0;const i=[],o=1e3/60;e=function(e){let r,s;return 0===i.length&&(r=c(),n=(s=Math.max(0,o-(r-n)))+r,setTimeout(function(){const t=i.slice(0);i.length=0;for(let e=0;t.length>e;++e)if(!t[e].k)try{t[e].$(n)}catch(n){setTimeout(function(){throw n},0)}},Math.round(s))),i.push({M:++t,$:e,k:0}),t},r=function(n){for(let t=0;i.length>t;++t)i[t].M===n&&(i[t].k=1)}}const i=function(n){return e.call(l,n)};return i.cancel=function(){r.apply(l,arguments)},l.requestAnimationFrame=e,l.cancelAnimationFrame=r,i})(),k={},$={},PLATFORM={global:l,R:Object.freeze([]),C:Object.freeze({}),A(){},now:c,mark:f,measure:a,getEntriesByName:h,getEntriesByType:m,clearMarks:v,clearMeasures:w,O(n){let value=k[n];if(void 0!==value)return value;value="";let t,e=1,r=0;for(let i=0,o=n.length;o>i;++i)"-"===(t=n.charAt(i))||"."===t||"_"===t?r=1:(value+=e?t.toLowerCase():r?t.toUpperCase():t,r=0),e=0;return k[n]=value},p(n){let value=$[n];if(void 0!==value)return value;value="";let t,e,r=1;for(let i=0,o=n.length;o>i;++i)e=(t=n.charAt(i)).toLowerCase(),value+=r?e:t!==e?`-${e}`:e,r=0;return $[n]=value},toArray(n){const t=n.length,e=Array(t);for(let r=0;t>r;++r)e[r]=n[r];return e},requestAnimationFrame:n=>d(n),clearInterval(n){l.clearInterval(n)},clearTimeout(n){l.clearTimeout(n)},setInterval:(n,t,...e)=>l.setInterval(n,t,...e),setTimeout:(n,t,...e)=>l.setTimeout(n,t,...e)},Reporter={write(n,...t){},error:n=>Error(`Code ${n}`)},Tracer={enabled:0,B:0,W:null,L(name,n){},T(){},q(n){},F(n){},D(n){},N(){}};"getOwnMetadata"in Reflect||(Reflect.j=function(n,t){return t[n]},Reflect.S=function(n,t){return function(e){e[n]=t}});const DI={_(...n){return 0===arguments.length?new R:(new R).register(...n)},g:n=>Reflect.j("design:paramtypes",n)||PLATFORM.R,G(n){let dependencies;if(void 0===n.inject)dependencies=DI.g(n);else{dependencies=[];let t=n;for(;"function"==typeof t;)t.hasOwnProperty("inject")&&dependencies.push(...t.inject),t=Object.getPrototypeOf(t)}return dependencies},H(n){const Key=function(t,e,r){if(Key.I=n||"Interface",void 0===t)throw Reporter.error(16,Key.I,Key);return(t.inject||(t.inject=[]))[r]=Key,t};return Key.J=function(){return Key},Key.K=function(n){return Key.K=function(){throw Reporter.error(17,Key)},Key.register=function(t,e){const r=e||Key;return n({U:value=>t.V(r,new y(r,0,value)),singleton:value=>t.V(r,new y(r,1,value)),transient:value=>t.V(r,new y(r,2,value)),$:value=>t.V(r,new y(r,3,value)),X:n=>t.V(r,new y(r,5,n))})},Key},Key},inject:(...dependencies)=>(function(n,t,e){if("number"==typeof e){if(!n.hasOwnProperty("inject")){const t=DI.g(n);n.inject=t.slice()}1===dependencies.length&&(n.inject[e]=dependencies[0])}else if(t){const e=n.constructor;(e.inject||(e.inject={}))[t]=dependencies[0]}else if(e)e.value.inject=dependencies;else if(0===dependencies.length){const t=DI.g(n);n.inject=t.slice()}else n.inject=dependencies}),transient:n=>(n.register=function(t){return Registration.transient(n,n).register(t,n)},n),singleton:n=>(n.register=function(t){return Registration.singleton(n,n).register(t,n)},n)},IContainer=DI.H("IContainer").J(),IServiceLocator=IContainer,inject=DI.inject,all=t((n,t,e)=>e.getAll(n)),lazy=t((n,t,e)=>{let r=null;return()=>(null===r&&(r=e.get(n)),r)}),optional=t((n,t,e)=>e.has(n,1)?e.get(n):null);var b;(function(n){n[n.U=0]="instance",n[n.singleton=1]="singleton",n[n.transient=2]="transient",n[n.$=3]="callback",n[n.Y=4]="array",n[n.Z=5]="alias"})(b||(b={}));class y{constructor(n,strategy,t){this.key=n,this.strategy=strategy,this.state=t}register(n,t){return n.V(t||this.key,this)}resolve(n,t){switch(this.strategy){case 0:return this.state;case 1:{this.strategy=0;const t=n.P(this.state);return this.state=t.construct(n)}case 2:return n.P(this.state).construct(t);case 3:return this.state(n,t,this);case 4:return this.state[0].resolve(n,t);case 5:return n.get(this.state);default:throw Reporter.error(6,this.strategy)}}P(n){switch(this.strategy){case 1:case 2:return n.P(this.state);default:return null}}}class M{constructor(n,t,dependencies){this.nn=n,this.tn=t,this.dependencies=dependencies,this.en=null}static create(n){const dependencies=DI.G(n);return new M(n,x[dependencies.length]||C,dependencies)}construct(n,t){const e=this.en;let r=void 0!==t?this.tn.rn(n,this.nn,this.dependencies,t):this.tn.in(n,this.nn,this.dependencies);if(null===e)return r;for(let n=0,t=e.length;t>n;++n)r=e[n](r);return r}on(n){return null===this.en&&(this.en=[]),this.en.push(n),1}}const E={resolve:(n,t)=>t};class R{constructor(n={}){this.parent=null,this.sn=new Map,this.un=n,this.ln=n.ln||(n.ln=new Map),this.cn=n.cn||(n.cn=Object.create(null)),this.sn.set(IContainer,E)}register(...n){for(let t=0,e=n.length;e>t;++t){const e=n[t];if(i(e))e.register(this);else{const n=Object.keys(e);for(let t=0,r=n.length;r>t;++t){const value=e[n[t]];i(value)?value.register(this):this.register(value)}}}return this}V(n,t){o(n);const e=this.sn,r=e.get(n);return void 0===r?(e.set(n,t),"string"==typeof n&&(this.cn[n]=t)):r instanceof y&&4===r.strategy?r.state.push(t):e.set(n,new y(n,4,[r,t])),t}on(n,t){const e=this.fn(n);if(null===e)return 0;if(e.P){const n=e.P(this);return null===n?0:n.on(t)}return 0}fn(n,t=1){if(o(n),n.resolve)return n;let e=this;for(;null!==e;){const r=e.sn.get(n);if(void 0!==r)return r;if(null===e.parent)return t?this.an(n,e):null;e=e.parent}return null}has(n,t=0){return this.sn.has(n)?1:t&&null!==this.parent?this.parent.has(n,1):0}get(n){if(o(n),n.resolve)return n.resolve(this,this);let t=this;for(;null!==t;){let e=t.sn.get(n);if(void 0!==e)return e.resolve(t,this);if(null===t.parent)return(e=this.an(n,t)).resolve(t,this);t=t.parent}}getAll(n){o(n);let t=this;for(;null!==t;){const e=t.sn.get(n);if(void 0!==e)return s(e,t,this);if(null===this.parent)return PLATFORM.R;t=t.parent}return PLATFORM.R}P(n){let t=this.ln.get(n);return void 0===t&&(t=M.create(n),this.ln.set(n,t)),t}hn(){const n=this.un,t={ln:n.ln,cn:Object.assign({},n.cn)},e=new R(t);return e.parent=this,e}an(n,t){if(n.register){const e=n.register(t,n);if(!e||!e.resolve)throw Reporter.error(40);return e}const e=new y(n,1,n);return t.sn.set(n,e),e}}const Registration={U:(n,value)=>new y(n,0,value),singleton:(n,value)=>new y(n,1,value),transient:(n,value)=>new y(n,2,value),$:(n,t)=>new y(n,3,t),Z:(n,t)=>new y(t,5,n),mn:(n,...t)=>({register(e){const r=e.fn(n);if(null!==r){let n=null;if(r.P){const i=r.P(e);null!==i&&(n=i.construct(e,t))}else n=r.resolve(e,e);null!==n&&n.register(e)}}})},x=[{in:(n,t)=>new t,rn:u},{in:(n,t,e)=>new t(n.get(e[0])),rn:u},{in:(n,t,e)=>new t(n.get(e[0]),n.get(e[1])),rn:u},{in:(n,t,e)=>new t(n.get(e[0]),n.get(e[1]),n.get(e[2])),rn:u},{in:(n,t,e)=>new t(n.get(e[0]),n.get(e[1]),n.get(e[2]),n.get(e[3])),rn:u},{in:(n,t,e)=>new t(n.get(e[0]),n.get(e[1]),n.get(e[2]),n.get(e[3]),n.get(e[4])),rn:u}],C={in:u,rn:u},Profiler=(function(){const n=PLATFORM.now,t=[];let e;const r={vn(name){t.push(name);let r=0,i=0;return{L(){1==++r&&(i=n(),++e[name].wn),++e[name].dn},T(){0==--r&&(e[name].duration+=n()-i)}}},enable(){e={};for(const n of t)e[n]={name:n,duration:0,wn:0,dn:0};r.enabled=1},disable(){r.enabled=0},kn(n){Object.keys(e).map(n=>e[n]).sort((n,t)=>t.duration-n.duration).forEach(t=>{n(t.name,t.duration,t.wn,t.dn)})},enabled:0};return r})();n.all=all,n.DI=DI,n.IContainer=IContainer,n.inject=inject,n.IServiceLocator=IServiceLocator,n.lazy=lazy,n.optional=optional,n.Registration=Registration,n.singleton=function(n){return void 0===n?r:r(n)},n.transient=function(n){return void 0===n?e:e(n)},n.PLATFORM=PLATFORM,n.Reporter=Reporter,n.Tracer=Tracer,n.Profiler=Profiler,n.RuntimeCompilationResources=class{constructor(n){this.context=n}find(n,name){const t=n.$n(name),e=this.context.cn;let r=e[t];if(void 0===r&&(r=e[t]=this.context.fn(t,0)),null!==r&&r.P){const n=r.P(this.context);if(null!==n){const t=n.nn.description;return void 0===t?null:t}}return null}create(n,name){const t=n.$n(name),e=this.context.cn;let r=e[t];if(void 0===r&&(r=e[t]=this.context.fn(t,0)),null!==r){const n=r.resolve(this.context,this.context);return void 0===n?null:n}return null}},Object.defineProperty(n,"bn",{value:1})});
