function parseQuery(t){const s={},i=[];if(!t||!t.length)return{t:s,list:i};const e=t.replace("+"," ").split("&");for(const t of e){const e=t.split("="),h=decodeURIComponent(e.shift());if(!e.length){i.push(h);continue}const value=decodeURIComponent(e.shift());s[h]=value}return{t:s,list:i}}function mergeParameters(t,s,i){const e=parseQuery(s),h=parseQuery(t),n=Object.assign({},e.t,h.t),r=[...e.list,...h.list];if(r.length&&i&&i.length)for(const t of i)n[t]=r.shift();let o;return r.length&&Object.keys(n).length&&(n["s"]=r.splice(0,r.length)),{i:n,h:r,o:o=r.length?r:n}}function closestCustomElement(t){for(;t&&!t.$customElement;)t=t.parentElement;return t}function __decorate(t,s,i,e){var h,n,r=arguments.length,o=3>r?s:null===e?e=Object.getOwnPropertyDescriptor(s,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,s,i,e);else for(n=t.length-1;n>=0;n--)(h=t[n])&&(o=(3>r?h(o):r>3?h(s,i,o):h(s,i))||o);return r>3&&o&&Object.defineProperty(s,i,o),o}import{Reporter,PLATFORM,IContainer,buildQueryString,parseQueryString,inject}from"@aurelia/kernel";import{CustomElementResource,IObserverLocator,Aurelia,IDOM,createRenderContext,INode,IRenderingEngine,bindable,customElement}from"@aurelia/runtime";class QueuedBrowserHistory{constructor(){this.l=(async t=>this.u(this,"popstate",[t])),this.window=window,this.history=window.history,this.p=[],this.m=0,this.g=null,this.v=null,this.C=null,this.R=null}S(t){if(this.m)throw Reporter.error(2003);this.m=1,this.v=t,PLATFORM.$.add(this.V,this),this.window.addEventListener("popstate",this.l)}I(){this.window.removeEventListener("popstate",this.l),PLATFORM.$.remove(this.V,this),this.v=null,this.m=0}get length(){return this.history.length}get state(){return this.history.state}get O(){return this.history.O}async go(t,s=0){if(!s)return this.u(this,"_go",[t],1);const i=this.u(this,"suppressPopstate",[],1);return this.u(this.history,"go",[t]).catch(t=>{throw t}),i}back(){return this.go(-1)}forward(){return this.go(1)}async pushState(t,s,i){return this.u(this.history,"pushState",[t,s,i])}async replaceState(t,s,i){return this.u(this.history,"replaceState",[t,s,i])}async H(t){if(this.R){const t=this.R;this.R=null,t()}else{if(this.C){const t=this.C;this.C=null,t(),await Promise.resolve()}this.v(t)}}P(t,s){this.C=s,this.history.go(t)}k(t){this.R=t}u(t,s,i,e=0){let h;const n=new Promise(t=>{h=t});return e&&(i.push(h),h=null),this.p.push({target:t,N:s,t:i,resolve:h}),n}async V(t){if(!this.p.length||null!==this.g)return;this.g=this.p.shift();const s=this.g.target[this.g.N];Reporter.write(1e4,"DEQUEUE",this.g.N,this.g.t),s.apply(this.g.target,this.g.t);const i=this.g.resolve;this.g=null,i&&i()}}class HistoryBrowser{constructor(){this._=(async()=>{if(null!==this.j){Reporter.write(1e4,"=== ignore path change",this.A());const t=this.j;return this.j=null,void t()}const t=this.A(),s=this.L();Reporter.write(1e4,"path changed to",t,this.T,this.D);const i={};let e,h=this.B("HistoryEntry");if(this.T&&this.T.path===t){i.q=1;const t=this.F?this.D.index:this.history.length-this.G;e=this.D,this.D=this.T,this.D.index=t,this.F?(this.M=0,this.U[this.D.index]=this.D,this.J?(i.W=1,this.J=0):this.K?(i.X=1,this.K=0):i.Y=1,this.F=0):(this.M=1,this.U=this.U.slice(0,this.D.index),this.U.push(this.D)),await this.Z({tt:this.U,st:this.G,it:this.D})}else this.U=this.U||this.B("HistoryEntries")||[],this.G=this.G||this.B("HistoryOffset")||0,h||this.D?h?this.D?h.index>this.D.index?i.et=1:this.D.index>h.index&&(i.ht=1):i.X=1:i.q=1:(i.q=1,i.nt=1,this.G=this.history.length),h||(h={path:t,rt:null,index:this.history.length-this.G,ot:s},i.nt&&(h.at=1),this.U=this.U.slice(0,h.index),this.U.push(h),await this.Z({tt:this.U,st:this.G,it:h})),this.M=this.D?h.index-this.D.index:0,e=this.D,this.D=h,this.J&&(i.W=1,this.J=0);this.T=null,this.lt&&this.lt--,Reporter.write(1e4,"navigated",this.B("HistoryEntry"),this.U,this.B("HistoryOffset")),this.v(this.D,i,e)}),this.location=window.location,this.history=new QueuedBrowserHistory,this.D=null,this.U=null,this.G=null,this.ct=null,this.T=null,this.options=null,this.m=0,this.M=null,this.lt=null,this.J=0,this.F=0,this.K=0,this.j=null}S(t){if(this.m)throw Reporter.error(0);return this.m=1,this.options=Object.assign({},t),this.history.S(this._),Promise.resolve().then(()=>{this.ut(this.A(),1).catch(t=>{throw t})})}I(){this.history.I(),this.m=0}ft(t,s,i){return this.T={path:t,rt:null,title:s,data:i},this.ut(t)}replace(t,s,i){return this.F=1,this.T={path:t,rt:null,title:s,data:i},this.ut(t,1)}pt(t,s,i){return this.lt=this.M+1,this.replace(t,s,i)}async refresh(){if(this.D)return this.K=1,this.replace(this.D.path,this.D.title,this.D.data)}back(){return this.history.go(-1)}forward(){return this.history.go(1)}cancel(){this.J=1;const t=this.M||this.lt;return t?this.history.go(-t):this.replace(this.ct.path,this.ct.title,this.ct.data)}async pop(){let t,s=new Promise(t=>{this.j=t});await this.history.go(-1),await s;const i=""+this.location;if(!(t=this.history.state).it.at)return s=new Promise(t=>{this.j=t}),await this.history.go(-1),await s,this.history.pushState(t,null,i)}async Z(t,value){const{pathname:s,search:i,hash:e}=this.location;let h=Object.assign({},this.history.state);return"string"==typeof t?h[t]=JSON.parse(JSON.stringify(value)):h=Object.assign({},h,JSON.parse(JSON.stringify(t))),this.history.replaceState(h,null,`${s}${i}${e}`)}B(t){return Object.assign({},this.history.state)[t]}dt(t){return this.D.title=t,this.U[this.D.index]=this.D,this.Z({tt:this.U,it:this.D})}wt(t,s,i){if(i.index!==this.D.index)return;const e=`#/${t}`,{pathname:h,search:n,hash:r}=this.location;if(e===r&&this.D.path===t&&this.D.rt===s)return;this.D.path=t,this.D.rt=s;const o=Object.assign({},this.history.state,{it:this.D,tt:this.U});return this.history.replaceState(o,null,`${h}${n}${e}`)}gt(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get vt(){return this.U?this.U.slice(0,this.D.index+1).map(value=>value.title):[]}A(){return this.location.hash.substring(1).split("?")[0]}async ut(t,s=0){if(this.D&&this.D.path===t&&!this.K)return;const{pathname:i,search:e}=this.location,h=`#${t}`;return s?(this.ct=this.D,await this.history.replaceState({},null,`${i}${e}${h}`)):await this.history.pushState({},null,`${i}${e}${h}`),this._()}L(){const t=this.location.hash.substring(1).split("?");return t.shift(),t.length>0?t.shift():""}v(t,s,i){const e=Object.assign({},t,s);e.yt=i,Reporter.write(1e4,"callback",t,s),this.options.v&&this.options.v(e)}}class LinkHandler{constructor(){this.m=0,this.Ct=(t=>{const s=LinkHandler.Rt(t);s.bt&&(t.preventDefault(),this.options.v(s))}),this.document=document}static Rt(t){const s={bt:0,href:null,anchor:null},i=LinkHandler.St(t.target);if(!i||!LinkHandler.Et(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const e=i.getAttribute("href");return s.anchor=i,s.href=e,s.bt=1===t.which,s}static St(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static Et(t){const s=t.getAttribute("target");return!s||s===LinkHandler.window.name||"_self"===s}S(t){if(this.m)throw Reporter.error(2004);this.m=1,this.options=Object.assign({},t),this.document.addEventListener("click",this.Ct,1)}I(){this.document.removeEventListener("click",this.Ct,1),this.m=0}}class ViewportInstruction{constructor(component,t,s){this.initialize(component,t,s)}initialize(component,t,s){"string"==typeof component?(this.$t=component,this.component=null):(this.component=component,this.$t=component.description.name),"string"==typeof t?(this.Vt=t,this.viewport=null):(this.viewport=t,t&&(this.Vt=t.name)),"string"==typeof s?(this.It=s,this.t={id:s}):this.t=s}Ot(t){if(null!==this.component)return this.component;const s=t.get(IContainer),i=s.Ht(CustomElementResource.Pt(this.$t));return null!==i?i.Nt(s).kt:null}_t(router){return null!==this.viewport?this.viewport:router.jt()[this.Vt]}At(t,s=0,i=0){return s&&this.It!==t.It?0:i?this.component===t.component:this.$t===t.$t}}class NavRoute{constructor(t,s){this.active="",this.Lt=t,Object.assign(this,{title:s.title,children:null,Tt:s.Tt,active:""}),this.instructions=this.xt(s.Qt),this.link=this.zt(this.instructions),this.Dt=s.Bt?this.zt(this.xt(s.Bt)):this.link,this.qt=this.Lt.router.Ft.get(IObserverLocator),this.Gt=this.qt.Mt(0,this.Lt.router,"activeComponents"),this.Gt.subscribe(this)}get Ut(){return this.children&&this.children.length?"nav-has-children":""}Jt(){this.active=this.link&&this.link.length?this.Wt():"nav-active"===this.active?"nav-active":this.Kt()?"nav-active-child":""}Wt(){const t=this.Lt.router.Yt.Xt(this.Dt),s=this.Lt.router.Zt.map(t=>this.Lt.router.Yt.ts(t));for(const component of t)if(!s.find(t=>t.At(component)))return"";return"nav-active"}ss(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}zt(instructions){return this.Lt.router.Yt.es(instructions)}xt(t){if(!Array.isArray(t))return this.xt([t]);const instructions=[];for(const s of t)instructions.push("string"==typeof s?this.Lt.router.Yt.ts(s):s instanceof ViewportInstruction?s:s.component?new ViewportInstruction(s.component,s.viewport,s.t):new ViewportInstruction(s));return instructions}Kt(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.Kt())return 1;return 0}}class Nav{constructor(router,name){this.router=router,this.name=name,this.hs=[]}ns(t){for(const s of t)this.rs(this.hs,s)}rs(t,s){const i=new NavRoute(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.rs(i.children,t)}}}class HandlerEntry{constructor(t,s){this.Ct=t,this.names=s}}class RouteGenerator{constructor(t,s){this.os=t,this.as=s}}class TypesRecord{constructor(){this.ls=0,this.cs=0,this.us=0}}class RecognizeResult{constructor(t,s,i){this.Ct=t,this.fs=s,this.ps=i}}class CharSpec{constructor(t,s,i){this.ds=t,this.ws=s,this.repeat=i}ms(t){return this.ws===t.ws&&this.ds===t.ds}}class State{constructor(t){this.gs=t,this.vs=[]}put(t){let s=this.vs.find(s=>s.gs.ms(t));return void 0===s&&(s=new State(t),this.vs.push(s),t.repeat&&s.vs.push(s)),s}}const specials=["/",".","*","+","?","|","(",")","[","]","{","}","\\"],escapeRegex=RegExp(`(\\${specials.join("|\\")})`,"g");class StaticSegment{constructor(t,s){this.name=t,this.ys=t,this.Cs=s,this.optional=0}Rs(t){const s=this.ys,i=s.length;let e=0,h="";if(this.Cs)for(;i>e;++e)h=s.charAt(e),t(new CharSpec(null,h,0));else for(;i>e;++e)h=s.charAt(e),t(new CharSpec(null,h.toUpperCase()+h.toLowerCase(),0))}bs(){return this.ys.replace(escapeRegex,"\\$1")}Ss(t,s){return this.ys}}class DynamicSegment{constructor(name,optional){this.name=name,this.optional=optional}Rs(t){t(new CharSpec("/",null,1))}bs(){return"([^/]+)"}Ss(t,s){return s[this.name]=1,t[this.name]}}class StarSegment{constructor(name){this.name=name,this.optional=0}Rs(t){t(new CharSpec("",null,1))}bs(){return"(.+)"}Ss(t,s){return s[this.name]=1,t[this.name]}}class EpsilonSegment{Rs(t){}bs(){return""}Ss(t,s){return""}}class RouteRecognizer{constructor(){this.Es=new State,this.names={},this.hs=new Map}add(t){if(Array.isArray(t))return void t.forEach(t=>{this.add(t)});let s=this.Es;const i=[];let e="^";const h=new TypesRecord,n=[],r=t.Ct.name;let o=1,a=t.path;"/"===a.charAt(0)&&(a=a.slice(1));const l=[],c=a.split("/");let u,f;for(let r=0,a=c.length;a>r;++r){let a=(u=c[r]).match(/^:([^?]+)(\?)?$/);if(a){const[,name,optional]=a;if(-1!==name.indexOf("="))throw Error(`Parameter ${name} in route ${t} has a default value, which is not supported.`);l.push(f=new DynamicSegment(name,!!optional)),n.push(name),h.cs++}else if(a=u.match(/^\*(.+)$/))l.push(f=new StarSegment(a[1])),n.push(a[1]),h.us++;else{if(""===u){l.push(new EpsilonSegment);continue}l.push(f=new StaticSegment(u,t.Cs)),h.ls++}const p=s.put(new CharSpec(null,"/",0));let d=p;f.Rs(t=>{d=d.put(t)});for(let t=0,s=i.length;s>t;t++)i[t].vs.push(p);f.optional?(i.push(d),e+=`(?:/${f.bs()})?`):(s=d,e+=`/${f.bs()}`,i.length=0,o=0)}o&&(s=s.put(new CharSpec(null,"/",0)),e+="/?");const p=[new HandlerEntry(t.Ct,n)];if(this.hs.set(t.Ct,new RouteGenerator(l,p)),r){const t=Array.isArray(r)?r:[r];for(let s=0;t.length>s;s++)t[s]in this.names||(this.names[t[s]]=new RouteGenerator(l,p))}for(let s=0;i.length>s;s++){const n=i[s];n.as=p,n.bs=RegExp(`${e}$`,t.Cs?"":"i"),n.types=h}return s.as=p,s.bs=RegExp(`${e}$`,t.Cs?"":"i"),s.types=h,s}$s(t){return"string"==typeof t?this.names[t]:this.hs.get(t)}Vs(t){const s=this.$s(t);if(!s)throw Error(`There is no route named ${t}`);return[...s.as]}Is(t){return!!this.$s(t)}Ss(t,s){const i=this.$s(t);if(!i)throw Error(`There is no route named ${t}`);const e=i.as[0].Ct;if(e.Os)return e.href;const h=Object.assign({},s),n=i.os,r={};let o="";for(let s=0,i=n.length;i>s;s++){const i=n[s];if(i instanceof EpsilonSegment)continue;const e=i.Ss(h,r);if(null==e){if(!i.optional)throw Error(`A value is required for route parameter '${i.name}' in route '${t}'.`)}else o+="/",o+=e}"/"!==o.charAt(0)&&(o=`/${o}`);for(const t in r)Reflect.deleteProperty(h,t);const a=buildQueryString(h);return o+(a?`?${a}`:"")}Hs(t){let s=[this.Es],i={},e=0,h=t;const n=h.indexOf("?");if(-1!==n){const t=h.slice(n+1);h=h.slice(0,n),i=parseQueryString(t)}"/"!==(h=decodeURI(h)).charAt(0)&&(h=`/${h}`);let r=h.length;r>1&&"/"===h.charAt(r-1)&&(h=h.slice(0,-1),e=1,--r);for(let t=0;r>t;++t){const i=[],e=h.charAt(t);if(s.forEach(t=>{t.vs.forEach(t=>{null!==t.gs.ws?-1!==t.gs.ws.indexOf(e)&&i.push(t):null!==t.gs.ds&&-1===t.gs.ds.indexOf(e)&&i.push(t)})}),0===(s=i).length)break}const o=[];for(let t=0,i=s.length;i>t;t++)s[t].as&&o.push(s[t]);o.sort((t,s)=>{if(t.types.us!==s.types.us)return t.types.us-s.types.us;if(t.types.us){if(t.types.ls!==s.types.ls)return s.types.ls-t.types.ls;if(t.types.cs!==s.types.cs)return s.types.cs-t.types.cs}return t.types.cs!==s.types.cs?t.types.cs-s.types.cs:t.types.ls!==s.types.ls?s.types.ls-t.types.ls:0});const a=o[0];if(a&&a.as){e&&"(.+)$"===a.bs.source.slice(-5)&&(h=`${h}/`);const t=h.match(a.bs);let s=1;const n=[];return n.Ps=i,a.as.forEach(i=>{const e={};i.names.forEach(name=>{e[name]=t[s++]}),n.push(new RecognizeResult(i.Ct,e,i.names.length>0))}),n}}}class InstructionResolver{S(t){this.ks=Object.assign({viewport:"@",Ns:"+",scope:"/",_s:"!",t:"=",add:"+",clear:"-",action:"."},t.ks)}get js(){return this.ks.clear}ts(t){let component,s,i;const[e,h]=t.split(this.ks.viewport);return void 0===h?[component,i]=e.split(this.ks.t):(component=e,[s,i]=h.split(this.ks.t)),new ViewportInstruction(component,s,i)}As(t){let s=t.$t;return t.Vt&&(s+=this.ks.viewport+t.Vt),t.It&&(s+=this.ks.t+t.It),s}Ls(t,s){return t&&(s=`/${t}${this.ks.scope}${s}`),s}Ts(t){return{xs:t===this.ks.clear||t.startsWith(this.ks.clear+this.ks.add),Qs:t.startsWith(this.ks.clear)?t.substring(1):t}}zs(t){const s={};t.startsWith("/")&&(t=t.substring(1));const i=t.split(this.ks.Ns);let e=0;for(;i.length;){const t=i.shift().split(this.ks.scope),parts=t.pop().split(this.ks.viewport),component=parts[0];t.push(parts.length?parts.join(this.ks.viewport):`?${e++}`);const name=t.join(this.ks.scope);component&&(s[name]=component)}return s}es(instructions){const t=[];for(const s of instructions)t.push(this.As(s));return t.join(this.ks.Ns)}Xt(t){const instructions=[],s=t.split(this.ks.Ns);for(const t of s)instructions.push(this.ts(t));return instructions}Ds(t){let s=t.slice().sort((t,s)=>s.split(this.ks.scope).length-t.split(this.ks.scope).length),i=[];if((s=s.map(value=>`${this.ks.scope}${value}${this.ks.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.ks.scope).length-s.split(this.ks.scope).length),i}Bs(t,s=0){const i=t.slice();return s&&i.unshift(this.js),i.join(this.ks.Ns)}}var ContentStatus;(function(t){t[t.qs=0]="none",t[t.loaded=1]="loaded",t[t.Fs=2]="initialized",t[t.Gs=3]="entered",t[t.Ms=4]="added"})(ContentStatus||(ContentStatus={}));class ViewportContent{constructor(t=null,s=null,i=null,e=null){this.content=t,this.t=s,this.Us=i,this.component=null,this.Js=0,this.Ws=0,null!==this.content&&"string"==typeof this.content&&null!==e&&(this.content=this.Ot(e))}Ks(t){return"string"==typeof t.content&&this.$t()!==t.content||"string"!=typeof t.content&&this.content!==t.content||this.t!==t.t||!this.Us||this.Us.ot!==t.Us.ot}Xs(t){return("string"==typeof t.content&&this.$t()===t.content||"string"!=typeof t.content&&this.content===t.content)&&this.t===t.t}loadComponent(t,s){return this.Ws||(this.component=this.Ys(t),this.component.Zs(0,t,s)),this.Js=1,Promise.resolve()}ti(){1===this.Js&&(this.Js=0)}si(){this.Ws||this.component.ii(2560,null),this.Js=2}ei(t=0){2===this.Js&&(t||this.component.hi(5120),this.Js=1)}addComponent(t){if(this.component.ni(512),this.Ws){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)if(t.hasAttribute("au-element-scroll")){const[s,i]=t.getAttribute("au-element-scroll").split(",");t.removeAttribute("au-element-scroll"),t.scrollTo(+i,+s)}}this.Js=4}ri(t,s=0){if(4===this.Js){if(s){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)(t.scrollTop>0||t.scrollLeft)&&t.setAttribute("au-element-scroll",`${t.scrollTop},${t.scrollLeft}`)}this.component.oi(1024),this.Js=4}}async ai(t,s=0){switch(this.Js){case 4:this.ri(t,s);case 3:this.component.li&&await this.component.li(),this.Js=2;case 2:this.ei(s);case 1:this.ti()}this.Js=0}$t(){return null===this.content?null:"string"==typeof this.content?this.content:this.content.description.name}Ot(t){if(null===this.content)return null;if("string"!=typeof this.content)return this.content;{const s=t.get(IContainer),i=s.Ht(CustomElementResource.Pt(this.content));return null!==i?i.Nt(s).kt:null}}Ys(t){if(null===this.content)return null;const component=this.$t();return t.get(IContainer).get("string"!=typeof component?component:CustomElementResource.Pt(component))}}class Viewport{constructor(router,name,t,s,i,e,h){this.router=router,this.name=name,this.ci=t,this.context=s,this.ui=i,this.scope=e,this.options=h,this.clear=0,this.content=new ViewportContent,this.fi=null,this.pi=null,this.di=null,this.cache=[],this.enabled=1}wi(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.Yt.js)this.clear=1,t=null;else{const s=t.split(this.router.Yt.ks.t);t=s.shift(),i=s.length?s.join(this.router.Yt.ks.t):null}if(this.fi=new ViewportContent(t,i,s,this.context),this.options.mi){const t=this.cache.find(t=>this.fi.Xs(t));t?(this.fi=t,this.fi.Ws=1):this.cache.push(this.fi)}return this.content.Ks(this.fi)||s.X}gi(t,s,i){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.ci&&(this.scope.ci=t),this.ci!==t&&(this.di=Object.assign({},this),this.vi(),this.ci=t,i&&i.yi&&(this.options.yi=i.yi),i&&i.default&&(this.options.default=i.default),i&&i.Ci&&(this.options.Ci=i.Ci),i&&i.Ri&&(this.options.Ri=i.Ri),i&&i.mi&&(this.options.mi=i.mi),this.pi&&this.pi()),this.context!==s&&(this.context=s),this.content.component||this.fi&&this.fi.component||!this.options.default||this.router.bi(this.options.default,this)}remove(t,s){return this.ci===t&&this.context===s?(this.content.component&&this.content.ai(this.ci,this.options.mi).catch(t=>{throw t}),1):0}async Si(){if(!this.content.component)return 1;const component=this.content.component;return component.Si?(Reporter.write(1e4,"viewport canLeave",component.Si(this.content.Us,this.fi.Us)),component.Si(this.content.Us,this.fi.Us)):1}async Ei(){if(this.clear)return 1;if(!this.fi.content)return 0;if(await this.$i(),await this.fi.loadComponent(this.context,this.ci),!this.fi.component)return 0;const component=this.fi.component;if(!component.Ei)return 1;const t=component.Ei(this.fi.Us,this.content.Us);return Reporter.write(1e4,"viewport canEnter",t),"boolean"==typeof t?t:"string"==typeof t?[new ViewportInstruction(t,this)]:t}async Vi(){if(Reporter.write(1e4,"Viewport enter",this.name),this.clear)return 1;if(!this.fi.component)return 0;if(this.fi.component.Vi){const t=mergeParameters(this.fi.t,this.fi.Us.ot,this.fi.content.t);this.fi.Us.t=t.i,this.fi.Us.h=t.h,await this.fi.component.Vi(t.o,this.fi.Us,this.content.Us),this.fi.Js=3}return this.fi.si(),1}async Ii(){return Reporter.write(1e4,"Viewport loadContent",this.name),this.content.component&&(this.content.component.li&&await this.content.component.li(this.content.Us,this.fi.Us),this.fi.component||(this.content.ri(this.ci,this.options.mi),this.content.ei(this.options.mi),this.content.ti())),this.fi.component&&(this.content.component&&(this.content.ri(this.ci,this.options.mi),this.content.ei(this.options.mi),this.content.ti()),this.fi.addComponent(this.ci),this.content=this.fi),this.clear&&(this.content=new ViewportContent(null,null,this.fi.Us)),this.fi=null,1}Oi(){this.di=null}async Hi(){await this.fi.ai(this.ci,this.options.mi),this.di&&Object.assign(this,this.di)}description(t=0){if(this.content.content){const component=this.content.$t(),s=this.scope?this.router.Yt.ks._s:"",i=this.content.t?this.router.Yt.ks.t+this.content.t:"";if(t||s.length||this.options.Pi)return`${component}${this.router.Yt.ks.viewport}${this.name}${s}${i}`;const e={};return e[component]=component,this.ui.ki(e)?`${component}${i}`:`${component}${this.router.Yt.ks.viewport}${this.name}${s}${i}`}}Ni(t=0){return[this.ui._i(t),this.description(t)].filter(value=>value&&value.length).join(this.router.Yt.ks.scope)}ji(component){let t=this.options.yi||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}Ai(component){if("-"===component||null===component)return 1;let t=this.options.yi;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}Li(t){this.content.component&&this.content.si()}Ti(t){Reporter.write(1e4,"ATTACHING viewport",this.name,this.content,this.fi),this.enabled=1,this.content.component&&this.content.addComponent(this.ci)}xi(t){Reporter.write(1e4,"DETACHING viewport",this.name),this.content.component&&this.content.ri(this.ci,this.options.mi),this.enabled=0}Qi(t){this.content.component&&this.content.ei(this.options.mi)}vi(){this.options={},this.content=new ViewportContent,this.cache=[]}async $i(){return this.ci?Promise.resolve():new Promise(t=>{this.pi=t})}}class Scope{constructor(router,t,s,i){this.router=router,this.ci=t,this.context=s,this.parent=i,this.viewport=null,this.children=[],this.zi=[],this.Di={},this.Bi=null,this.parent&&this.parent.qi(this)}Fi(){return this.zi.filter(t=>t.enabled).reduce((t,s)=>(t[s.name]=s,t),{})}ki(t){const s=[];let i=0;t&&(this.Bi={},this.Di={}),this.Bi=Object.assign({},this.Fi(),this.Bi);for(const s in t){const parts=s.split(this.router.Yt.ks.scope),t=parts.shift();this.Di[t]||(this.Di[t]=[]),this.Di[t].push(parts)}for(const e in this.Di){const h=e.split(this.router.Yt.ks.t),component=h.shift().split(this.router.Yt.ks.viewport).shift(),n=component+(h.length?this.router.Yt.ks.t+h.join(this.router.Yt.ks.t):"");for(const name in this.Bi){const h=this.Bi[name];if(h&&h.ji(component)){const r=this.Gi(t,this.Di,e,n,h);s.push(...r.Mi),i=i||r.Ui,this.Bi[name]=null,Reflect.deleteProperty(this.Di,e);break}}}for(const e in this.Di){const h=e.split(this.router.Yt.ks.t),parts=h.shift().split(this.router.Yt.ks.viewport),component=parts.shift(),n=component+(h.length?this.router.Yt.ks.t+h.join(this.router.Yt.ks.t):"");let name=parts.shift();if(!name||!name.length||name.startsWith("?"))continue;let r=0;name.endsWith(this.router.Yt.ks._s)&&(r=1,name=name.substring(0,name.length-1)),this.Fi()[name]||(this.Ji(name,null,null,{scope:r,Pi:1}),this.Bi[name]=this.Fi()[name]);const o=this.Bi[name];if(o&&o.Ai(component)){const h=this.Gi(t,this.Di,e,n,o);s.push(...h.Mi),i=i||h.Ui,this.Bi[name]=null,Reflect.deleteProperty(this.Di,e)}}for(const e in this.Di){const h=e.split(this.router.Yt.ks.t),component=h.shift().split(this.router.Yt.ks.viewport).shift(),n=component+(h.length?this.router.Yt.ks.t+h.join(this.router.Yt.ks.t):""),r=[];for(const name in this.Bi){const t=this.Bi[name];t&&t.Ai(component)&&r.push(t)}if(1===r.length){const h=r.shift(),o=this.Gi(t,this.Di,e,n,h);s.push(...o.Mi),i=i||o.Ui,this.Bi[h.name]=null,Reflect.deleteProperty(this.Di,e);break}}if(i=i||Object.keys(this.Di).length>0,!t)for(const t of this.children){const e=t.ki();s.push(...e.Mi),i=i||e.Ui}return{Mi:s,Ui:i}}Gi(t,s,i,component,e){const h=[{component,viewport:e}];let n=0;if(s[i].length){const r=e.scope||e.ui;for(const e of s[i])if(e.length){const s=e.join(this.router.Yt.ks.scope),o={};o[s]=t[i+this.router.Yt.ks.scope+s];const a=r.ki(o);h.push(...a.Mi),n=n||a.Ui}}return{Mi:h,Ui:n}}Ji(name,t,s,i){let e=this.Fi()[name];if(t&&e&&null!==e.ci&&e.ci!==t&&(e.enabled=0,(e=this.zi.find(s=>s.name===name&&s.ci===t))&&(e.enabled=1)),!e){let h;i.scope&&(h=new Scope(this.router,t,s,this),this.router.Wi.push(h)),e=new Viewport(this.router,name,null,null,this,h,i),this.zi.push(e)}return(t||s)&&e.gi(t,s,i),e}Ki(t,s,i){return(!s&&!i||t.remove(s,i))&&(t.scope&&this.router.Xi(t.scope),this.zi.splice(this.zi.indexOf(t),1)),Object.keys(this.zi).length}Xi(){for(const t of this.children)t.Xi();const t=this.Fi();for(const name in t)this.router.Ki(t[name],null,null)}Yi(t){return t.Ei().then(()=>t.Ii())}qi(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}Zi(t=0,s=0){const i=[];for(const e in this.Fi()){const h=this.Fi()[e];(h.options.Ri||h.options.Ci&&!t)&&!s||i.push(h.Ni(t))}for(const s of this.children)i.push(...s.Zi(t));return i.filter(value=>value&&value.length)}jt(){const t=this.zi.filter(t=>t.enabled);for(const s of this.children)t.push(...s.jt());return t}_i(t=0){if(!this.ci||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent.te(this.context.get(IContainer).parent);for(;i&&i.ui===this.parent;)s.unshift(i.description(t)),i=this.te(i.context.get(IContainer).parent);return s.unshift(this.parent._i(t)),s.filter(value=>value&&value.length).join(this.router.Yt.ks.scope)}te(t){const s=Object.values(this.Fi());for(;t;){const i=s.find(s=>s.context.get(IContainer)===t);if(i)return i;t=t.parent}return null}}class Router{constructor(t){this.Ft=t,this.Wi=[],this.se={},this.Zt=[],this.ie=[],this.m=0,this.ee=0,this.he=[],this.ne=null,this.re=null,this.oe=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substring(1)),!s.startsWith("/")){const i=this.ae(t.anchor)._i();s=this.Yt.Ls(i,s)}this.le.gt(s)}),this.le=new HistoryBrowser,this.ce=new LinkHandler,this.Yt=new InstructionResolver}get ue(){return null!==this.ne}S(t){if(this.m)throw Reporter.error(2001);return this.m=1,this.options=Object.assign({v:t=>{this.fe(t)}},t),this.Yt.S({ks:this.options.ks}),this.ce.S({v:this.oe}),this.le.S(this.options).catch(t=>{throw t})}I(){if(!this.m)throw Reporter.error(2e3);this.ce.I(),this.le.I()}fe(t){this.he.push(t),this.pe().catch(t=>{throw t})}async pe(){if(null!==this.ne||!this.he.length)return Promise.resolve();const t=this.he.shift();if(this.ne=t,this.options.de&&this.options.de(t),t.W)return this.ne=null,this.pe();let s=0;(t.ht||t.et)&&t.rt&&(t.path=t.rt,s=1);let i=t.path;this.options.we&&!s&&(i=this.options.we(i,this),Array.isArray(i)&&(i=this.Yt.es(i)));const{xs:e,Qs:h}=this.Yt.Ts(i);e&&(i=h);const n=parseQuery(t.ot);t.t=n.t,t.h=n.list;const r=this.Yt.zs(i);if(!r&&!Object.keys(r).length&&!e)return this.ne=null,this.pe();const o=e?this.jt().filter(value=>null!==value.content.component):[],a=this.jt().filter(value=>value.options.default&&null===value.content.component),l=[];let{Mi:c,Ui:u}=this.me.ki(r),f=100;for(;c.length||u||a.length;){if(!f--)throw Reporter.error(2002);const s=[];for(const i of c){const{component,viewport:e}=i;e.wi(component,t)&&s.push(e);const h=o.findIndex(value=>value===e);0>h||o.splice(h,1);const n=a.findIndex(value=>value===e);0>n||a.splice(n,1)}for(const i of o)i.wi(this.Yt.js,t)&&s.push(i);let i;for(;i=a.shift();)i.wi(i.options.default,t)&&s.push(i);if(!s.length&&this.ee){const i=this.ge([...s,...l],t);return this.ee=0,await this.pe(),i}let e=await Promise.all(s.map(value=>value.Si()));if(e.findIndex(value=>0==value)>=0)return this.ge([...s,...l],t);if((e=await Promise.all(s.map(async value=>{const t=await value.Ei();if("boolean"==typeof t)return t?value.Vi():0;for(const s of t)this.bi(s.component,s.viewport);return value.Hi().catch(t=>{throw t}),1}))).some(t=>0==t))return this.ge([...s,...l],t);for(const t of s)l.find(value=>value===t)||l.push(t);const h=this.me.ki();let n;for(c=[];n=this.ie.shift();)h.Mi.find(value=>value.viewport===n.viewport)||c.push(n);c=[...c,...h.Mi],u=h.Ui}await Promise.all(l.map(value=>value.Ii())),await this.ve(t),t.nt||t.ye||!l.every(t=>t.options.Ri)||await this.le.pop(),l.forEach(t=>{t.Oi()}),this.re=this.ne,this.re.ye&&(this.re.ye=0),this.ne=null,this.pe().catch(t=>{throw t})}bi(component,t){this.ne?("string"==typeof t&&(t=this.jt().find(s=>s.name===t)),this.ie.push({viewport:t,component})):this.re&&(this.he.unshift({path:"",rt:"",ye:1}),this.pe().catch(t=>{throw t}))}Ce(t){return this.Re(),this.ae(t)}Ji(name,t,s,i){return Reporter.write(1e4,"Viewport added",name,t),this.Ce(t).Ji(name,t,s,i)}Ki(t,s,i){const e=t.ui;e.Ki(t,s,i)||this.Xi(e)}jt(){return this.Re(),this.me.jt()}Xi(t){if(t!==this.me){t.Xi();const s=this.Wi.indexOf(t);0>s||this.Wi.splice(s,1)}}ft(t,s,i){if("string"==typeof t)return this.le.ft(t,s,i)}replace(t,s,i){if("string"==typeof t)return this.le.replace(t,s,i)}refresh(){return this.le.refresh()}back(){return this.le.back()}forward(){return this.le.forward()}be(name,t){const s=this.Se(name);s&&(s.hs=[]),this.Ee(name,t)}Ee(name,t){let s=this.se[name];s||(s=this.se[name]=new Nav(this,name)),s.ns(t)}Se(name){return this.se[name]}async ge(t,s){t.forEach(t=>{t.Hi().catch(t=>{throw t})}),s.q?await this.le.pop():await this.le.cancel(),this.ne=null,this.pe().catch(t=>{throw t})}Re(){if(!this.me){const t=this.Ft.get(Aurelia).root();this.me=new Scope(this,t.$e,t.$context,null),this.Wi.push(this.me)}}ae(t){let s=closestCustomElement(t).$customElement.$context.get(IContainer);for(;s;){const t=this.Wi.find(t=>t.context.get(IContainer)===s);if(t)return t;s=s.parent}}ve(t){this.Zt=this.me.Zi(1,1),this.Zt=this.Yt.Ds(this.Zt);let s=this.me.Zi();s=this.Yt.Ds(s);let i=this.Yt.Bs(s);this.options.Ve&&(i=this.options.Ve(this.Yt.Xt(i),this));let e=this.me.Zi(1);e=this.Yt.Ds(e);const h=t.ot&&t.ot.length?`?${t.ot}`:"";return this.le.wt(i+h,this.Yt.Bs(e,1)+h,t)}}Router.inject=[IContainer];class ViewportCustomElement{constructor(router,t,s){this.router=router,this.ci=t,this.Ie=s,this.name="default",this.scope=null,this.yi=null,this.default=null,this.Ci=null,this.Ri=null,this.mi=null,this.viewport=null}Oe(t,host,parts,s){const i=this.constructor,dom=s.get(IDOM),template=this.Ie.He(dom,i.description,s,i);template.Pe=createRenderContext(dom,s,i.description.dependencies,i),template.Oe(this,host,parts)}bound(){this.connect()}ke(){this.disconnect()}connect(){const t={scope:this.ci.hasAttribute("scope")};this.yi&&this.yi.length&&(t.yi=this.yi),this.default&&this.default.length&&(t.default=this.default),this.ci.hasAttribute("no-link")&&(t.Ci=1),this.ci.hasAttribute("no-history")&&(t.Ri=1),this.ci.hasAttribute("stateful")&&(t.mi=1),this.viewport=this.router.Ji(this.name,this.ci,this.$context,t)}disconnect(){this.router.Ki(this.viewport,this.ci,this.$context)}Li(t){this.viewport&&this.viewport.Li(t)}Ti(t){this.viewport&&this.viewport.Ti(t)}xi(t){this.viewport&&this.viewport.xi(t)}Qi(t){this.viewport&&this.viewport.Qi(t)}}ViewportCustomElement.inject=[Router,INode,IRenderingEngine],__decorate([bindable],ViewportCustomElement.prototype,"name",void 0),__decorate([bindable],ViewportCustomElement.prototype,"scope",void 0),__decorate([bindable],ViewportCustomElement.prototype,"usedBy",void 0),__decorate([bindable],ViewportCustomElement.prototype,"default",void 0),__decorate([bindable],ViewportCustomElement.prototype,"noLink",void 0),__decorate([bindable],ViewportCustomElement.prototype,"noHistory",void 0),__decorate([bindable],ViewportCustomElement.prototype,"stateful",void 0),CustomElementResource.Ne({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> </div></template>'},ViewportCustomElement);let NavCustomElement=class{constructor(router){this.router=router,this.name=null,this.hs=null,this.level=0}get _e(){const t=this.router.Se(this.name);return t?t.hs:[]}active(t){return"Active"}};__decorate([bindable],NavCustomElement.prototype,"name",void 0),__decorate([bindable],NavCustomElement.prototype,"routes",void 0),__decorate([bindable],NavCustomElement.prototype,"level",void 0),NavCustomElement=__decorate([inject(Router,Element),customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],NavCustomElement);export{HistoryBrowser,LinkHandler,Nav,QueuedBrowserHistory,HandlerEntry,RouteGenerator,TypesRecord,RecognizeResult,CharSpec,State,StaticSegment,DynamicSegment,StarSegment,EpsilonSegment,RouteRecognizer,Router,Scope,Viewport,ViewportCustomElement,NavCustomElement};
