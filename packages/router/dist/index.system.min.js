System.register("router",["@aurelia/runtime","@aurelia/kernel"],function(t){"use strict";var IObserverLocator,LifecycleFlags,CustomElementResource,Aurelia,IDOM,createRenderContext,INode,IRenderingEngine,bindable,customElement,buildQueryString,parseQueryString,IContainer,inject;return{t:[function(t){IObserverLocator=t.IObserverLocator,LifecycleFlags=t.LifecycleFlags,CustomElementResource=t.CustomElementResource,Aurelia=t.Aurelia,IDOM=t.IDOM,createRenderContext=t.createRenderContext,INode=t.INode,IRenderingEngine=t.IRenderingEngine,bindable=t.bindable,customElement=t.customElement},function(t){buildQueryString=t.buildQueryString,parseQueryString=t.parseQueryString,IContainer=t.IContainer,inject=t.inject}],s(){function s(t){const s={},i=[];if(!t||!t.length)return{i:s,list:i};const h=t.replace("+"," ").split("&");for(const t of h){const h=t.split("="),e=decodeURIComponent(h.shift());if(!h.length){i.push(e);continue}const value=decodeURIComponent(h.shift());s[e]=value}return{i:s,list:i}}function i(t,s,i,h){var e,n,r=arguments.length,o=3>r?s:null===h?h=Object.getOwnPropertyDescriptor(s,i):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,s,i,h);else for(n=t.length-1;n>=0;n--)(e=t[n])&&(o=(3>r?e(o):r>3?e(s,i,o):e(s,i))||o);return r>3&&o&&Object.defineProperty(s,i,o),o}class h{constructor(){this.h=(()=>{if(null!==this.o){const t=this.o;return this.o=null,void t()}const t=this.l(),s=this.u(),i={};let h,e=this.p("HistoryEntry");if(this.v&&this.v.path===t){i.m=1;const t=this.g?this.$.index:this.history.length-this.C;h=this.$,this.$=this.v,this.$.index=t,this.g?(this.R=0,this.S[this.$.index]=this.$,this.O?(i.k=1,this.O=0):this.P?(i.j=1,this.P=0):i.H=1,this.g=0):(this.R=1,this.S=this.S.slice(0,this.$.index),this.S.push(this.$)),this.V({N:this.S,A:this.C,T:this.$})}else this.S=this.S||this.p("HistoryEntries")||[],this.C=this.C||this.p("HistoryOffset")||0,e||this.$?e?this.$?e.index>this.$.index?i.I=1:this.$.index>e.index&&(i.L=1):i.j=1:i.m=1:(i.m=1,i.D=1,this.C=this.history.length),e||(this.S=this.S.slice(0,(e={path:t,F:null,index:this.history.length-this.C,J:s}).index),this.S.push(e),this.V({N:this.S,A:this.C,T:e})),this.R=this.$?e.index-this.$.index:0,h=this.$,this.$=e,this.O&&(i.k=1,this.O=0);this.v=null,this.q&&this.q--,this.U(this.$,i,h)}),this.location=window.location,this.history=window.history,this.$=null,this.S=null,this.C=null,this._=null,this.v=null,this.options=null,this.B=0,this.R=null,this.q=null,this.O=0,this.g=0,this.P=0,this.o=null}G(t){if(this.B)throw Error("History has already been activated.");return this.B=1,this.options=Object.assign({},t),window.addEventListener("popstate",this.h),Promise.resolve().then(()=>{this.M(this.l(),1)})}W(){window.removeEventListener("popstate",this.h),this.B=0}K(t,s,i){this.v={path:t,F:null,title:s,data:i},this.M(t)}replace(t,s,i){this.g=1,this.v={path:t,F:null,title:s,data:i},this.M(t,1)}X(t,s,i){this.q=this.R+1,this.replace(t,s,i)}refresh(){this.$&&(this.P=1,this.replace(this.$.path,this.$.title,this.$.data))}back(){this.history.go(-1)}forward(){this.history.go(1)}cancel(){this.O=1;const t=this.R||this.q;t?this.history.go(-t):this.replace(this._.path,this._.title,this._.data)}async pop(){let t,s=new Promise(t=>{this.o=t});this.history.go(-1),await s;const i=""+this.location;t=this.history.state,s=new Promise(t=>{this.o=t}),this.history.go(-1),await s,this.history.pushState(t,null,i)}V(t,value){const{pathname:s,search:i,hash:h}=this.location;let e=Object.assign({},this.history.state);"string"==typeof t?e[t]=JSON.parse(JSON.stringify(value)):e=Object.assign({},e,JSON.parse(JSON.stringify(t))),this.history.replaceState(e,null,`${s}${i}${h}`)}p(t){return Object.assign({},this.history.state)[t]}Y(t){this.$.title=t,this.S[this.$.index]=this.$,this.V({N:this.S,T:this.$})}Z(t,s,i){if(i.index!==this.$.index)return;const h=`#/${t}`,{pathname:e,search:n,hash:r}=this.location;if(h===r&&this.$.path===t&&this.$.F===s)return;this.$.path=t,this.$.F=s;const o=Object.assign({},this.history.state,{T:this.$,N:this.S});this.history.replaceState(o,null,`${e}${n}${h}`)}tt(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get st(){return this.S?this.S.slice(0,this.$.index+1).map(value=>value.title):[]}l(){return this.location.hash.substring(1).split("?")[0]}M(t,s=0){if(this.$&&this.$.path===t&&!this.P)return;const{pathname:i,search:h}=this.location,e=`#${t}`;s?(this._=this.$,this.history.replaceState({},null,`${i}${h}${e}`)):this.history.pushState({},null,`${i}${h}${e}`),this.h()}u(){const t=this.location.hash.substring(1).split("?");return t.shift(),t.length>0?t.shift():""}U(t,s,i){const h=Object.assign({},t,s);h.it=i,this.options.U&&this.options.U(h)}}t("HistoryBrowser",h);class e{constructor(){this.B=0,this.ht=(t=>{const s=e.et(t);s.nt&&(t.preventDefault(),this.options.U(s))}),this.document=document}static et(t){const s={nt:0,href:null,anchor:null},i=e.rt(t.target);if(!i||!e.ot(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const h=i.getAttribute("href");return s.anchor=i,s.href=h,s.nt=1===t.which,s}static rt(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static ot(t){const s=t.getAttribute("target");return!s||s===e.window.name||"_self"===s}G(t){if(this.B)throw Error("LinkHandler has already been activated.");this.B=1,this.options=Object.assign({},t),this.document.addEventListener("click",this.ht,1)}W(){this.document.removeEventListener("click",this.ht,1),this.B=0}}t("LinkHandler",e);class n{constructor(t,s){this.active="",this.lt=t,Object.assign(this,{ct:s.ct,title:s.title,children:null,at:s.at,active:""}),this.link=this.ut(this.ct),this.ft=s.dt?this.ut(s.dt):this.link,this.pt=this.lt.router.vt.get(IObserverLocator),this.wt=this.pt.gt(LifecycleFlags.yt,this.lt.router,"activeComponents"),this.wt.subscribe(this)}get $t(){return this.children&&this.children.length?"nav-has-children":""}bt(){this.active=this.link&&this.link.length?this.Et():"nav-active"===this.active?"nav-active":this.Ct()?"nav-active-child":""}Et(){const t=this.ft.split(this.lt.router.Rt.add),s=this.lt.router.St;for(const component of t)if(0>component.indexOf(this.lt.router.Rt.viewport)){if(0>s.findIndex(value=>value.replace(/\@[^=]*/,"")===component))return""}else if(0>s.indexOf(component))return"";return"nav-active"}Ot(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}ut(t){return Array.isArray(t)?t.map(value=>this.kt(value)).join(this.lt.router.Rt.Pt):this.kt(t)}Ct(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.Ct())return 1;return 0}kt(component){return component?"string"==typeof component?component:component.description?component.description.name:component.component?this.kt(component.component)+(component.viewport?`@${component.viewport}`:""):void 0:""}}class r{constructor(router,name){this.router=router,this.name=name,this.jt=[]}Ht(t){for(const s of t)this.Vt(this.jt,s)}Vt(t,s){const i=new n(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.Vt(i.children,t)}}}t("Nav",r);class o{constructor(t,s){this.ht=t,this.names=s}}t("HandlerEntry",o);class l{constructor(t,s){this.Nt=t,this.xt=s}}t("RouteGenerator",l);class c{constructor(){this.At=0,this.Tt=0,this.It=0}}t("TypesRecord",c);class a{constructor(t,s,i){this.ht=t,this.zt=s,this.Lt=i}}t("RecognizeResult",a);class u{constructor(t,s,i){this.Dt=t,this.Ft=s,this.repeat=i}Jt(t){return this.Ft===t.Ft&&this.Dt===t.Dt}}t("CharSpec",u);class State{constructor(t){this.qt=t,this.Ut=[]}put(t){let s=this.Ut.find(s=>s.qt.Jt(t));return void 0===s&&(s=new State(t),this.Ut.push(s),t.repeat&&s.Ut.push(s)),s}}t("State",State);const f=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g;class d{constructor(t,s){this.name=t,this._t=t,this.Bt=s,this.optional=0}Gt(t){const s=this._t,i=s.length;let h=0,e="";if(this.Bt)for(;i>h;++h)e=s.charAt(h),t(new u(null,e,0));else for(;i>h;++h)e=s.charAt(h),t(new u(null,e.toUpperCase()+e.toLowerCase(),0))}Mt(){return this._t.replace(f,"\\$1")}Wt(t,s){return this._t}}t("StaticSegment",d);class p{constructor(name,optional){this.name=name,this.optional=optional}Gt(t){t(new u("/",null,1))}Mt(){return"([^/]+)"}Wt(t,s){return s[this.name]=1,t[this.name]}}t("DynamicSegment",p);class v{constructor(name){this.name=name,this.optional=0}Gt(t){t(new u("",null,1))}Mt(){return"(.+)"}Wt(t,s){return s[this.name]=1,t[this.name]}}t("StarSegment",v);class w{Gt(t){}Mt(){return""}Wt(t,s){return""}}t("EpsilonSegment",w),t("RouteRecognizer",class{constructor(){this.Kt=new State,this.names={},this.jt=new Map}add(t){if(Array.isArray(t))return void t.forEach(t=>{this.add(t)});let s=this.Kt;const i=[];let h="^";const e=new c,n=[],r=t.ht.name;let a=1,f=t.path;"/"===f.charAt(0)&&(f=f.slice(1));const m=[],g=f.split("/");let y,$;for(let r=0,o=g.length;o>r;++r){let o=(y=g[r]).match(/^:([^?]+)(\?)?$/);if(o){const[,name,optional]=o;if(-1!==name.indexOf("="))throw Error(`Parameter ${name} in route ${t} has a default value, which is not supported.`);m.push($=new p(name,!!optional)),n.push(name),e.Tt++}else if(o=y.match(/^\*(.+)$/))m.push($=new v(o[1])),n.push(o[1]),e.It++;else{if(""===y){m.push(new w);continue}m.push($=new d(y,t.Bt)),e.At++}const l=s.put(new u(null,"/",0));let c=l;$.Gt(t=>{c=c.put(t)});for(let t=0,s=i.length;s>t;t++)i[t].Ut.push(l);$.optional?(i.push(c),h+=`(?:/${$.Mt()})?`):(s=c,h+=`/${$.Mt()}`,i.length=0,a=0)}a&&(s=s.put(new u(null,"/",0)),h+="/?");const b=[new o(t.ht,n)];if(this.jt.set(t.ht,new l(m,b)),r){const t=Array.isArray(r)?r:[r];for(let s=0;t.length>s;s++)t[s]in this.names||(this.names[t[s]]=new l(m,b))}for(let s=0;i.length>s;s++){const n=i[s];n.xt=b,n.Mt=RegExp(`${h}$`,t.Bt?"":"i"),n.types=e}return s.xt=b,s.Mt=RegExp(`${h}$`,t.Bt?"":"i"),s.types=e,s}Qt(t){return"string"==typeof t?this.names[t]:this.jt.get(t)}Xt(t){const s=this.Qt(t);if(!s)throw Error(`There is no route named ${t}`);return[...s.xt]}Yt(t){return!!this.Qt(t)}Wt(t,s){const i=this.Qt(t);if(!i)throw Error(`There is no route named ${t}`);const h=i.xt[0].ht;if(h.Zt)return h.href;const e=Object.assign({},s),n=i.Nt,r={};let o="";for(let s=0,i=n.length;i>s;s++){const i=n[s];if(i instanceof w)continue;const h=i.Wt(e,r);if(null==h){if(!i.optional)throw Error(`A value is required for route parameter '${i.name}' in route '${t}'.`)}else o+="/",o+=h}"/"!==o.charAt(0)&&(o=`/${o}`);for(const t in r)Reflect.deleteProperty(e,t);const l=buildQueryString(e);return o+(l?`?${l}`:"")}ts(t){let s=[this.Kt],i={},h=0,e=t;const n=e.indexOf("?");if(-1!==n){const t=e.slice(n+1);e=e.slice(0,n),i=parseQueryString(t)}"/"!==(e=decodeURI(e)).charAt(0)&&(e=`/${e}`);let r=e.length;r>1&&"/"===e.charAt(r-1)&&(e=e.slice(0,-1),h=1,--r);for(let t=0;r>t;++t){const i=[],h=e.charAt(t);if(s.forEach(t=>{t.Ut.forEach(t=>{null!==t.qt.Ft?-1!==t.qt.Ft.indexOf(h)&&i.push(t):null!==t.qt.Dt&&-1===t.qt.Dt.indexOf(h)&&i.push(t)})}),0===(s=i).length)break}const o=[];for(let t=0,i=s.length;i>t;t++)s[t].xt&&o.push(s[t]);o.sort((t,s)=>{if(t.types.It!==s.types.It)return t.types.It-s.types.It;if(t.types.It){if(t.types.At!==s.types.At)return s.types.At-t.types.At;if(t.types.Tt!==s.types.Tt)return s.types.Tt-t.types.Tt}return t.types.Tt!==s.types.Tt?t.types.Tt-s.types.Tt:t.types.At!==s.types.At?s.types.At-t.types.At:0});const l=o[0];if(l&&l.xt){h&&"(.+)$"===l.Mt.source.slice(-5)&&(e=`${e}/`);const t=e.match(l.Mt);let s=1;const n=[];return n.ss=i,l.xt.forEach(i=>{const h={};i.names.forEach(name=>{h[name]=t[s++]}),n.push(new a(i.ht,h,i.names.length>0))}),n}}});class m{constructor(router,name,t,s,i,h,e){this.router=router,this.name=name,this.hs=t,this.context=s,this.es=i,this.scope=h,this.options=e,this.clear=0,this.content=null,this.ns=null,this.i=null,this.rs=null,this.os=null,this.ls=null,this.component=null,this.cs=null,this.as=null,this.us=null,this.fs=0}ds(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.Rt.clear)this.clear=1,t=null;else{const s=t.split(this.router.Rt.i);t=s.shift(),i=s.length?s.join(this.router.Rt.i):null,this.context&&(t=this.ps(t))}return this.ns=t,this.ls=s,this.rs=i,this.fs=0,"string"==typeof t&&this.vs(this.content)!==t||"string"!=typeof t&&this.content!==t||this.i!==i||!this.os||this.os.J!==s.J||s.j?1:0}ws(t,s,i){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.hs&&(this.scope.hs=t),this.hs!==t&&(this.us=Object.assign({},this),this.ms(),this.hs=t,i&&i.gs&&(this.options.gs=i.gs),i&&i.default&&(this.options.default=i.default),i&&i.ys&&(this.options.ys=i.ys),i&&i.$s&&(this.options.$s=i.$s),this.as&&this.as()),this.context!==s&&(this.context=s),this.component||this.cs||!this.options.default||this.router.bs(this,this.options.default)}remove(t,s){return this.hs===t&&this.context===s}async Es(){if(!this.component)return 1;const component=this.component;return component.Es?component.Es(this.os,this.ls):1}async Cs(){if(this.clear)return 1;if(!this.ns)return 0;if(await this.loadComponent(this.ns),!this.cs)return 0;const component=this.cs;return component.Cs?component.Cs(this.ls,this.os):1}async Rs(){if(this.clear)return 1;if(!this.cs)return 0;if(this.cs.Rs){const t=(function(t,i,h){const e=s(i),n=s(t),r=Object.assign({},e.i,n.i),o=[...e.list,...n.list];if(o.length&&h&&h.length)for(const t of h)r[t]=o.shift();let l;return o.length&&Object.keys(r).length&&(r["Ss"]=o.splice(0,o.length)),{Os:r,ks:o,Ps:l=o.length?o:r}})(this.rs,this.ls.J,this.ns.i);this.ls.i=t.Os,this.ls.ks=t.ks,await this.cs.Rs(t.Ps,this.ls,this.os),this.fs=0}return this.js(this.cs),1}async Hs(){return this.component&&(this.component.Vs&&await this.component.Vs(this.os,this.ls),this.cs||(this.Ns(this.component),this.xs(this.component),this.As(this.component))),this.cs&&(this.component&&(this.Ns(this.component),this.xs(this.component),this.As(this.component)),this.addComponent(this.cs),this.content=this.ns,this.i=this.rs,this.os=this.ls,this.component=this.cs),this.clear&&(this.content=this.i=this.component=null,this.os=this.ls),this.ns=this.rs=this.ls=this.cs=null,1}Ts(){this.us=null}async Is(){this.fs&&await this.cs.Vs(),this.us&&Object.assign(this,this.us)}description(t=0){if(this.content){const component=this.vs(this.content),s=this.scope?this.router.Rt.zs:"",i=this.i?this.router.Rt.i+this.i:"";if(t||s.length||this.options.Ls)return`${component}${this.router.Rt.viewport}${this.name}${s}${i}`;const h={};return h[component]=component,this.es.Ds(h)?`${component}${i}`:`${component}${this.router.Rt.viewport}${this.name}${s}${i}`}}Fs(t=0){return[this.es.Js(t),this.description(t)].filter(value=>value&&value.length).join(this.router.Rt.scope)}qs(component){let t=this.options.gs||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}Us(component){if("-"===component||null===component)return 1;let t=this.options.gs;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}_s(t){this.component&&this.component.Bs(t)}Gs(t){this.component&&this.component.Ms(t)}Ws(t){this.component&&this.component.Ks(t)}Qs(t){this.component&&this.component.Xs(t)}vs(component){return null===component?null:"string"==typeof component?component:component.description.name}ps(component){if(null===component)return null;if("string"!=typeof component)return component;{const t=this.context||this.router.vt,s=t.get(IContainer).Ys(CustomElementResource.Zs(component));return null!==s?s.si(t.get(IContainer)).ti:null}}ii(component){if(null===component)return null;component=this.vs(component);const t=this.context||this.router.vt;return"string"!=typeof component?t.get(IContainer).get(component):t.get(IContainer).get(CustomElementResource.Zs(component))}ms(){this.options={},this.content=null,this.i=null,this.os=null,this.component=null}async loadComponent(component){await this.hi(),this.cs=this.ii(component),this.cs.ei(LifecycleFlags.yt,this.context||this.router.vt,this.hs)}As(component){}js(component){component.Bs(LifecycleFlags.ni|LifecycleFlags.ri,null)}xs(component){component.Xs(LifecycleFlags.oi|LifecycleFlags.li)}addComponent(component){component.Ms(LifecycleFlags.ni)}Ns(component){component.Ks(LifecycleFlags.oi)}async hi(){return this.hs?Promise.resolve():new Promise(t=>{this.as=t})}}t("Viewport",m);class Scope{constructor(router,t,s,i){this.router=router,this.hs=t,this.context=s,this.parent=i,this.viewport=null,this.children=[],this.ci={},this.ai={},this.ui=null,this.parent&&this.parent.fi(this)}Ds(t){const s=[];let i=0;t&&(this.ui={},this.ai={}),this.ui=Object.assign({},this.ci,this.ui);for(const s in t){const parts=s.split(this.router.Rt.scope),t=parts.shift();this.ai[t]||(this.ai[t]=[]),this.ai[t].push(parts)}for(const h in this.ai){const e=h.split(this.router.Rt.i),component=e.shift().split(this.router.Rt.viewport).shift(),n=component+(e.length?this.router.Rt.i+e.join(this.router.Rt.i):"");for(const name in this.ui){const e=this.ui[name];if(e&&e.qs(component)){const r=this.di(t,this.ai,h,n,e);s.push(...r.pi),i=i||r.vi,this.ui[name]=null,Reflect.deleteProperty(this.ai,h);break}}}for(const h in this.ai){const e=h.split(this.router.Rt.i),parts=e.shift().split(this.router.Rt.viewport),component=parts.shift(),n=component+(e.length?this.router.Rt.i+e.join(this.router.Rt.i):"");let name=parts.shift();if(!name||!name.length||name.startsWith("?"))continue;let r=0;name.endsWith(this.router.Rt.zs)&&(r=1,name=name.substring(0,name.length-1)),this.ci[name]||(this.wi(name,null,null,{scope:r,Ls:1}),this.ui[name]=this.ci[name]);const o=this.ui[name];if(o&&o.Us(component)){const e=this.di(t,this.ai,h,n,o);s.push(...e.pi),i=i||e.vi,this.ui[name]=null,Reflect.deleteProperty(this.ai,h)}}for(const h in this.ai){const e=h.split(this.router.Rt.i),component=e.shift().split(this.router.Rt.viewport).shift(),n=component+(e.length?this.router.Rt.i+e.join(this.router.Rt.i):""),r=[];for(const name in this.ui){const t=this.ui[name];t&&t.Us(component)&&r.push(t)}if(1===r.length){const e=r.shift(),o=this.di(t,this.ai,h,n,e);s.push(...o.pi),i=i||o.vi,this.ui[e.name]=null,Reflect.deleteProperty(this.ai,h);break}}if(i=i||Object.keys(this.ai).length>0,!t)for(const t of this.children){const h=t.Ds();s.push(...h.pi),i=i||h.vi}return{pi:s,vi:i}}di(t,s,i,component,h){const e=[{component,viewport:h}];let n=0;if(s[i].length){const r=h.scope||h.es;for(const h of s[i])if(h.length){const s=h.join(this.router.Rt.scope),o={};o[s]=t[i+this.router.Rt.scope+s];const l=r.Ds(o);e.push(...l.pi),n=n||l.vi}}return{pi:e,vi:n}}wi(name,t,s,i){let h=this.ci[name];if(!h){let e;i.scope&&(e=new Scope(this.router,t,s,this),this.router.mi.push(e)),h=this.ci[name]=new m(this.router,name,t,s,this,e,i)}return(t||s)&&h.ws(t,s,i),h}gi(t,s,i){return(!s&&!i||t.remove(s,i))&&(t.scope&&this.router.yi(t.scope),Reflect.deleteProperty(this.ci,t.name)),Object.keys(this.ci).length}yi(){for(const t of this.children)t.yi();for(const t in this.ci)this.router.gi(this.ci[t],null,null)}$i(t){return t.Cs().then(()=>t.Hs())}fi(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}bi(t=0,s=0){const i=[];for(const h in this.ci){const e=this.ci[h];(e.options.$s||e.options.ys&&!t)&&!s||i.push(e.Fs(t))}for(const s of this.children)i.push(...s.bi(t));return i.filter(value=>value&&value.length)}Ei(){const t=[];for(const s in this.ci)t.push(this.ci[s]);for(const s of this.children)t.push(...s.Ei());return t}Js(t=0){if(!this.hs||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent.Ci(this.context.get(IContainer).parent);for(;i&&i.es===this.parent;)s.unshift(i.description(t)),i=this.Ci(i.context.get(IContainer).parent);return s.unshift(this.parent.Js(t)),s.filter(value=>value&&value.length).join(this.router.Rt.scope)}Ci(t){const s=Object.values(this.ci);for(;t;){const i=s.find(s=>s.context.get(IContainer)===t);if(i)return i;t=t.parent}return null}}t("Scope",Scope);class g{constructor(t){this.vt=t,this.ci={},this.mi=[],this.Ri={},this.St=[],this.Si=[],this.B=0,this.Oi=0,this.ki=[],this.Pi=null,this.ji=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substring(1)),!s.startsWith("/")){const i=this.Hi(t.anchor).Js();i&&(s=`/${i}${this.Rt.scope}${s}`)}this.Vi.tt(s)}),this.Vi=new h,this.Ni=new e}G(t){if(this.B)throw Error("Router has already been activated.");return this.B=1,this.options=Object.assign({U:t=>{this.xi(t)}},t),this.Rt=Object.assign({viewport:"@",Pt:"+",scope:"/",zs:"!",i:"=",add:"+",clear:"-",action:"."},this.options.Rt),this.Ni.G({U:this.ji}),this.Vi.G(this.options).catch(t=>{throw t})}W(){if(!this.B)throw Error("Router has not been activated.");this.Ni.W(),this.Vi.W()}xi(t){this.ki.push(t),this.Ai().catch(t=>{throw t})}async Ai(){if(null!==this.Pi||!this.ki.length)return Promise.resolve();const t=this.ki.shift();if(this.Pi=t,this.options.Ti&&this.options.Ti(t),t.k)return this.Pi=null,Promise.resolve();let i=0,h=0;(t.L||t.I)&&t.F&&(t.path=t.F,h=1);let e=t.path;this.options.Ii&&!h&&(e=this.options.Ii(e,this),Array.isArray(e)&&(e=this.zi(e))),(e===this.Rt.clear||e.startsWith(this.Rt.clear+this.Rt.add))&&(i=1,e.startsWith(this.Rt.clear)&&(e=e.substring(1)));const n=s(t.J);t.i=n.i,t.ks=n.list;const r=this.Li(e);if(!r&&!Object.keys(r).length&&!i)return this.Pi=null,Promise.resolve();this.Di();const o=i?this.Fi.Ei().filter(value=>null!==value.component):[],l=this.Fi.Ei().filter(value=>value.options.default&&null===value.component),c=[];let{pi:a,vi:u}=this.Fi.Ds(r),f=100;for(;a.length||u||l.length;){if(!f--)throw Error("Failed to resolve all viewports");const s=[];for(const i of a){const{component,viewport:h}=i;h.ds(component,t)&&s.push(h);const e=o.findIndex(value=>value===h);0>e||o.splice(e,1);const n=l.findIndex(value=>value===h);0>n||l.splice(n,1)}for(const i of o)i.ds(this.Rt.clear,t)&&s.push(i);let i;for(;i=l.shift();)i.ds(i.options.default,t)&&s.push(i);!s.length&&this.Oi&&(this.Vi.cancel(),this.Oi=0);let h=await Promise.all(s.map(value=>value.Es()));if(h.findIndex(value=>0==value)>=0)return this.Vi.cancel(),this.Pi=null,Promise.resolve();if((h=await Promise.all(s.map(async value=>{const t=await value.Cs();return"boolean"==typeof t?t?value.Rs():0:1}))).some(t=>0==t))return this.Vi.cancel(),this.Pi=null,Promise.resolve();await Promise.all(s.map(value=>value.Hs())),c.push(...s);const e=this.Fi.Ds();let n;for(a=[];n=this.Si.shift();)e.pi.find(value=>value.viewport===n.viewport)||a.push(n);a=[...a,...e.pi],u=e.vi}this.Ji(t),!t.D&&c.every(t=>t.options.$s)&&this.Vi.pop().catch(t=>{throw t}),c.forEach(t=>{t.Ts()}),this.Pi=null,this.ki.length&&this.Ai().catch(t=>{throw t})}bs(t,component){this.Pi&&this.Si.push({viewport:t,component})}Li(t){const s={};t.startsWith("/")&&(t=t.substring(1));const i=t.split(this.Rt.Pt);let h=0;for(;i.length;){const t=i.shift().split(this.Rt.scope),parts=t.pop().split(this.Rt.viewport),component=parts[0];t.push(parts.length?parts.join(this.Rt.viewport):`?${h++}`);const name=t.join(this.Rt.scope);component&&(s[name]=component)}return s}qi(t){return this.Di(),this.Hi(t)}wi(name,t,s,i){return this.qi(t).wi(name,t,s,i)}gi(t,s,i){const h=t.es;h.gi(t,s,i)||this.yi(h)}yi(t){if(t!==this.Fi){t.yi();const s=this.mi.indexOf(t);0>s||this.mi.splice(s,1)}}K(t,s,i){"string"==typeof t&&this.Vi.K(t,s,i)}replace(t,s,i){"string"==typeof t&&this.Vi.replace(t,s,i)}refresh(){this.Vi.refresh()}back(){this.Vi.back()}forward(){this.Vi.forward()}zi(t){const s=[];for(const i of t){let t=i.component;if(i.viewport&&(t+=this.Rt.viewport+i.viewport),i.i)for(const s in i.i)t+=this.Rt.i+i.i[s];s.push(t)}return s.join(this.Rt.Pt)}Ui(t){const s=[],i=t.split(this.Rt.Pt);for(const t of i){let component,i,h;const[e,n]=t.split(this.Rt.viewport);void 0===n?[component,h]=e.split(this.Rt.i):(component=e,[i,h]=n.split(this.Rt.i));const r={component};i&&(r.viewport=i),h&&(r.i={id:h}),s.push(r)}return s}_i(name,t){const s=this.Bi(name);s&&(s.jt=[]),this.Gi(name,t)}Gi(name,t){let s=this.Ri[name];s||(s=this.Ri[name]=new r(this,name)),s.Ht(t)}Bi(name){return this.Ri[name]}Di(){if(!this.Fi){const t=this.vt.get(Aurelia).root();this.Fi=new Scope(this,t.Mi,t.$context,null),this.mi.push(this.Fi)}}Hi(t){let s=(function(t){for(;t&&!t.$customElement;)t=t.parentElement;return t})(t).$customElement.$context.get(IContainer);for(;s;){const t=this.mi.find(t=>t.context.get(IContainer)===s);if(t)return t;s=s.parent}}Wi(t){let s=t.slice().sort((t,s)=>s.split(this.Rt.scope).length-t.split(this.Rt.scope).length),i=[];if((s=s.map(value=>`${this.Rt.scope}${value}${this.Rt.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.Rt.scope).length-s.split(this.Rt.scope).length),i}Ji(t){this.St=this.Fi.bi(1,1),this.St=this.Wi(this.St);let s=this.Fi.bi(),i=(s=this.Wi(s)).join(this.Rt.Pt);this.options.Ki&&(i=this.options.Ki(this.Ui(i),this));let h=this.Fi.bi(1);(h=this.Wi(h)).unshift(this.Rt.clear);const e=t.J&&t.J.length?`?${t.J}`:"";this.Vi.Z(i+e,h.join(this.Rt.Pt)+e,t)}}t("Router",g),g.inject=[IContainer];class y{constructor(router,t,s){this.router=router,this.hs=t,this.Qi=s,this.name="default",this.scope=null,this.gs=null,this.default=null,this.ys=null,this.$s=null,this.viewport=null}Xi(t,host,parts,s){const i=this.constructor,dom=s.get(IDOM),template=this.Qi.Yi(dom,i.description,s,i);template.Zi=createRenderContext(dom,s,i.description.dependencies,i),template.Xi(this,host,parts)}bound(){const t={scope:this.hs.hasAttribute("scope")};this.gs&&this.gs.length&&(t.gs=this.gs),this.default&&this.default.length&&(t.default=this.default),this.hs.hasAttribute("no-link")&&(t.ys=1),this.hs.hasAttribute("no-history")&&(t.$s=1),this.viewport=this.router.wi(this.name,this.hs,this.$context,t)}th(){this.router.gi(this.viewport,this.hs,this.$context)}_s(t){this.viewport&&this.viewport._s(t)}Gs(t){this.viewport&&this.viewport.Gs(t)}Ws(t){this.viewport&&this.viewport.Ws(t)}Qs(t){this.viewport&&this.viewport.Qs(t)}}t("ViewportCustomElement",y),y.inject=[g,INode,IRenderingEngine],i([bindable],y.prototype,"name",void 0),i([bindable],y.prototype,"scope",void 0),i([bindable],y.prototype,"usedBy",void 0),i([bindable],y.prototype,"default",void 0),i([bindable],y.prototype,"noLink",void 0),i([bindable],y.prototype,"noHistory",void 0),CustomElementResource.sh({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> </div></template>'},y);let $=t("NavCustomElement",class{constructor(router){this.router=router,this.name=null,this.jt=null,this.level=0}get ih(){const t=this.router.Bi(this.name);return t?t.jt:[]}active(t){return"Active"}});i([bindable],$.prototype,"name",void 0),i([bindable],$.prototype,"routes",void 0),i([bindable],$.prototype,"level",void 0),$=t("NavCustomElement",i([inject(g,Element),customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],$))}}});
