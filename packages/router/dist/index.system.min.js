System.register("router",["@aurelia/kernel","@aurelia/runtime"],function(t){"use strict";var Reporter,PLATFORM,IContainer,buildQueryString,parseQueryString,inject,CustomElementResource,IObserverLocator,Aurelia,IDOM,createRenderContext,INode,IRenderingEngine,bindable,customElement;return{t:[function(t){Reporter=t.Reporter,PLATFORM=t.PLATFORM,IContainer=t.IContainer,buildQueryString=t.buildQueryString,parseQueryString=t.parseQueryString,inject=t.inject},function(t){CustomElementResource=t.CustomElementResource,IObserverLocator=t.IObserverLocator,Aurelia=t.Aurelia,IDOM=t.IDOM,createRenderContext=t.createRenderContext,INode=t.INode,IRenderingEngine=t.IRenderingEngine,bindable=t.bindable,customElement=t.customElement}],s(){function s(t){const s={},i=[];if(!t||!t.length)return{i:s,list:i};const h=t.replace("+"," ").split("&");for(const t of h){const h=t.split("="),e=decodeURIComponent(h.shift());if(!h.length){i.push(e);continue}const value=decodeURIComponent(h.shift());s[e]=value}return{i:s,list:i}}function i(t,s,i,h){var e,n,r=arguments.length,o=3>r?s:null===h?h=Object.getOwnPropertyDescriptor(s,i):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,s,i,h);else for(n=t.length-1;n>=0;n--)(e=t[n])&&(o=(3>r?e(o):r>3?e(s,i,o):e(s,i))||o);return r>3&&o&&Object.defineProperty(s,i,o),o}class h{constructor(){this.h=(async t=>this.o(this,"popstate",[t])),this.window=window,this.history=window.history,this.l=[],this.u=0,this.p=null,this.v=null,this.g=null,this.m=null}$(t){if(this.u)throw Reporter.error(2003);this.u=1,this.v=t,PLATFORM.C.add(this.S,this),this.window.addEventListener("popstate",this.h)}R(){this.window.removeEventListener("popstate",this.h),PLATFORM.C.remove(this.S,this),this.v=null,this.u=0}get length(){return this.history.length}get state(){return this.history.state}get O(){return this.history.O}async go(t,s=0){if(!s)return this.o(this,"_go",[t],1);const i=this.o(this,"suppressPopstate",[],1);return this.o(this.history,"go",[t]).catch(t=>{throw t}),i}back(){return this.go(-1)}forward(){return this.go(1)}async pushState(t,s,i){return this.o(this.history,"pushState",[t,s,i])}async replaceState(t,s,i){return this.o(this.history,"replaceState",[t,s,i])}async V(t){if(this.m){const t=this.m;this.m=null,t()}else{if(this.g){const t=this.g;this.g=null,t(),await Promise.resolve()}this.v(t)}}P(t,s){this.g=s,this.history.go(t)}k(t){this.m=t}o(t,s,i,h=0){let e;const n=new Promise(t=>{e=t});return h&&(i.push(e),e=null),this.l.push({target:t,H:s,i,resolve:e}),n}async S(t){if(!this.l.length||null!==this.p)return;this.p=this.l.shift();const s=this.p.target[this.p.H];Reporter.write(1e4,"DEQUEUE",this.p.H,this.p.i),s.apply(this.p.target,this.p.i);const i=this.p.resolve;this.p=null,i&&i()}}t("QueuedBrowserHistory",h);class e{constructor(){this.j=(async()=>{if(null!==this.N){Reporter.write(1e4,"=== ignore path change",this.A());const t=this.N;return this.N=null,void t()}const t=this.A(),s=this.I();Reporter.write(1e4,"path changed to",t,this.T,this.q);const i={};let h,e=this.D("HistoryEntry");if(this.T&&this.T.path===t){i.L=1;const t=this.U?this.q.index:this.history.length-this._;h=this.q,this.q=this.T,this.q.index=t,this.U?(this.J=0,this.B[this.q.index]=this.q,this.F?(i.G=1,this.F=0):this.M?(i.W=1,this.M=0):i.K=1,this.U=0):(this.J=1,this.B=this.B.slice(0,this.q.index),this.B.push(this.q)),await this.X({Y:this.B,Z:this._,tt:this.q})}else this.B=this.B||this.D("HistoryEntries")||[],this._=this._||this.D("HistoryOffset")||0,e||this.q?e?this.q?e.index>this.q.index?i.st=1:this.q.index>e.index&&(i.it=1):i.W=1:i.L=1:(i.L=1,i.ht=1,this._=this.history.length),e||(e={path:t,et:null,index:this.history.length-this._,nt:s},i.ht&&(e.rt=1),this.B=this.B.slice(0,e.index),this.B.push(e),await this.X({Y:this.B,Z:this._,tt:e})),this.J=this.q?e.index-this.q.index:0,h=this.q,this.q=e,this.F&&(i.G=1,this.F=0);this.T=null,this.ot&&this.ot--,Reporter.write(1e4,"navigated",this.D("HistoryEntry"),this.B,this.D("HistoryOffset")),this.v(this.q,i,h)}),this.location=window.location,this.history=new h,this.q=null,this.B=null,this._=null,this.lt=null,this.T=null,this.options=null,this.u=0,this.J=null,this.ot=null,this.F=0,this.U=0,this.M=0,this.N=null}$(t){if(this.u)throw Reporter.error(0);return this.u=1,this.options=Object.assign({},t),this.history.$(this.j),Promise.resolve().then(()=>{this.ct(this.A(),1).catch(t=>{throw t})})}R(){this.history.R(),this.u=0}at(t,s,i){return this.T={path:t,et:null,title:s,data:i},this.ct(t)}replace(t,s,i){return this.U=1,this.T={path:t,et:null,title:s,data:i},this.ct(t,1)}ut(t,s,i){return this.ot=this.J+1,this.replace(t,s,i)}async refresh(){if(this.q)return this.M=1,this.replace(this.q.path,this.q.title,this.q.data)}back(){return this.history.go(-1)}forward(){return this.history.go(1)}cancel(){this.F=1;const t=this.J||this.ot;return t?this.history.go(-t):this.replace(this.lt.path,this.lt.title,this.lt.data)}async pop(){let t,s=new Promise(t=>{this.N=t});await this.history.go(-1),await s;const i=""+this.location;if(!(t=this.history.state).tt.rt)return s=new Promise(t=>{this.N=t}),await this.history.go(-1),await s,this.history.pushState(t,null,i)}async X(t,value){const{pathname:s,search:i,hash:h}=this.location;let e=Object.assign({},this.history.state);return"string"==typeof t?e[t]=JSON.parse(JSON.stringify(value)):e=Object.assign({},e,JSON.parse(JSON.stringify(t))),this.history.replaceState(e,null,`${s}${i}${h}`)}D(t){return Object.assign({},this.history.state)[t]}ft(t){return this.q.title=t,this.B[this.q.index]=this.q,this.X({Y:this.B,tt:this.q})}pt(t,s,i){if(i.index!==this.q.index)return;const h=`#/${t}`,{pathname:e,search:n,hash:r}=this.location;if(h===r&&this.q.path===t&&this.q.et===s)return;this.q.path=t,this.q.et=s;const o=Object.assign({},this.history.state,{tt:this.q,Y:this.B});return this.history.replaceState(o,null,`${e}${n}${h}`)}wt(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get dt(){return this.B?this.B.slice(0,this.q.index+1).map(value=>value.title):[]}A(){return this.location.hash.substring(1).split("?")[0]}async ct(t,s=0){if(this.q&&this.q.path===t&&!this.M)return;const{pathname:i,search:h}=this.location,e=`#${t}`;return s?(this.lt=this.q,await this.history.replaceState({},null,`${i}${h}${e}`)):await this.history.pushState({},null,`${i}${h}${e}`),this.j()}I(){const t=this.location.hash.substring(1).split("?");return t.shift(),t.length>0?t.shift():""}v(t,s,i){const h=Object.assign({},t,s);h.vt=i,Reporter.write(1e4,"callback",t,s),this.options.v&&this.options.v(h)}}t("HistoryBrowser",e);class n{constructor(){this.u=0,this.gt=(t=>{const s=n.yt(t);s.$t&&(t.preventDefault(),this.options.v(s))}),this.document=document}static yt(t){const s={$t:0,href:null,anchor:null},i=n.bt(t.target);if(!i||!n.Ct(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const h=i.getAttribute("href");return s.anchor=i,s.href=h,s.$t=1===t.which,s}static bt(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static Ct(t){const s=t.getAttribute("target");return!s||s===n.window.name||"_self"===s}$(t){if(this.u)throw Reporter.error(2004);this.u=1,this.options=Object.assign({},t),this.document.addEventListener("click",this.gt,1)}R(){this.document.removeEventListener("click",this.gt,1),this.u=0}}t("LinkHandler",n);class r{constructor(component,t,s){this.initialize(component,t,s)}initialize(component,t,s){"string"==typeof component?(this.St=component,this.component=null):(this.component=component,this.St=component.description.name),"string"==typeof t?(this.Et=t,this.viewport=null):(this.viewport=t,t&&(this.Et=t.name)),"string"==typeof s?(this.Rt=s,this.i={id:s}):this.i=s}Ot(t){if(null!==this.component)return this.component;const s=t.get(IContainer),i=s.Vt(CustomElementResource.Pt(this.St));return null!==i?i.Ht(s).kt:null}jt(router){return null!==this.viewport?this.viewport:router.Nt()[this.Et]}At(t,s=0,i=0){return s&&this.Rt!==t.Rt?0:i?this.component===t.component:this.St===t.St}}class o{constructor(t,s){this.active="",this.It=t,Object.assign(this,{title:s.title,children:null,Tt:s.Tt,active:""}),this.instructions=this.xt(s.zt),this.link=this.qt(this.instructions),this.Dt=s.Lt?this.qt(this.xt(s.Lt)):this.link,this.Ut=this.It.router._t.get(IObserverLocator),this.Jt=this.Ut.Bt(0,this.It.router,"activeComponents"),this.Jt.subscribe(this)}get Ft(){return this.children&&this.children.length?"nav-has-children":""}Gt(){this.active=this.link&&this.link.length?this.Qt():"nav-active"===this.active?"nav-active":this.Mt()?"nav-active-child":""}Qt(){const t=this.It.router.Kt.Wt(this.Dt),s=this.It.router.Xt.map(t=>this.It.router.Kt.Yt(t));for(const component of t)if(!s.find(t=>t.At(component)))return"";return"nav-active"}Zt(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}qt(instructions){return this.It.router.Kt.ts(instructions)}xt(t){if(!Array.isArray(t))return this.xt([t]);const instructions=[];for(const s of t)instructions.push("string"==typeof s?this.It.router.Kt.Yt(s):s instanceof r?s:s.component?new r(s.component,s.viewport,s.i):new r(s));return instructions}Mt(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.Mt())return 1;return 0}}class l{constructor(router,name){this.router=router,this.name=name,this.ss=[]}hs(t){for(const s of t)this.es(this.ss,s)}es(t,s){const i=new o(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.es(i.children,t)}}}t("Nav",l);class c{constructor(t,s){this.gt=t,this.names=s}}t("HandlerEntry",c);class a{constructor(t,s){this.ns=t,this.rs=s}}t("RouteGenerator",a);class u{constructor(){this.os=0,this.ls=0,this.cs=0}}t("TypesRecord",u);class f{constructor(t,s,i){this.gt=t,this.as=s,this.us=i}}t("RecognizeResult",f);class p{constructor(t,s,i){this.fs=t,this.ps=s,this.repeat=i}ws(t){return this.ps===t.ps&&this.fs===t.fs}}t("CharSpec",p);class State{constructor(t){this.ds=t,this.vs=[]}put(t){let s=this.vs.find(s=>s.ds.ws(t));return void 0===s&&(s=new State(t),this.vs.push(s),t.repeat&&s.vs.push(s)),s}}t("State",State);const w=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g;class d{constructor(t,s){this.name=t,this.gs=t,this.ms=s,this.optional=0}ys(t){const s=this.gs,i=s.length;let h=0,e="";if(this.ms)for(;i>h;++h)e=s.charAt(h),t(new p(null,e,0));else for(;i>h;++h)e=s.charAt(h),t(new p(null,e.toUpperCase()+e.toLowerCase(),0))}$s(){return this.gs.replace(w,"\\$1")}bs(t,s){return this.gs}}t("StaticSegment",d);class v{constructor(name,optional){this.name=name,this.optional=optional}ys(t){t(new p("/",null,1))}$s(){return"([^/]+)"}bs(t,s){return s[this.name]=1,t[this.name]}}t("DynamicSegment",v);class g{constructor(name){this.name=name,this.optional=0}ys(t){t(new p("",null,1))}$s(){return"(.+)"}bs(t,s){return s[this.name]=1,t[this.name]}}t("StarSegment",g);class m{ys(t){}$s(){return""}bs(t,s){return""}}t("EpsilonSegment",m),t("RouteRecognizer",class{constructor(){this.Cs=new State,this.names={},this.ss=new Map}add(t){if(Array.isArray(t))return void t.forEach(t=>{this.add(t)});let s=this.Cs;const i=[];let h="^";const e=new u,n=[],r=t.gt.name;let o=1,l=t.path;"/"===l.charAt(0)&&(l=l.slice(1));const f=[],w=l.split("/");let y,$;for(let r=0,l=w.length;l>r;++r){let l=(y=w[r]).match(/^:([^?]+)(\?)?$/);if(l){const[,name,optional]=l;if(-1!==name.indexOf("="))throw Error(`Parameter ${name} in route ${t} has a default value, which is not supported.`);f.push($=new v(name,!!optional)),n.push(name),e.ls++}else if(l=y.match(/^\*(.+)$/))f.push($=new g(l[1])),n.push(l[1]),e.cs++;else{if(""===y){f.push(new m);continue}f.push($=new d(y,t.ms)),e.os++}const c=s.put(new p(null,"/",0));let a=c;$.ys(t=>{a=a.put(t)});for(let t=0,s=i.length;s>t;t++)i[t].vs.push(c);$.optional?(i.push(a),h+=`(?:/${$.$s()})?`):(s=a,h+=`/${$.$s()}`,i.length=0,o=0)}o&&(s=s.put(new p(null,"/",0)),h+="/?");const b=[new c(t.gt,n)];if(this.ss.set(t.gt,new a(f,b)),r){const t=Array.isArray(r)?r:[r];for(let s=0;t.length>s;s++)t[s]in this.names||(this.names[t[s]]=new a(f,b))}for(let s=0;i.length>s;s++){const n=i[s];n.rs=b,n.$s=RegExp(`${h}$`,t.ms?"":"i"),n.types=e}return s.rs=b,s.$s=RegExp(`${h}$`,t.ms?"":"i"),s.types=e,s}Ss(t){return"string"==typeof t?this.names[t]:this.ss.get(t)}Es(t){const s=this.Ss(t);if(!s)throw Error(`There is no route named ${t}`);return[...s.rs]}Rs(t){return!!this.Ss(t)}bs(t,s){const i=this.Ss(t);if(!i)throw Error(`There is no route named ${t}`);const h=i.rs[0].gt;if(h.Os)return h.href;const e=Object.assign({},s),n=i.ns,r={};let o="";for(let s=0,i=n.length;i>s;s++){const i=n[s];if(i instanceof m)continue;const h=i.bs(e,r);if(null==h){if(!i.optional)throw Error(`A value is required for route parameter '${i.name}' in route '${t}'.`)}else o+="/",o+=h}"/"!==o.charAt(0)&&(o=`/${o}`);for(const t in r)Reflect.deleteProperty(e,t);const l=buildQueryString(e);return o+(l?`?${l}`:"")}Vs(t){let s=[this.Cs],i={},h=0,e=t;const n=e.indexOf("?");if(-1!==n){const t=e.slice(n+1);e=e.slice(0,n),i=parseQueryString(t)}"/"!==(e=decodeURI(e)).charAt(0)&&(e=`/${e}`);let r=e.length;r>1&&"/"===e.charAt(r-1)&&(e=e.slice(0,-1),h=1,--r);for(let t=0;r>t;++t){const i=[],h=e.charAt(t);if(s.forEach(t=>{t.vs.forEach(t=>{null!==t.ds.ps?-1!==t.ds.ps.indexOf(h)&&i.push(t):null!==t.ds.fs&&-1===t.ds.fs.indexOf(h)&&i.push(t)})}),0===(s=i).length)break}const o=[];for(let t=0,i=s.length;i>t;t++)s[t].rs&&o.push(s[t]);o.sort((t,s)=>{if(t.types.cs!==s.types.cs)return t.types.cs-s.types.cs;if(t.types.cs){if(t.types.os!==s.types.os)return s.types.os-t.types.os;if(t.types.ls!==s.types.ls)return s.types.ls-t.types.ls}return t.types.ls!==s.types.ls?t.types.ls-s.types.ls:t.types.os!==s.types.os?s.types.os-t.types.os:0});const l=o[0];if(l&&l.rs){h&&"(.+)$"===l.$s.source.slice(-5)&&(e=`${e}/`);const t=e.match(l.$s);let s=1;const n=[];return n.Ps=i,l.rs.forEach(i=>{const h={};i.names.forEach(name=>{h[name]=t[s++]}),n.push(new f(i.gt,h,i.names.length>0))}),n}}});class y{$(t){this.ks=Object.assign({viewport:"@",Hs:"+",scope:"/",js:"!",i:"=",add:"+",clear:"-",action:"."},t.ks)}get Ns(){return this.ks.clear}Yt(t){let component,s,i;const[h,e]=t.split(this.ks.viewport);return void 0===e?[component,i]=h.split(this.ks.i):(component=h,[s,i]=e.split(this.ks.i)),new r(component,s,i)}As(t){let s=t.St;return t.Et&&(s+=this.ks.viewport+t.Et),t.Rt&&(s+=this.ks.i+t.Rt),s}Is(t,s){return t&&(s=`/${t}${this.ks.scope}${s}`),s}Ts(t){return{xs:t===this.ks.clear||t.startsWith(this.ks.clear+this.ks.add),zs:t.startsWith(this.ks.clear)?t.substring(1):t}}qs(t){const s={};t.startsWith("/")&&(t=t.substring(1));const i=t.split(this.ks.Hs);let h=0;for(;i.length;){const t=i.shift().split(this.ks.scope),parts=t.pop().split(this.ks.viewport),component=parts[0];t.push(parts.length?parts.join(this.ks.viewport):`?${h++}`);const name=t.join(this.ks.scope);component&&(s[name]=component)}return s}ts(instructions){const t=[];for(const s of instructions)t.push(this.As(s));return t.join(this.ks.Hs)}Wt(t){const instructions=[],s=t.split(this.ks.Hs);for(const t of s)instructions.push(this.Yt(t));return instructions}Ds(t){let s=t.slice().sort((t,s)=>s.split(this.ks.scope).length-t.split(this.ks.scope).length),i=[];if((s=s.map(value=>`${this.ks.scope}${value}${this.ks.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.ks.scope).length-s.split(this.ks.scope).length),i}Ls(t,s=0){const i=t.slice();return s&&i.unshift(this.Ns),i.join(this.ks.Hs)}}var $;(function(t){t[t.Us=0]="none",t[t.loaded=1]="loaded",t[t._s=2]="initialized",t[t.Js=3]="entered",t[t.Bs=4]="added"})($||($={}));class b{constructor(t=null,s=null,i=null,h=null){this.content=t,this.i=s,this.Fs=i,this.component=null,this.Gs=0,this.Qs=0,null!==this.content&&"string"==typeof this.content&&null!==h&&(this.content=this.Ot(h))}Ms(t){return"string"==typeof t.content&&this.St()!==t.content||"string"!=typeof t.content&&this.content!==t.content||this.i!==t.i||!this.Fs||this.Fs.nt!==t.Fs.nt}Ws(t){return("string"==typeof t.content&&this.St()===t.content||"string"!=typeof t.content&&this.content===t.content)&&this.i===t.i}loadComponent(t,s){return this.Qs||(this.component=this.Ks(t),this.component.Xs(0,t,s)),this.Gs=1,Promise.resolve()}Ys(){1===this.Gs&&(this.Gs=0)}Zs(){this.Qs||this.component.ti(2560,null),this.Gs=2}si(t=0){2===this.Gs&&(t||this.component.ii(5120),this.Gs=1)}addComponent(t){if(this.component.hi(512),this.Qs){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)if(t.hasAttribute("au-element-scroll")){const[s,i]=t.getAttribute("au-element-scroll").split(",");t.removeAttribute("au-element-scroll"),t.scrollTo(+i,+s)}}this.Gs=4}ei(t,s=0){if(4===this.Gs){if(s){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)(t.scrollTop>0||t.scrollLeft)&&t.setAttribute("au-element-scroll",`${t.scrollTop},${t.scrollLeft}`)}this.component.ni(1024),this.Gs=4}}async ri(t,s=0){switch(this.Gs){case 4:this.ei(t,s);case 3:this.component.oi&&await this.component.oi(),this.Gs=2;case 2:this.si(s);case 1:this.Ys()}this.Gs=0}St(){return null===this.content?null:"string"==typeof this.content?this.content:this.content.description.name}Ot(t){if(null===this.content)return null;if("string"!=typeof this.content)return this.content;{const s=t.get(IContainer),i=s.Vt(CustomElementResource.Pt(this.content));return null!==i?i.Ht(s).kt:null}}Ks(t){if(null===this.content)return null;const component=this.St();return t.get(IContainer).get("string"!=typeof component?component:CustomElementResource.Pt(component))}}class C{constructor(router,name,t,s,i,h,e){this.router=router,this.name=name,this.li=t,this.context=s,this.ci=i,this.scope=h,this.options=e,this.clear=0,this.content=new b,this.ai=null,this.ui=null,this.fi=null,this.cache=[],this.enabled=1}pi(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.Kt.Ns)this.clear=1,t=null;else{const s=t.split(this.router.Kt.ks.i);t=s.shift(),i=s.length?s.join(this.router.Kt.ks.i):null}if(this.ai=new b(t,i,s,this.context),this.options.wi){const t=this.cache.find(t=>this.ai.Ws(t));t?(this.ai=t,this.ai.Qs=1):this.cache.push(this.ai)}return this.content.Ms(this.ai)||s.W}di(t,s,i){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.li&&(this.scope.li=t),this.li!==t&&(this.fi=Object.assign({},this),this.vi(),this.li=t,i&&i.gi&&(this.options.gi=i.gi),i&&i.default&&(this.options.default=i.default),i&&i.mi&&(this.options.mi=i.mi),i&&i.yi&&(this.options.yi=i.yi),i&&i.wi&&(this.options.wi=i.wi),this.ui&&this.ui()),this.context!==s&&(this.context=s),this.content.component||this.ai&&this.ai.component||!this.options.default||this.router.$i(this.options.default,this)}remove(t,s){return this.li===t&&this.context===s?(this.content.component&&this.content.ri(this.li,this.options.wi).catch(t=>{throw t}),1):0}async bi(){if(!this.content.component)return 1;const component=this.content.component;return component.bi?(Reporter.write(1e4,"viewport canLeave",component.bi(this.content.Fs,this.ai.Fs)),component.bi(this.content.Fs,this.ai.Fs)):1}async Ci(){if(this.clear)return 1;if(!this.ai.content)return 0;if(await this.Si(),await this.ai.loadComponent(this.context,this.li),!this.ai.component)return 0;const component=this.ai.component;if(!component.Ci)return 1;const t=component.Ci(this.ai.Fs,this.content.Fs);return Reporter.write(1e4,"viewport canEnter",t),"boolean"==typeof t?t:"string"==typeof t?[new r(t,this)]:t}async Ei(){if(Reporter.write(1e4,"Viewport enter",this.name),this.clear)return 1;if(!this.ai.component)return 0;if(this.ai.component.Ei){const t=(function(t,i,h){const e=s(i),n=s(t),r=Object.assign({},e.i,n.i),o=[...e.list,...n.list];if(o.length&&h&&h.length)for(const t of h)r[t]=o.shift();let l;return o.length&&Object.keys(r).length&&(r["Ri"]=o.splice(0,o.length)),{Oi:r,Vi:o,Pi:l=o.length?o:r}})(this.ai.i,this.ai.Fs.nt,this.ai.content.i);this.ai.Fs.i=t.Oi,this.ai.Fs.Vi=t.Vi,await this.ai.component.Ei(t.Pi,this.ai.Fs,this.content.Fs),this.ai.Gs=3}return this.ai.Zs(),1}async ki(){return Reporter.write(1e4,"Viewport loadContent",this.name),this.content.component&&(this.content.component.oi&&await this.content.component.oi(this.content.Fs,this.ai.Fs),this.ai.component||(this.content.ei(this.li,this.options.wi),this.content.si(this.options.wi),this.content.Ys())),this.ai.component&&(this.content.component&&(this.content.ei(this.li,this.options.wi),this.content.si(this.options.wi),this.content.Ys()),this.ai.addComponent(this.li),this.content=this.ai),this.clear&&(this.content=new b(null,null,this.ai.Fs)),this.ai=null,1}Hi(){this.fi=null}async ji(){await this.ai.ri(this.li,this.options.wi),this.fi&&Object.assign(this,this.fi)}description(t=0){if(this.content.content){const component=this.content.St(),s=this.scope?this.router.Kt.ks.js:"",i=this.content.i?this.router.Kt.ks.i+this.content.i:"";if(t||s.length||this.options.Ni)return`${component}${this.router.Kt.ks.viewport}${this.name}${s}${i}`;const h={};return h[component]=component,this.ci.Ai(h)?`${component}${i}`:`${component}${this.router.Kt.ks.viewport}${this.name}${s}${i}`}}Ii(t=0){return[this.ci.Ti(t),this.description(t)].filter(value=>value&&value.length).join(this.router.Kt.ks.scope)}xi(component){let t=this.options.gi||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}zi(component){if("-"===component||null===component)return 1;let t=this.options.gi;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}qi(t){this.content.component&&this.content.Zs()}Di(t){Reporter.write(1e4,"ATTACHING viewport",this.name,this.content,this.ai),this.enabled=1,this.content.component&&this.content.addComponent(this.li)}Li(t){Reporter.write(1e4,"DETACHING viewport",this.name),this.content.component&&this.content.ei(this.li,this.options.wi),this.enabled=0}Ui(t){this.content.component&&this.content.si(this.options.wi)}vi(){this.options={},this.content=new b,this.cache=[]}async Si(){return this.li?Promise.resolve():new Promise(t=>{this.ui=t})}}t("Viewport",C);class Scope{constructor(router,t,s,i){this.router=router,this.li=t,this.context=s,this.parent=i,this.viewport=null,this.children=[],this._i=[],this.Ji={},this.Bi=null,this.parent&&this.parent.Fi(this)}Gi(){return this._i.filter(t=>t.enabled).reduce((t,s)=>(t[s.name]=s,t),{})}Ai(t){const s=[];let i=0;t&&(this.Bi={},this.Ji={}),this.Bi=Object.assign({},this.Gi(),this.Bi);for(const s in t){const parts=s.split(this.router.Kt.ks.scope),t=parts.shift();this.Ji[t]||(this.Ji[t]=[]),this.Ji[t].push(parts)}for(const h in this.Ji){const e=h.split(this.router.Kt.ks.i),component=e.shift().split(this.router.Kt.ks.viewport).shift(),n=component+(e.length?this.router.Kt.ks.i+e.join(this.router.Kt.ks.i):"");for(const name in this.Bi){const e=this.Bi[name];if(e&&e.xi(component)){const r=this.Qi(t,this.Ji,h,n,e);s.push(...r.Mi),i=i||r.Wi,this.Bi[name]=null,Reflect.deleteProperty(this.Ji,h);break}}}for(const h in this.Ji){const e=h.split(this.router.Kt.ks.i),parts=e.shift().split(this.router.Kt.ks.viewport),component=parts.shift(),n=component+(e.length?this.router.Kt.ks.i+e.join(this.router.Kt.ks.i):"");let name=parts.shift();if(!name||!name.length||name.startsWith("?"))continue;let r=0;name.endsWith(this.router.Kt.ks.js)&&(r=1,name=name.substring(0,name.length-1)),this.Gi()[name]||(this.Ki(name,null,null,{scope:r,Ni:1}),this.Bi[name]=this.Gi()[name]);const o=this.Bi[name];if(o&&o.zi(component)){const e=this.Qi(t,this.Ji,h,n,o);s.push(...e.Mi),i=i||e.Wi,this.Bi[name]=null,Reflect.deleteProperty(this.Ji,h)}}for(const h in this.Ji){const e=h.split(this.router.Kt.ks.i),component=e.shift().split(this.router.Kt.ks.viewport).shift(),n=component+(e.length?this.router.Kt.ks.i+e.join(this.router.Kt.ks.i):""),r=[];for(const name in this.Bi){const t=this.Bi[name];t&&t.zi(component)&&r.push(t)}if(1===r.length){const e=r.shift(),o=this.Qi(t,this.Ji,h,n,e);s.push(...o.Mi),i=i||o.Wi,this.Bi[e.name]=null,Reflect.deleteProperty(this.Ji,h);break}}if(i=i||Object.keys(this.Ji).length>0,!t)for(const t of this.children){const h=t.Ai();s.push(...h.Mi),i=i||h.Wi}return{Mi:s,Wi:i}}Qi(t,s,i,component,h){const e=[{component,viewport:h}];let n=0;if(s[i].length){const r=h.scope||h.ci;for(const h of s[i])if(h.length){const s=h.join(this.router.Kt.ks.scope),o={};o[s]=t[i+this.router.Kt.ks.scope+s];const l=r.Ai(o);e.push(...l.Mi),n=n||l.Wi}}return{Mi:e,Wi:n}}Ki(name,t,s,i){let h=this.Gi()[name];if(t&&h&&null!==h.li&&h.li!==t&&(h.enabled=0,(h=this._i.find(s=>s.name===name&&s.li===t))&&(h.enabled=1)),!h){let e;i.scope&&(e=new Scope(this.router,t,s,this),this.router.Xi.push(e)),h=new C(this.router,name,null,null,this,e,i),this._i.push(h)}return(t||s)&&h.di(t,s,i),h}Yi(t,s,i){return(!s&&!i||t.remove(s,i))&&(t.scope&&this.router.Zi(t.scope),this._i.splice(this._i.indexOf(t),1)),Object.keys(this._i).length}Zi(){for(const t of this.children)t.Zi();const t=this.Gi();for(const name in t)this.router.Yi(t[name],null,null)}th(t){return t.Ci().then(()=>t.ki())}Fi(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}sh(t=0,s=0){const i=[];for(const h in this.Gi()){const e=this.Gi()[h];(e.options.yi||e.options.mi&&!t)&&!s||i.push(e.Ii(t))}for(const s of this.children)i.push(...s.sh(t));return i.filter(value=>value&&value.length)}Nt(){const t=this._i.filter(t=>t.enabled);for(const s of this.children)t.push(...s.Nt());return t}Ti(t=0){if(!this.li||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent.ih(this.context.get(IContainer).parent);for(;i&&i.ci===this.parent;)s.unshift(i.description(t)),i=this.ih(i.context.get(IContainer).parent);return s.unshift(this.parent.Ti(t)),s.filter(value=>value&&value.length).join(this.router.Kt.ks.scope)}ih(t){const s=Object.values(this.Gi());for(;t;){const i=s.find(s=>s.context.get(IContainer)===t);if(i)return i;t=t.parent}return null}}t("Scope",Scope);class S{constructor(t){this._t=t,this.Xi=[],this.hh={},this.Xt=[],this.eh=[],this.u=0,this.nh=0,this.rh=[],this.oh=null,this.lh=null,this.ah=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substring(1)),!s.startsWith("/")){const i=this.uh(t.anchor).Ti();s=this.Kt.Is(i,s)}this.fh.wt(s)}),this.fh=new e,this.ph=new n,this.Kt=new y}get wh(){return null!==this.oh}$(t){if(this.u)throw Reporter.error(2001);return this.u=1,this.options=Object.assign({v:t=>{this.dh(t)}},t),this.Kt.$({ks:this.options.ks}),this.ph.$({v:this.ah}),this.fh.$(this.options).catch(t=>{throw t})}R(){if(!this.u)throw Reporter.error(2e3);this.ph.R(),this.fh.R()}dh(t){this.rh.push(t),this.vh().catch(t=>{throw t})}async vh(){if(null!==this.oh||!this.rh.length)return Promise.resolve();const t=this.rh.shift();if(this.oh=t,this.options.gh&&this.options.gh(t),t.G)return this.oh=null,this.vh();let i=0;(t.it||t.st)&&t.et&&(t.path=t.et,i=1);let h=t.path;this.options.mh&&!i&&(h=this.options.mh(h,this),Array.isArray(h)&&(h=this.Kt.ts(h)));const{xs:e,zs:n}=this.Kt.Ts(h);e&&(h=n);const r=s(t.nt);t.i=r.i,t.Vi=r.list;const o=this.Kt.qs(h);if(!o&&!Object.keys(o).length&&!e)return this.oh=null,this.vh();const l=e?this.Nt().filter(value=>null!==value.content.component):[],c=this.Nt().filter(value=>value.options.default&&null===value.content.component),a=[];let{Mi:u,Wi:f}=this.yh.Ai(o),p=100;for(;u.length||f||c.length;){if(!p--)throw Reporter.error(2002);const s=[];for(const i of u){const{component,viewport:h}=i;h.pi(component,t)&&s.push(h);const e=l.findIndex(value=>value===h);0>e||l.splice(e,1);const n=c.findIndex(value=>value===h);0>n||c.splice(n,1)}for(const i of l)i.pi(this.Kt.Ns,t)&&s.push(i);let i;for(;i=c.shift();)i.pi(i.options.default,t)&&s.push(i);if(!s.length&&this.nh){const i=this.$h([...s,...a],t);return this.nh=0,await this.vh(),i}let h=await Promise.all(s.map(value=>value.bi()));if(h.findIndex(value=>0==value)>=0)return this.$h([...s,...a],t);if((h=await Promise.all(s.map(async value=>{const t=await value.Ci();if("boolean"==typeof t)return t?value.Ei():0;for(const s of t)this.$i(s.component,s.viewport);return value.ji().catch(t=>{throw t}),1}))).some(t=>0==t))return this.$h([...s,...a],t);for(const t of s)a.find(value=>value===t)||a.push(t);const e=this.yh.Ai();let n;for(u=[];n=this.eh.shift();)e.Mi.find(value=>value.viewport===n.viewport)||u.push(n);u=[...u,...e.Mi],f=e.Wi}await Promise.all(a.map(value=>value.ki())),await this.bh(t),t.ht||t.Ch||!a.every(t=>t.options.yi)||await this.fh.pop(),a.forEach(t=>{t.Hi()}),this.lh=this.oh,this.lh.Ch&&(this.lh.Ch=0),this.oh=null,this.vh().catch(t=>{throw t})}$i(component,t){this.oh?("string"==typeof t&&(t=this.Nt().find(s=>s.name===t)),this.eh.push({viewport:t,component})):this.lh&&(this.rh.unshift({path:"",et:"",Ch:1}),this.vh().catch(t=>{throw t}))}Sh(t){return this.Eh(),this.uh(t)}Ki(name,t,s,i){return Reporter.write(1e4,"Viewport added",name,t),this.Sh(t).Ki(name,t,s,i)}Yi(t,s,i){const h=t.ci;h.Yi(t,s,i)||this.Zi(h)}Nt(){return this.Eh(),this.yh.Nt()}Zi(t){if(t!==this.yh){t.Zi();const s=this.Xi.indexOf(t);0>s||this.Xi.splice(s,1)}}at(t,s,i){if("string"==typeof t)return this.fh.at(t,s,i)}replace(t,s,i){if("string"==typeof t)return this.fh.replace(t,s,i)}refresh(){return this.fh.refresh()}back(){return this.fh.back()}forward(){return this.fh.forward()}Rh(name,t){const s=this.Oh(name);s&&(s.ss=[]),this.Vh(name,t)}Vh(name,t){let s=this.hh[name];s||(s=this.hh[name]=new l(this,name)),s.hs(t)}Oh(name){return this.hh[name]}async $h(t,s){t.forEach(t=>{t.ji().catch(t=>{throw t})}),s.L?await this.fh.pop():await this.fh.cancel(),this.oh=null,this.vh().catch(t=>{throw t})}Eh(){if(!this.yh){const t=this._t.get(Aurelia).root();this.yh=new Scope(this,t.Ph,t.$context,null),this.Xi.push(this.yh)}}uh(t){let s=(function(t){for(;t&&!t.$customElement;)t=t.parentElement;return t})(t).$customElement.$context.get(IContainer);for(;s;){const t=this.Xi.find(t=>t.context.get(IContainer)===s);if(t)return t;s=s.parent}}bh(t){this.Xt=this.yh.sh(1,1),this.Xt=this.Kt.Ds(this.Xt);let s=this.yh.sh();s=this.Kt.Ds(s);let i=this.Kt.Ls(s);this.options.kh&&(i=this.options.kh(this.Kt.Wt(i),this));let h=this.yh.sh(1);h=this.Kt.Ds(h);const e=t.nt&&t.nt.length?`?${t.nt}`:"";return this.fh.pt(i+e,this.Kt.Ls(h,1)+e,t)}}t("Router",S),S.inject=[IContainer];class E{constructor(router,t,s){this.router=router,this.li=t,this.Hh=s,this.name="default",this.scope=null,this.gi=null,this.default=null,this.mi=null,this.yi=null,this.wi=null,this.viewport=null}jh(t,host,parts,s){const i=this.constructor,dom=s.get(IDOM),template=this.Hh.Nh(dom,i.description,s,i);template.Ah=createRenderContext(dom,s,i.description.dependencies,i),template.jh(this,host,parts)}bound(){this.connect()}Ih(){this.disconnect()}connect(){const t={scope:this.li.hasAttribute("scope")};this.gi&&this.gi.length&&(t.gi=this.gi),this.default&&this.default.length&&(t.default=this.default),this.li.hasAttribute("no-link")&&(t.mi=1),this.li.hasAttribute("no-history")&&(t.yi=1),this.li.hasAttribute("stateful")&&(t.wi=1),this.viewport=this.router.Ki(this.name,this.li,this.$context,t)}disconnect(){this.router.Yi(this.viewport,this.li,this.$context)}qi(t){this.viewport&&this.viewport.qi(t)}Di(t){this.viewport&&this.viewport.Di(t)}Li(t){this.viewport&&this.viewport.Li(t)}Ui(t){this.viewport&&this.viewport.Ui(t)}}t("ViewportCustomElement",E),E.inject=[S,INode,IRenderingEngine],i([bindable],E.prototype,"name",void 0),i([bindable],E.prototype,"scope",void 0),i([bindable],E.prototype,"usedBy",void 0),i([bindable],E.prototype,"default",void 0),i([bindable],E.prototype,"noLink",void 0),i([bindable],E.prototype,"noHistory",void 0),i([bindable],E.prototype,"stateful",void 0),CustomElementResource.Th({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> </div></template>'},E);let R=t("NavCustomElement",class{constructor(router){this.router=router,this.name=null,this.ss=null,this.level=0}get xh(){const t=this.router.Oh(this.name);return t?t.ss:[]}active(t){return"Active"}});i([bindable],R.prototype,"name",void 0),i([bindable],R.prototype,"routes",void 0),i([bindable],R.prototype,"level",void 0),R=t("NavCustomElement",i([inject(S,Element),customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],R))}}});
