System.register("router",["@aurelia/kernel","@aurelia/runtime"],function(t){"use strict";var Reporter,PLATFORM,IContainer,buildQueryString,parseQueryString,DI,inject,CustomElementResource,IObserverLocator,Aurelia,IDOM,createRenderContext,INode,IRenderingEngine,bindable,customElement;return{t:[function(t){Reporter=t.Reporter,PLATFORM=t.PLATFORM,IContainer=t.IContainer,buildQueryString=t.buildQueryString,parseQueryString=t.parseQueryString,DI=t.DI,inject=t.inject},function(t){CustomElementResource=t.CustomElementResource,IObserverLocator=t.IObserverLocator,Aurelia=t.Aurelia,IDOM=t.IDOM,createRenderContext=t.createRenderContext,INode=t.INode,IRenderingEngine=t.IRenderingEngine,bindable=t.bindable,customElement=t.customElement}],s(){function s(t){const s={},i=[];if(!t||!t.length)return{i:s,list:i};const h=t.replace("+"," ").split("&");for(const t of h){const h=t.split("="),e=decodeURIComponent(h.shift());if(!h.length){i.push(e);continue}const value=decodeURIComponent(h.shift());s[e]=value}return{i:s,list:i}}function i(t,s,i,h){var e,n,r=arguments.length,o=3>r?s:null===h?h=Object.getOwnPropertyDescriptor(s,i):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,s,i,h);else for(n=t.length-1;n>=0;n--)(e=t[n])&&(o=(3>r?e(o):r>3?e(s,i,o):e(s,i))||o);return r>3&&o&&Object.defineProperty(s,i,o),o}class h{constructor(){this.h=(async t=>this.o(this,"popstate",[t])),this.window=window,this.history=window.history,this.l=[],this.u=0,this.p=null,this.v=null,this.g=null,this.m=null}$(t){if(this.u)throw Reporter.error(2003);this.u=1,this.v=t,PLATFORM.C.add(this.S,this),this.window.addEventListener("popstate",this.h)}R(){this.window.removeEventListener("popstate",this.h),PLATFORM.C.remove(this.S,this),this.v=null,this.u=0}get length(){return this.history.length}get state(){return this.history.state}get O(){return this.history.O}async go(t,s=0){if(!s)return this.o(this,"_go",[t],1);const i=this.o(this,"suppressPopstate",[],1);return this.o(this.history,"go",[t]).catch(t=>{throw t}),i}back(){return this.go(-1)}forward(){return this.go(1)}async pushState(t,s,i){return this.o(this.history,"pushState",[t,s,i])}async replaceState(t,s,i){return this.o(this.history,"replaceState",[t,s,i])}async V(t){if(this.m){const t=this.m;this.m=null,t()}else{if(this.g){const t=this.g;this.g=null,t(),await Promise.resolve()}this.v(t)}}P(t,s){this.g=s,this.history.go(t)}k(t){this.m=t}o(t,s,i,h=0){let e;const n=new Promise(t=>{e=t});return h&&(i.push(e),e=null),this.l.push({target:t,H:s,i,resolve:e}),n}async S(t){if(!this.l.length||null!==this.p)return;this.p=this.l.shift();const s=this.p.target[this.p.H];Reporter.write(1e4,"DEQUEUE",this.p.H,this.p.i),s.apply(this.p.target,this.p.i);const i=this.p.resolve;this.p=null,i&&i()}}t("QueuedBrowserHistory",h);class e{constructor(){this.j=(async()=>{const t=this.I(),s=this.N();Reporter.write(1e4,"path changed to",t,this.A,this.T);const i={};let h,e=this.U("HistoryEntry");if(this.A&&this.A.path===t){i.q=1;const t=this.D?this.T.index:this.history.length-this.L;h=this.T,this.T=this.A,this.T.index=t,this.D?(this._=0,this.F[this.T.index]=this.T,this.J?(i.B=1,this.J=0):i.G=1,this.D=0):(this._=1,this.F=this.F.slice(0,this.T.index),this.F.push(this.T)),await this.M({W:this.F,K:this.L,X:this.T})}else this.F=this.F||this.U("HistoryEntries")||[],this.L=this.L||this.U("HistoryOffset")||0,e||this.T?e?this.T?e.index>this.T.index?i.Y=1:this.T.index>e.index&&(i.Z=1):i.B=1:i.q=1:(i.q=1,i.tt=1,this.L=this.history.length),e||(e={path:t,st:null,index:this.history.length-this.L,it:s},i.tt&&(e.ht=1),this.F=this.F.slice(0,e.index),this.F.push(e),await this.M({W:this.F,K:this.L,X:e})),this._=this.T?e.index-this.T.index:0,h=this.T,this.T=e;this.A=null,Reporter.write(1e4,"navigated",this.U("HistoryEntry"),this.F,this.U("HistoryOffset")),this.v(this.T,i,h)}),this.location=window.location,this.history=new h,this.T=null,this.F=null,this.L=null,this.et=null,this.A=null,this.options=null,this.u=0,this._=null,this.D=0,this.J=0}$(t){if(this.u)throw Reporter.error(0);return this.u=1,this.options=Object.assign({},t),this.history.$(this.j),Promise.resolve().then(()=>{this.nt(this.I(),1).catch(t=>{throw t})})}R(){this.history.R(),this.u=0}rt(t,s,i){return this.A={path:t,st:null,title:s,data:i},this.nt(t)}replace(t,s,i){return this.D=1,this.A={path:t,st:null,title:s,data:i},this.nt(t,1)}async refresh(){if(this.T)return this.J=1,this.replace(this.T.path,this.T.title,this.T.data)}back(){return this.history.go(-1)}forward(){return this.history.go(1)}cancel(){const t=this._;return t?(this._=0,this.history.go(-t,1)):this.replace(this.et.path,this.et.title,this.et.data)}async pop(){await this.history.go(-1,1);const t=""+this.location,s=this.history.state;if(!s.X.ht)return await this.history.go(-1,1),this.history.pushState(s,null,t)}async M(t,value){const{pathname:s,search:i,hash:h}=this.location;let e=Object.assign({},this.history.state);return"string"==typeof t?e[t]=JSON.parse(JSON.stringify(value)):e=Object.assign({},e,JSON.parse(JSON.stringify(t))),this.history.replaceState(e,null,`${s}${i}${h}`)}U(t){return Object.assign({},this.history.state)[t]}ot(t){return this.T.title=t,this.F[this.T.index]=this.T,this.M({W:this.F,X:this.T})}ct(t,s,i){if(i.index!==this.T.index)return;const h=`#/${t}`,{pathname:e,search:n,hash:r}=this.location;if(h===r&&this.T.path===t&&this.T.st===s)return;this.T.path=t,this.T.st=s;const o=Object.assign({},this.history.state,{X:this.T,W:this.F});return this.history.replaceState(o,null,`${e}${n}${h}`)}lt(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get at(){return this.F?this.F.slice(0,this.T.index+1).map(value=>value.title):[]}I(){return this.location.hash.substring(1).split("?")[0]}async nt(t,s=0){if(this.T&&this.T.path===t&&!this.J)return;const{pathname:i,search:h}=this.location,e=`#${t}`;return s?(this.et=this.T,await this.history.replaceState({},null,`${i}${h}${e}`)):await this.history.pushState({},null,`${i}${h}${e}`),this.j()}N(){const t=this.location.hash.substring(1).split("?");return t.shift(),t.length>0?t.shift():""}v(t,s,i){const h=Object.assign({},t,s);h.ut=i,Reporter.write(1e4,"callback",t,s),this.options.v&&this.options.v(h)}}t("HistoryBrowser",e);class n{constructor(){this.u=0,this.ft=(t=>{const s=n.pt(t);s.wt&&(t.preventDefault(),this.options.v(s))}),this.document=document}static pt(t){const s={wt:0,href:null,anchor:null},i=n.dt(t.target);if(!i||!n.vt(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const h=i.getAttribute("href");return s.anchor=i,s.href=h,s.wt=1===t.which,s}static dt(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static vt(t){const s=t.getAttribute("target");return!s||s===n.window.name||"_self"===s}$(t){if(this.u)throw Reporter.error(2004);this.u=1,this.options=Object.assign({},t),this.document.addEventListener("click",this.ft,1)}R(){this.document.removeEventListener("click",this.ft,1),this.u=0}}t("LinkHandler",n);class r{constructor(component,t,s,i){this.gt(component),t&&this.yt(t),s&&this.bt(s),this.scope=!!i}gt(component){"string"==typeof component?(this.$t=component,this.component=null):(this.component=component,this.$t=component.description.name)}yt(t){"string"==typeof t?(this.Ct=t,this.viewport=null):(this.viewport=t,t&&(this.Ct=t.name))}bt(t){"string"==typeof t?(this.St=t,this.i={id:t}):this.i=t}Et(t){if(null!==this.component)return this.component;const s=t.get(IContainer),i=s.Rt(CustomElementResource.Ot(this.$t));return null!==i?i.Pt(s).Vt:null}kt(router){return null!==this.viewport?this.viewport:router.Ht()[this.Ct]}jt(t,s=0,i=0){return s&&this.St!==t.St?0:i?this.component===t.component:this.$t===t.$t}}class o{constructor(t,s){this.active="",this.It=t,Object.assign(this,{title:s.title,children:null,Nt:s.Nt,active:""}),this.instructions=this.At(s.Tt),this.link=this.xt(this.instructions),this.Ut=s.qt?this.xt(this.At(s.qt)):this.link,this.zt=this.It.router.Dt.get(IObserverLocator),this.Lt=this.zt._t(0,this.It.router,"activeComponents"),this.Lt.subscribe(this)}get Ft(){return this.children&&this.children.length?"nav-has-children":""}Jt(){this.active=this.link&&this.link.length?this.Bt():"nav-active"===this.active?"nav-active":this.Gt()?"nav-active-child":""}Bt(){const t=this.It.router.Mt.Qt(this.Ut),s=this.It.router.Wt.map(t=>this.It.router.Mt.Kt(t));for(const component of t)if(!s.find(t=>t.jt(component)))return"";return"nav-active"}Xt(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}xt(instructions){return this.It.router.Mt.Yt(instructions)}At(t){if(!Array.isArray(t))return this.At([t]);const instructions=[];for(const s of t)instructions.push("string"==typeof s?this.It.router.Mt.Kt(s):s instanceof r?s:s.component?new r(s.component,s.viewport,s.i):new r(s));return instructions}Gt(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.Gt())return 1;return 0}}class c{constructor(router,name){this.router=router,this.name=name,this.Zt=[]}ts(t){for(const s of t)this.ss(this.Zt,s)}ss(t,s){const i=new o(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.ss(i.children,t)}}}t("Nav",c);class l{constructor(t,s){this.ft=t,this.names=s}}t("HandlerEntry",l);class a{constructor(t,s){this.hs=t,this.es=s}}t("RouteGenerator",a);class u{constructor(){this.ns=0,this.rs=0,this.os=0}}t("TypesRecord",u);class f{constructor(t,s,i){this.ft=t,this.cs=s,this.ls=i}}t("RecognizeResult",f);class p{constructor(t,s,i){this.as=t,this.us=s,this.repeat=i}fs(t){return this.us===t.us&&this.as===t.as}}t("CharSpec",p);class State{constructor(t){this.ps=t,this.ws=[]}put(t){let s=this.ws.find(s=>s.ps.fs(t));return void 0===s&&(s=new State(t),this.ws.push(s),t.repeat&&s.ws.push(s)),s}}t("State",State);const w=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g;class d{constructor(t,s){this.name=t,this.ds=t,this.vs=s,this.optional=0}gs(t){const s=this.ds,i=s.length;let h=0,e="";if(this.vs)for(;i>h;++h)e=s.charAt(h),t(new p(null,e,0));else for(;i>h;++h)e=s.charAt(h),t(new p(null,e.toUpperCase()+e.toLowerCase(),0))}ms(){return this.ds.replace(w,"\\$1")}ys(t,s){return this.ds}}t("StaticSegment",d);class v{constructor(name,optional){this.name=name,this.optional=optional}gs(t){t(new p("/",null,1))}ms(){return"([^/]+)"}ys(t,s){return s[this.name]=1,t[this.name]}}t("DynamicSegment",v);class g{constructor(name){this.name=name,this.optional=0}gs(t){t(new p("",null,1))}ms(){return"(.+)"}ys(t,s){return s[this.name]=1,t[this.name]}}t("StarSegment",g);class m{gs(t){}ms(){return""}ys(t,s){return""}}t("EpsilonSegment",m),t("RouteRecognizer",class{constructor(){this.bs=new State,this.names={},this.Zt=new Map}add(t){if(Array.isArray(t))return void t.forEach(t=>{this.add(t)});let s=this.bs;const i=[];let h="^";const e=new u,n=[],r=t.ft.name;let o=1,c=t.path;"/"===c.charAt(0)&&(c=c.slice(1));const f=[],w=c.split("/");let y,b;for(let r=0,c=w.length;c>r;++r){let c=(y=w[r]).match(/^:([^?]+)(\?)?$/);if(c){const[,name,optional]=c;if(-1!==name.indexOf("="))throw Error(`Parameter ${name} in route ${t} has a default value, which is not supported.`);f.push(b=new v(name,!!optional)),n.push(name),e.rs++}else if(c=y.match(/^\*(.+)$/))f.push(b=new g(c[1])),n.push(c[1]),e.os++;else{if(""===y){f.push(new m);continue}f.push(b=new d(y,t.vs)),e.ns++}const l=s.put(new p(null,"/",0));let a=l;b.gs(t=>{a=a.put(t)});for(let t=0,s=i.length;s>t;t++)i[t].ws.push(l);b.optional?(i.push(a),h+=`(?:/${b.ms()})?`):(s=a,h+=`/${b.ms()}`,i.length=0,o=0)}o&&(s=s.put(new p(null,"/",0)),h+="/?");const $=[new l(t.ft,n)];if(this.Zt.set(t.ft,new a(f,$)),r){const t=Array.isArray(r)?r:[r];for(let s=0;t.length>s;s++)t[s]in this.names||(this.names[t[s]]=new a(f,$))}for(let s=0;i.length>s;s++){const n=i[s];n.es=$,n.ms=RegExp(`${h}$`,t.vs?"":"i"),n.types=e}return s.es=$,s.ms=RegExp(`${h}$`,t.vs?"":"i"),s.types=e,s}$s(t){return"string"==typeof t?this.names[t]:this.Zt.get(t)}Cs(t){const s=this.$s(t);if(!s)throw Error(`There is no route named ${t}`);return[...s.es]}Ss(t){return!!this.$s(t)}ys(t,s){const i=this.$s(t);if(!i)throw Error(`There is no route named ${t}`);const h=i.es[0].ft;if(h.Es)return h.href;const e=Object.assign({},s),n=i.hs,r={};let o="";for(let s=0,i=n.length;i>s;s++){const i=n[s];if(i instanceof m)continue;const h=i.ys(e,r);if(null==h){if(!i.optional)throw Error(`A value is required for route parameter '${i.name}' in route '${t}'.`)}else o+="/",o+=h}"/"!==o.charAt(0)&&(o=`/${o}`);for(const t in r)Reflect.deleteProperty(e,t);const c=buildQueryString(e);return o+(c?`?${c}`:"")}Rs(t){let s=[this.bs],i={},h=0,e=t;const n=e.indexOf("?");if(-1!==n){const t=e.slice(n+1);e=e.slice(0,n),i=parseQueryString(t)}"/"!==(e=decodeURI(e)).charAt(0)&&(e=`/${e}`);let r=e.length;r>1&&"/"===e.charAt(r-1)&&(e=e.slice(0,-1),h=1,--r);for(let t=0;r>t;++t){const i=[],h=e.charAt(t);if(s.forEach(t=>{t.ws.forEach(t=>{null!==t.ps.us?-1!==t.ps.us.indexOf(h)&&i.push(t):null!==t.ps.as&&-1===t.ps.as.indexOf(h)&&i.push(t)})}),0===(s=i).length)break}const o=[];for(let t=0,i=s.length;i>t;t++)s[t].es&&o.push(s[t]);o.sort((t,s)=>{if(t.types.os!==s.types.os)return t.types.os-s.types.os;if(t.types.os){if(t.types.ns!==s.types.ns)return s.types.ns-t.types.ns;if(t.types.rs!==s.types.rs)return s.types.rs-t.types.rs}return t.types.rs!==s.types.rs?t.types.rs-s.types.rs:t.types.ns!==s.types.ns?s.types.ns-t.types.ns:0});const c=o[0];if(c&&c.es){h&&"(.+)$"===c.ms.source.slice(-5)&&(e=`${e}/`);const t=e.match(c.ms);let s=1;const n=[];return n.Os=i,c.es.forEach(i=>{const h={};i.names.forEach(name=>{h[name]=t[s++]}),n.push(new f(i.ft,h,i.names.length>0))}),n}}});class y{$(t){this.Vs=Object.assign({viewport:"@",Ps:"+",scope:"/",ks:"!",i:"=",add:"+",clear:"-",action:"."},t.Vs)}get Hs(){return this.Vs.clear}Kt(t){let component,s,i,h;const[e,n]=t.split(this.Vs.viewport);return void 0===n?([component,...i]=e.split(this.Vs.i),component.endsWith(this.Vs.ks)&&(h=1,component=component.slice(0,component.length-1))):(component=e,[s,...i]=n.split(this.Vs.i),s.endsWith(this.Vs.ks)&&(h=1,s=s.slice(0,s.length-1))),i=i.length?i.join(this.Vs.i):void 0,new r(component,s,i,h)}js(t,s=0){if("string"==typeof t)return this.js(this.Kt(t),s);{let i=t.$t;return t.Ct&&!s&&(i+=this.Vs.viewport+t.Ct),t.St&&(i+=this.Vs.i+t.St),i}}Is(t){return t.split(this.Vs.scope).map(t=>this.Kt(t))}Ns(instructions){return Array.isArray(instructions)?instructions.map(t=>this.js(t)).join(this.Vs.scope):this.Ns([instructions])}As(t,s){return t&&(s=`/${t}${this.Vs.scope}${s}`),s}Ts(t){return{xs:t===this.Vs.clear||t.startsWith(this.Vs.clear+this.Vs.add),Us:t.startsWith(this.Vs.clear)?t.substring(1):t}}qs(t){const s={};t.startsWith("/")&&(t=t.substring(1));const i=t.split(this.Vs.Ps);let h=0;for(;i.length;){const t=i.shift().split(this.Vs.scope),parts=t.pop().split(this.Vs.viewport),component=parts[0];t.push(parts.length?parts.join(this.Vs.viewport):`?${h++}`);const name=t.join(this.Vs.scope);component&&(s[name]=component)}return s}Yt(instructions){const t=[];for(const s of instructions)t.push(this.js(s));return t.join(this.Vs.Ps)}Qt(t){const instructions=[],s=t.split(this.Vs.Ps);for(const t of s)instructions.push(this.Kt(t));return instructions}zs(t){let s=t.slice().sort((t,s)=>s.split(this.Vs.scope).length-t.split(this.Vs.scope).length),i=[];if((s=s.map(value=>`${this.Vs.scope}${value}${this.Vs.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.Vs.scope).length-s.split(this.Vs.scope).length),i}Ds(t,s=0){const i=t.slice();return s&&i.unshift(this.Hs),i.join(this.Vs.Ps)}}class b{constructor(){this.Ls=(t=>t),this._s=(instructions=>instructions)}}var $;(function(t){t[t.Fs=0]="none",t[t.loaded=1]="loaded",t[t.Js=2]="initialized",t[t.Bs=3]="entered",t[t.Gs=4]="added"})($||($={}));class C{constructor(t=null,s=null,i=null,h=null){this.content=t,this.i=s,this.Qs=i,this.component=null,this.Ms=0,this.Ws=0,null!==this.content&&"string"==typeof this.content&&null!==h&&(this.content=this.Et(h))}Ks(t){return"string"==typeof t.content&&this.$t()!==t.content||"string"!=typeof t.content&&this.content!==t.content||this.i!==t.i||!this.Qs||this.Qs.it!==t.Qs.it}Xs(t){return("string"==typeof t.content&&this.$t()===t.content||"string"!=typeof t.content&&this.content===t.content)&&this.i===t.i}loadComponent(t,s){return this.Ws||(this.component=this.Ys(t),this.component.Zs(0,t,s)),this.Ms=1,Promise.resolve()}ti(){1===this.Ms&&(this.Ms=0)}si(){this.Ws||this.component.ii(2560,null),this.Ms=2}hi(t=0){2===this.Ms&&(t||(this.component.ei(5120),this.Ms=1))}addComponent(t){if(this.component.ni(512),this.Ws){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)if(t.hasAttribute("au-element-scroll")){const[s,i]=t.getAttribute("au-element-scroll").split(",");t.removeAttribute("au-element-scroll"),t.scrollTo(+i,+s)}}this.Ms=4}ri(t,s=0){if(4===this.Ms){if(s){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)(t.scrollTop>0||t.scrollLeft)&&t.setAttribute("au-element-scroll",`${t.scrollTop},${t.scrollLeft}`)}this.component.oi(1024),this.Ms=4}}async ci(t,s=0){switch(this.Ms){case 4:this.ri(t,s);case 3:this.component.li&&await this.component.li(),this.Ms=2;case 2:this.hi(s);case 1:this.ti()}this.Ms=0}$t(){return null===this.content?null:"string"==typeof this.content?this.content:this.content.description.name}Et(t){if(null===this.content)return null;if("string"!=typeof this.content)return this.content;{const s=t.get(IContainer),i=s.Rt(CustomElementResource.Ot(this.content));return null!==i?i.Pt(s).Vt:null}}Ys(t){if(null===this.content)return null;const component=this.$t();return t.get(IContainer).get("string"!=typeof component?component:CustomElementResource.Ot(component))}}class S{constructor(router,name,t,s,i,h,e){this.router=router,this.name=name,this.ai=t,this.context=s,this.ui=i,this.scope=h,this.options=e,this.clear=0,this.content=new C,this.fi=null,this.pi=null,this.wi=null,this.cache=[],this.enabled=1}di(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.Mt.Hs)this.clear=1,t=null;else{const s=this.router.Mt.Kt(t);t=s.$t,i=s.St}if(this.fi=new C(t,i,s,this.context),this.options.vi){const t=this.cache.find(t=>this.fi.Xs(t));t?(this.fi=t,this.fi.Ws=1):this.cache.push(this.fi)}return this.content.Ks(this.fi)||s.B}gi(t,s,i){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.ai&&(this.scope.ai=t),this.ai!==t&&(this.wi=Object.assign({},this),this.mi(),this.ai=t,i&&i.yi&&(this.options.yi=i.yi),i&&i.default&&(this.options.default=i.default),i&&i.bi&&(this.options.bi=i.bi),i&&i.$i&&(this.options.$i=i.$i),i&&i.vi&&(this.options.vi=i.vi),this.pi&&this.pi()),this.context!==s&&(this.context=s),this.content.component||this.fi&&this.fi.component||!this.options.default||this.router.Ci(this.options.default,this)}remove(t,s){return this.ai===t&&this.context===s?(this.content.component&&this.content.ci(this.ai,this.options.vi).catch(t=>{throw t}),1):0}async Si(){if(!this.content.component)return 1;const component=this.content.component;return component.Si?(Reporter.write(1e4,"viewport canLeave",component.Si(this.content.Qs,this.fi.Qs)),component.Si(this.content.Qs,this.fi.Qs)):1}async Ei(){if(this.clear)return 1;if(!this.fi.content)return 0;if(await this.Ri(),await this.fi.loadComponent(this.context,this.ai),!this.fi.component)return 0;const component=this.fi.component;if(!component.Ei)return 1;const t=component.Ei(this.fi.Qs,this.content.Qs);return Reporter.write(1e4,"viewport canEnter",t),"boolean"==typeof t?t:"string"==typeof t?[new r(t,this)]:t}async Oi(){if(Reporter.write(1e4,"Viewport enter",this.name),this.clear)return 1;if(!this.fi.component)return 0;if(this.fi.component.Oi){const t=(function(t,i,h){const e=s(i),n=s(t),r=Object.assign({},e.i,n.i),o=[...e.list,...n.list];if(o.length&&h&&h.length)for(const t of h)r[t]=o.shift();let c;return o.length&&Object.keys(r).length&&(r["Vi"]=o.splice(0,o.length)),{Pi:r,ki:o,Hi:c=o.length?o:r}})(this.fi.i,this.fi.Qs.it,this.fi.content.i);this.fi.Qs.i=t.Pi,this.fi.Qs.ki=t.ki,await this.fi.component.Oi(t.Hi,this.fi.Qs,this.content.Qs),this.fi.Ms=3}return this.fi.si(),1}async ji(){return Reporter.write(1e4,"Viewport loadContent",this.name),this.content.component&&(this.content.component.li&&await this.content.component.li(this.content.Qs,this.fi.Qs),this.fi.component||(this.content.ri(this.ai,this.options.vi),this.content.hi(this.options.vi),this.content.ti())),this.fi.component&&(this.content.component&&(this.content.ri(this.ai,this.options.vi),this.content.hi(this.options.vi),this.content.ti()),this.fi.addComponent(this.ai),this.content=this.fi),this.clear&&(this.content=new C(null,null,this.fi.Qs)),this.fi=null,1}Ii(){this.wi=null}async Ni(){await this.fi.ci(this.ai,this.options.vi),this.wi&&Object.assign(this,this.wi)}description(t=0){if(this.content.content){const component=this.content.$t();if(t||this.scope||this.options.Ai)return this.router.Mt.js(new r(component,this,this.content.i,null!==this.scope));const s={};s[component]=component;const i=this.ui.Ti(s);return this.router.Mt.js(new r(component,i?null:this,this.content.i))}}xi(t=0){const s=[this.ui.Ui(t),this.description(t)];return this.router.Mt.Ns(s.filter(value=>value&&value.length))}qi(component){let t=this.options.yi||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}zi(component){if("-"===component||null===component)return 1;let t=this.options.yi;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}Di(t){this.content.component&&this.content.si()}Li(t){Reporter.write(1e4,"ATTACHING viewport",this.name,this.content,this.fi),this.enabled=1,this.content.component&&this.content.addComponent(this.ai)}_i(t){Reporter.write(1e4,"DETACHING viewport",this.name),this.content.component&&this.content.ri(this.ai,this.options.vi),this.enabled=0}Fi(t){this.content.component&&this.content.hi(this.options.vi)}mi(){this.options={},this.content=new C,this.cache=[]}async Ri(){return this.ai?Promise.resolve():new Promise(t=>{this.pi=t})}}t("Viewport",S);class Scope{constructor(router,t,s,i){this.router=router,this.ai=t,this.context=s,this.parent=i,this.viewport=null,this.children=[],this.Ji=[],this.Bi={},this.Gi=null,this.parent&&this.parent.Qi(this)}Mi(){return this.Ji.filter(t=>t.enabled).reduce((t,s)=>(t[s.name]=s,t),{})}Ti(t){const instructions=[];let s=0;t&&(this.Gi={},this.Bi={}),this.Gi=Object.assign({},this.Mi(),this.Gi);for(const s in t){const parts=this.router.Mt.Is(s),t=this.router.Mt.js(parts.shift());this.Bi[t]||(this.Bi[t]=[]),this.Bi[t].push(parts)}for(const i in this.Bi){const h=this.router.Mt.Kt(i);for(const name in this.Gi){const e=this.Gi[name];if(e&&e.qi(h.$t)){const n=this.Wi(t,this.Bi,h,e);instructions.push(...n.Ki),s=s||n.Xi,this.Gi[name]=null,Reflect.deleteProperty(this.Bi,i);break}}}for(const i in this.Bi){const h=this.router.Mt.Kt(i),name=h.Ct;if(!name||!name.length||name.startsWith("?"))continue;const e=h.scope;this.Mi()[name]||(this.Yi(name,null,null,{scope:e,Ai:1}),this.Gi[name]=this.Mi()[name]);const n=this.Gi[name];if(n&&n.zi(h.$t)){const e=this.Wi(t,this.Bi,h,n);instructions.push(...e.Ki),s=s||e.Xi,this.Gi[name]=null,Reflect.deleteProperty(this.Bi,i)}}for(const i in this.Bi){const h=this.router.Mt.Kt(i),e=[];for(const name in this.Gi){const t=this.Gi[name];t&&t.zi(h.$t)&&e.push(t)}if(1===e.length){const n=e.shift(),r=this.Wi(t,this.Bi,h,n);instructions.push(...r.Ki),s=s||r.Xi,this.Gi[n.name]=null,Reflect.deleteProperty(this.Bi,i);break}}if(s=s||Object.keys(this.Bi).length>0,!t)for(const t of this.children){const i=t.Ti();instructions.push(...i.Ki),s=s||i.Xi}return{Ki:instructions,Xi:s}}Wi(t,s,i,h){const e=this.router.Mt.js(i);i.yt(h);const instructions=[i];let n=0;if(s[e].length){const i=h.scope||h.ui;for(const h of s[e])if(h.length){const s={};s[this.router.Mt.Ns(h)]=t[this.router.Mt.Ns([e,...h])];const r=i.Ti(s);instructions.push(...r.Ki),n=n||r.Xi}}return{Ki:instructions,Xi:n}}Yi(name,t,s,i){let h=this.Mi()[name];if(t&&h&&null!==h.ai&&h.ai!==t&&(h.enabled=0,(h=this.Ji.find(s=>s.name===name&&s.ai===t))&&(h.enabled=1)),!h){let e;i.scope&&(e=new Scope(this.router,t,s,this),this.router.Zi.push(e)),h=new S(this.router,name,null,null,this,e,i),this.Ji.push(h)}return(t||s)&&h.gi(t,s,i),h}th(t,s,i){return(!s&&!i||t.remove(s,i))&&(t.scope&&this.router.sh(t.scope),this.Ji.splice(this.Ji.indexOf(t),1)),Object.keys(this.Ji).length}sh(){for(const t of this.children)t.sh();const t=this.Mi();for(const name in t)this.router.th(t[name],null,null)}ih(t){return t.Ei().then(()=>t.ji())}Qi(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}hh(t=0,s=0){const i=[];for(const h in this.Mi()){const e=this.Mi()[h];(e.options.$i||e.options.bi&&!t)&&!s||i.push(e.xi(t))}for(const s of this.children)i.push(...s.hh(t));return i.filter(value=>value&&value.length)}Ht(){const t=this.Ji.filter(t=>t.enabled);for(const s of this.children)t.push(...s.Ht());return t}Ui(t=0){if(!this.ai||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent.eh(this.context.get(IContainer).parent);for(;i&&i.ui===this.parent;)s.unshift(i.description(t)),i=this.eh(i.context.get(IContainer).parent);return s.unshift(this.parent.Ui(t)),this.router.Mt.Ns(s.filter(value=>value&&value.length))}eh(t){const s=Object.values(this.Mi());for(;t;){const i=s.find(s=>s.context.get(IContainer)===t);if(i)return i;t=t.parent}return null}}t("Scope",Scope);const E=t("IRouteTransformer",DI.rh("IRouteTransformer").nh(t=>t.singleton(b)));class R{constructor(t,s){this.Dt=t,this.Zi=[],this.oh={},this.Wt=[],this.lh=[],this.u=0,this.ah=[],this.uh=null,this.fh=null,this.ph=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substring(1)),!s.startsWith("/")){const i=this.wh(t.anchor).Ui();s=this.Mt.As(i,s)}this.dh.lt(s)}),this.dh=new e,this.vh=new n,this.Mt=new y,this.gh=s}get mh(){return null!==this.uh}$(t){if(this.u)throw Reporter.error(2001);return this.u=1,this.options=Object.assign({v:t=>{this.yh(t)},Ls:this.gh.Ls,_s:this.gh._s},t),this.Mt.$({Vs:this.options.Vs}),this.vh.$({v:this.ph}),this.dh.$(this.options).catch(t=>{throw t})}R(){if(!this.u)throw Reporter.error(2e3);this.vh.R(),this.dh.R()}yh(t){this.ah.push(t),this.bh().catch(t=>{throw t})}async bh(){if(null!==this.uh||!this.ah.length)return Promise.resolve();const t=this.ah.shift();this.uh=t,this.options.$h&&this.options.$h(t);let i=0;(t.Z||t.Y)&&t.st&&(t.path=t.st,i=1);let h=t.path;if(this.options.Ls&&!i){const t=this.options.Ls(h,this);h=Array.isArray(t)?this.Mt.Yt(t):t}const{xs:e,Us:n}=this.Mt.Ts(h);e&&(h=n);const r=s(t.it);t.i=r.i,t.ki=r.list;const o=this.Mt.qs(h);if(!o&&!Object.keys(o).length&&!e)return this.uh=null,this.bh();const c=e?this.Ht().filter(value=>null!==value.content.component):[],l=this.Ht().filter(value=>value.options.default&&null===value.content.component),a=[];let{Ki:u,Xi:f}=this.Ch.Ti(o),p=100;for(;u.length||f||l.length;){if(!p--)throw Reporter.error(2002);const s=[];for(const i of u){const h=i.viewport,e=this.Mt.js(i,1);h.di(e,t)&&s.push(h);const n=c.findIndex(value=>value===h);0>n||c.splice(n,1);const r=l.findIndex(value=>value===h);0>r||l.splice(r,1)}for(const i of c)i.di(this.Mt.Hs,t)&&s.push(i);let i;for(;i=l.shift();)i.di(i.options.default,t)&&s.push(i);let h=await Promise.all(s.map(value=>value.Si()));if(h.findIndex(value=>0==value)>=0)return this.Sh([...s,...a],t);if((h=await Promise.all(s.map(async value=>{const t=await value.Ei();if("boolean"==typeof t)return t?value.Oi():0;for(const s of t)this.Ci(s.component,s.viewport);return value.Ni().catch(t=>{throw t}),1}))).some(t=>0==t))return this.Sh([...s,...a],t);for(const t of s)a.find(value=>value===t)||a.push(t);const e=this.Ch.Ti();let n;for(u=[];n=this.lh.shift();)e.Ki.find(value=>value.viewport===n.viewport)||u.push(n);u=[...u,...e.Ki],f=e.Xi}await Promise.all(a.map(value=>value.ji())),await this.Eh(t),t.tt||t.Rh||!a.every(t=>t.options.$i)||await this.dh.pop(),a.forEach(t=>{t.Ii()}),this.fh=this.uh,this.fh.Rh&&(this.fh.Rh=0),this.uh=null,this.bh().catch(t=>{throw t})}Ci(component,t){this.uh?("string"==typeof t&&(t=this.Ht().find(s=>s.name===t)),this.lh.push(new r(component,t))):this.fh&&(this.ah.unshift({path:"",st:"",Rh:1}),this.bh().catch(t=>{throw t}))}Oh(t){return this.Vh(),this.wh(t)}Yi(name,t,s,i){return Reporter.write(1e4,"Viewport added",name,t),this.Oh(t).Yi(name,t,s,i)}th(t,s,i){const h=t.ui;h.th(t,s,i)||this.sh(h)}Ht(){return this.Vh(),this.Ch.Ht()}sh(t){if(t!==this.Ch){t.sh();const s=this.Zi.indexOf(t);0>s||this.Zi.splice(s,1)}}rt(t,s,i){if("string"==typeof t)return this.dh.rt(t,s,i)}replace(t,s,i){if("string"==typeof t)return this.dh.replace(t,s,i)}refresh(){return this.dh.refresh()}back(){return this.dh.back()}forward(){return this.dh.forward()}Ph(name,t){const s=this.kh(name);s&&(s.Zt=[]),this.Hh(name,t)}Hh(name,t){let s=this.oh[name];s||(s=this.oh[name]=new c(this,name)),s.ts(t)}kh(name){return this.oh[name]}async Sh(t,s){t.forEach(t=>{t.Ni().catch(t=>{throw t})}),s.q?await this.dh.pop():await this.dh.cancel(),this.uh=null,this.bh().catch(t=>{throw t})}Vh(){if(!this.Ch){const t=this.Dt.get(Aurelia).root();this.Ch=new Scope(this,t.jh,t.$context,null),this.Zi.push(this.Ch)}}wh(t){let s=(function(t){for(;t&&!t.$customElement;)t=t.parentElement;return t})(t).$customElement.$context.get(IContainer);for(;s;){const t=this.Zi.find(t=>t.context.get(IContainer)===s);if(t)return t;s=s.parent}}Eh(t){this.Wt=this.Ch.hh(1,1),this.Wt=this.Mt.zs(this.Wt);let s=this.Ch.hh();s=this.Mt.zs(s);let i=this.Mt.Ds(s);if(this.options._s){const t=this.options._s(this.Mt.Qt(i),this);i=Array.isArray(t)?this.Mt.Yt(t):t}let h=this.Ch.hh(1);h=this.Mt.zs(h);const e=t.it&&t.it.length?`?${t.it}`:"";return this.dh.ct(i+e,this.Mt.Ds(h,1)+e,t)}}t("Router",R),R.inject=[IContainer,E];class O{constructor(router,t,s){this.router=router,this.ai=t,this.Ih=s,this.name="default",this.scope=null,this.yi=null,this.default=null,this.bi=null,this.$i=null,this.vi=null,this.viewport=null}Nh(t,host,parts,s){const i=this.constructor,dom=s.get(IDOM),template=this.Ih.Ah(dom,i.description,s,i);template.Th=createRenderContext(dom,s,i.description.dependencies,i),template.Nh(this,host,parts)}bound(){this.connect()}xh(){this.disconnect()}connect(){const t={scope:this.ai.hasAttribute("scope")};this.yi&&this.yi.length&&(t.yi=this.yi),this.default&&this.default.length&&(t.default=this.default),this.ai.hasAttribute("no-link")&&(t.bi=1),this.ai.hasAttribute("no-history")&&(t.$i=1),this.ai.hasAttribute("stateful")&&(t.vi=1),this.viewport=this.router.Yi(this.name,this.ai,this.$context,t)}disconnect(){this.router.th(this.viewport,this.ai,this.$context)}Di(t){this.viewport&&this.viewport.Di(t)}Li(t){this.viewport&&this.viewport.Li(t)}_i(t){this.viewport&&this.viewport._i(t)}Fi(t){this.viewport&&this.viewport.Fi(t)}}t("ViewportCustomElement",O),O.inject=[R,INode,IRenderingEngine],i([bindable],O.prototype,"name",void 0),i([bindable],O.prototype,"scope",void 0),i([bindable],O.prototype,"usedBy",void 0),i([bindable],O.prototype,"default",void 0),i([bindable],O.prototype,"noLink",void 0),i([bindable],O.prototype,"noHistory",void 0),i([bindable],O.prototype,"stateful",void 0),CustomElementResource.Uh({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> </div></template>'},O);let V=t("NavCustomElement",class{constructor(router){this.router=router,this.name=null,this.Zt=null,this.level=0}get qh(){const t=this.router.kh(this.name);return t?t.Zt:[]}active(t){return"Active"}});i([bindable],V.prototype,"name",void 0),i([bindable],V.prototype,"routes",void 0),i([bindable],V.prototype,"level",void 0),V=t("NavCustomElement",i([inject(R,Element),customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],V))}}});
