System.register("router",["@aurelia/kernel","@aurelia/runtime"],function(t){"use strict";var Reporter,PLATFORM,buildQueryString,parseQueryString,IContainer,inject,IObserverLocator,CustomElementResource,Aurelia,IDOM,createRenderContext,INode,IRenderingEngine,bindable,customElement;return{t:[function(t){Reporter=t.Reporter,PLATFORM=t.PLATFORM,buildQueryString=t.buildQueryString,parseQueryString=t.parseQueryString,IContainer=t.IContainer,inject=t.inject},function(t){IObserverLocator=t.IObserverLocator,CustomElementResource=t.CustomElementResource,Aurelia=t.Aurelia,IDOM=t.IDOM,createRenderContext=t.createRenderContext,INode=t.INode,IRenderingEngine=t.IRenderingEngine,bindable=t.bindable,customElement=t.customElement}],s(){function s(t){const s={},i=[];if(!t||!t.length)return{i:s,list:i};const h=t.replace("+"," ").split("&");for(const t of h){const h=t.split("="),e=decodeURIComponent(h.shift());if(!h.length){i.push(e);continue}const value=decodeURIComponent(h.shift());s[e]=value}return{i:s,list:i}}function i(t,s,i,h){var e,n,r=arguments.length,o=3>r?s:null===h?h=Object.getOwnPropertyDescriptor(s,i):h;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,s,i,h);else for(n=t.length-1;n>=0;n--)(e=t[n])&&(o=(3>r?e(o):r>3?e(s,i,o):e(s,i))||o);return r>3&&o&&Object.defineProperty(s,i,o),o}class h{constructor(){this.h=(async t=>{await this.o(this,"popstate",[t])}),this.window=window,this.history=window.history,this.l=[],this.u=0,this.p=null,this.v=null}m(t){if(this.u)throw Reporter.error(2003);this.u=1,this.v=t,PLATFORM.g.add(this.$,this),this.window.addEventListener("popstate",this.h)}C(){this.window.removeEventListener("popstate",this.h),PLATFORM.g.remove(this.$,this),this.v=null,this.u=0}get length(){return this.history.length}get state(){return this.history.state}get S(){return this.history.S}async go(t){await this.o(this.history,"go",[t])}back(){return this.go(-1)}forward(){return this.go(1)}async pushState(t,s,i){await this.o(this.history,"pushState",[t,s,i])}async replaceState(t,s,i){await this.o(this.history,"replaceState",[t,s,i])}R(t){this.v(t)}o(t,s,i){let h;const e=new Promise(t=>{h=t});return this.l.push({target:t,O:s,i,resolve:h}),e}async $(t){if(!this.l.length||null!==this.p)return;this.p=this.l.shift();const s=this.p.target[this.p.O];Reporter.write(1e4,"DEQUEUE",this.p.O,this.p.i),s.apply(this.p.target,this.p.i);const i=this.p.resolve;this.p=null,i()}}t("QueuedBrowserHistory",h);class e{constructor(){this.k=(async()=>{if(null!==this.H){Reporter.write(1e4,"=== ignore path change",this.j());const t=this.H;return this.H=null,void t()}const t=this.j(),s=this.P();Reporter.write(1e4,"path changed to",t,this.V,this.N);const i={};let h,e=this.A("HistoryEntry");if(this.V&&this.V.path===t){i.T=1;const t=this.I?this.N.index:this.history.length-this.q;h=this.N,this.N=this.V,this.N.index=t,this.I?(this.D=0,this.L[this.N.index]=this.N,this.U?(i.J=1,this.U=0):this.B?(i.F=1,this.B=0):i.G=1,this.I=0):(this.D=1,this.L=this.L.slice(0,this.N.index),this.L.push(this.N)),await this._({M:this.L,W:this.q,K:this.N})}else this.L=this.L||this.A("HistoryEntries")||[],this.q=this.q||this.A("HistoryOffset")||0,e||this.N?e?this.N?e.index>this.N.index?i.X=1:this.N.index>e.index&&(i.Y=1):i.F=1:i.T=1:(i.T=1,i.Z=1,this.q=this.history.length),e||(e={path:t,tt:null,index:this.history.length-this.q,st:s},i.Z&&(e.it=1),this.L=this.L.slice(0,e.index),this.L.push(e),await this._({M:this.L,W:this.q,K:e})),this.D=this.N?e.index-this.N.index:0,h=this.N,this.N=e,this.U&&(i.J=1,this.U=0);this.V=null,this.ht&&this.ht--,Reporter.write(1e4,"navigated",this.A("HistoryEntry"),this.L,this.A("HistoryOffset")),this.v(this.N,i,h)}),this.location=window.location,this.history=new h,this.N=null,this.L=null,this.q=null,this.et=null,this.V=null,this.options=null,this.u=0,this.D=null,this.ht=null,this.U=0,this.I=0,this.B=0,this.H=null}m(t){if(this.u)throw Reporter.error(0);return this.u=1,this.options=Object.assign({},t),this.history.m(this.k),Promise.resolve().then(()=>{this.nt(this.j(),1).catch(t=>{throw t})})}C(){this.history.C(),this.u=0}rt(t,s,i){return this.V={path:t,tt:null,title:s,data:i},this.nt(t)}replace(t,s,i){return this.I=1,this.V={path:t,tt:null,title:s,data:i},this.nt(t,1)}ot(t,s,i){return this.ht=this.D+1,this.replace(t,s,i)}async refresh(){if(this.N)return this.B=1,this.replace(this.N.path,this.N.title,this.N.data)}back(){return this.history.go(-1)}forward(){return this.history.go(1)}cancel(){this.U=1;const t=this.D||this.ht;return t?this.history.go(-t):this.replace(this.et.path,this.et.title,this.et.data)}async pop(){let t,s=new Promise(t=>{this.H=t});await this.history.go(-1),await s;const i=""+this.location;if(!(t=this.history.state).K.it)return s=new Promise(t=>{this.H=t}),await this.history.go(-1),await s,this.history.pushState(t,null,i)}async _(t,value){const{pathname:s,search:i,hash:h}=this.location;let e=Object.assign({},this.history.state);return"string"==typeof t?e[t]=JSON.parse(JSON.stringify(value)):e=Object.assign({},e,JSON.parse(JSON.stringify(t))),this.history.replaceState(e,null,`${s}${i}${h}`)}A(t){return Object.assign({},this.history.state)[t]}lt(t){return this.N.title=t,this.L[this.N.index]=this.N,this._({M:this.L,K:this.N})}ct(t,s,i){if(i.index!==this.N.index)return;const h=`#/${t}`,{pathname:e,search:n,hash:r}=this.location;if(h===r&&this.N.path===t&&this.N.tt===s)return;this.N.path=t,this.N.tt=s;const o=Object.assign({},this.history.state,{K:this.N,M:this.L});return this.history.replaceState(o,null,`${e}${n}${h}`)}at(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get ut(){return this.L?this.L.slice(0,this.N.index+1).map(value=>value.title):[]}j(){return this.location.hash.substring(1).split("?")[0]}async nt(t,s=0){if(this.N&&this.N.path===t&&!this.B)return;const{pathname:i,search:h}=this.location,e=`#${t}`;return s?(this.et=this.N,await this.history.replaceState({},null,`${i}${h}${e}`)):await this.history.pushState({},null,`${i}${h}${e}`),this.k()}P(){const t=this.location.hash.substring(1).split("?");return t.shift(),t.length>0?t.shift():""}v(t,s,i){const h=Object.assign({},t,s);h.ft=i,Reporter.write(1e4,"callback",t,s),this.options.v&&this.options.v(h)}}t("HistoryBrowser",e);class n{constructor(){this.u=0,this.pt=(t=>{const s=n.dt(t);s.wt&&(t.preventDefault(),this.options.v(s))}),this.document=document}static dt(t){const s={wt:0,href:null,anchor:null},i=n.vt(t.target);if(!i||!n.gt(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const h=i.getAttribute("href");return s.anchor=i,s.href=h,s.wt=1===t.which,s}static vt(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static gt(t){const s=t.getAttribute("target");return!s||s===n.window.name||"_self"===s}m(t){if(this.u)throw Reporter.error(2004);this.u=1,this.options=Object.assign({},t),this.document.addEventListener("click",this.pt,1)}C(){this.document.removeEventListener("click",this.pt,1),this.u=0}}t("LinkHandler",n);class r{constructor(t,s){this.active="",this.yt=t,Object.assign(this,{$t:s.$t,title:s.title,children:null,bt:s.bt,active:""}),this.link=this.Ct(this.$t),this.Et=s.St?this.Ct(s.St):this.link,this.Rt=this.yt.router.Ot.get(IObserverLocator),this.kt=this.Rt.Ht(0,this.yt.router,"activeComponents"),this.kt.subscribe(this)}get jt(){return this.children&&this.children.length?"nav-has-children":""}Pt(){this.active=this.link&&this.link.length?this.Vt():"nav-active"===this.active?"nav-active":this.Nt()?"nav-active-child":""}Vt(){const t=this.Et.split(this.yt.router.At.add),s=this.yt.router.xt;for(const component of t)if(0>component.indexOf(this.yt.router.At.viewport)){if(0>s.findIndex(value=>value.replace(/\@[^=]*/,"")===component))return""}else if(0>s.indexOf(component))return"";return"nav-active"}Tt(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}Ct(t){return Array.isArray(t)?t.map(value=>this.It(value)).join(this.yt.router.At.qt):this.It(t)}Nt(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.Nt())return 1;return 0}It(component){return component?"string"==typeof component?component:component.description?component.description.name:component.component?this.It(component.component)+(component.viewport?`@${component.viewport}`:""):void 0:""}}class o{constructor(router,name){this.router=router,this.name=name,this.zt=[]}Dt(t){for(const s of t)this.Lt(this.zt,s)}Lt(t,s){const i=new r(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.Lt(i.children,t)}}}t("Nav",o);class l{constructor(t,s){this.pt=t,this.names=s}}t("HandlerEntry",l);class c{constructor(t,s){this.Ut=t,this.Jt=s}}t("RouteGenerator",c);class a{constructor(){this.Bt=0,this.Ft=0,this.Gt=0}}t("TypesRecord",a);class u{constructor(t,s,i){this.pt=t,this._t=s,this.Qt=i}}t("RecognizeResult",u);class f{constructor(t,s,i){this.Mt=t,this.Wt=s,this.repeat=i}Kt(t){return this.Wt===t.Wt&&this.Mt===t.Mt}}t("CharSpec",f);class State{constructor(t){this.Xt=t,this.Yt=[]}put(t){let s=this.Yt.find(s=>s.Xt.Kt(t));return void 0===s&&(s=new State(t),this.Yt.push(s),t.repeat&&s.Yt.push(s)),s}}t("State",State);const p=/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g;class d{constructor(t,s){this.name=t,this.Zt=t,this.ts=s,this.optional=0}ss(t){const s=this.Zt,i=s.length;let h=0,e="";if(this.ts)for(;i>h;++h)e=s.charAt(h),t(new f(null,e,0));else for(;i>h;++h)e=s.charAt(h),t(new f(null,e.toUpperCase()+e.toLowerCase(),0))}hs(){return this.Zt.replace(p,"\\$1")}es(t,s){return this.Zt}}t("StaticSegment",d);class w{constructor(name,optional){this.name=name,this.optional=optional}ss(t){t(new f("/",null,1))}hs(){return"([^/]+)"}es(t,s){return s[this.name]=1,t[this.name]}}t("DynamicSegment",w);class v{constructor(name){this.name=name,this.optional=0}ss(t){t(new f("",null,1))}hs(){return"(.+)"}es(t,s){return s[this.name]=1,t[this.name]}}t("StarSegment",v);class m{ss(t){}hs(){return""}es(t,s){return""}}var g;t("EpsilonSegment",m),t("RouteRecognizer",class{constructor(){this.ns=new State,this.names={},this.zt=new Map}add(t){if(Array.isArray(t))return void t.forEach(t=>{this.add(t)});let s=this.ns;const i=[];let h="^";const e=new a,n=[],r=t.pt.name;let o=1,u=t.path;"/"===u.charAt(0)&&(u=u.slice(1));const p=[],g=u.split("/");let y,$;for(let r=0,l=g.length;l>r;++r){let l=(y=g[r]).match(/^:([^?]+)(\?)?$/);if(l){const[,name,optional]=l;if(-1!==name.indexOf("="))throw Error(`Parameter ${name} in route ${t} has a default value, which is not supported.`);p.push($=new w(name,!!optional)),n.push(name),e.Ft++}else if(l=y.match(/^\*(.+)$/))p.push($=new v(l[1])),n.push(l[1]),e.Gt++;else{if(""===y){p.push(new m);continue}p.push($=new d(y,t.ts)),e.Bt++}const c=s.put(new f(null,"/",0));let a=c;$.ss(t=>{a=a.put(t)});for(let t=0,s=i.length;s>t;t++)i[t].Yt.push(c);$.optional?(i.push(a),h+=`(?:/${$.hs()})?`):(s=a,h+=`/${$.hs()}`,i.length=0,o=0)}o&&(s=s.put(new f(null,"/",0)),h+="/?");const b=[new l(t.pt,n)];if(this.zt.set(t.pt,new c(p,b)),r){const t=Array.isArray(r)?r:[r];for(let s=0;t.length>s;s++)t[s]in this.names||(this.names[t[s]]=new c(p,b))}for(let s=0;i.length>s;s++){const n=i[s];n.Jt=b,n.hs=RegExp(`${h}$`,t.ts?"":"i"),n.types=e}return s.Jt=b,s.hs=RegExp(`${h}$`,t.ts?"":"i"),s.types=e,s}rs(t){return"string"==typeof t?this.names[t]:this.zt.get(t)}os(t){const s=this.rs(t);if(!s)throw Error(`There is no route named ${t}`);return[...s.Jt]}ls(t){return!!this.rs(t)}es(t,s){const i=this.rs(t);if(!i)throw Error(`There is no route named ${t}`);const h=i.Jt[0].pt;if(h.cs)return h.href;const e=Object.assign({},s),n=i.Ut,r={};let o="";for(let s=0,i=n.length;i>s;s++){const i=n[s];if(i instanceof m)continue;const h=i.es(e,r);if(null==h){if(!i.optional)throw Error(`A value is required for route parameter '${i.name}' in route '${t}'.`)}else o+="/",o+=h}"/"!==o.charAt(0)&&(o=`/${o}`);for(const t in r)Reflect.deleteProperty(e,t);const l=buildQueryString(e);return o+(l?`?${l}`:"")}as(t){let s=[this.ns],i={},h=0,e=t;const n=e.indexOf("?");if(-1!==n){const t=e.slice(n+1);e=e.slice(0,n),i=parseQueryString(t)}"/"!==(e=decodeURI(e)).charAt(0)&&(e=`/${e}`);let r=e.length;r>1&&"/"===e.charAt(r-1)&&(e=e.slice(0,-1),h=1,--r);for(let t=0;r>t;++t){const i=[],h=e.charAt(t);if(s.forEach(t=>{t.Yt.forEach(t=>{null!==t.Xt.Wt?-1!==t.Xt.Wt.indexOf(h)&&i.push(t):null!==t.Xt.Mt&&-1===t.Xt.Mt.indexOf(h)&&i.push(t)})}),0===(s=i).length)break}const o=[];for(let t=0,i=s.length;i>t;t++)s[t].Jt&&o.push(s[t]);o.sort((t,s)=>{if(t.types.Gt!==s.types.Gt)return t.types.Gt-s.types.Gt;if(t.types.Gt){if(t.types.Bt!==s.types.Bt)return s.types.Bt-t.types.Bt;if(t.types.Ft!==s.types.Ft)return s.types.Ft-t.types.Ft}return t.types.Ft!==s.types.Ft?t.types.Ft-s.types.Ft:t.types.Bt!==s.types.Bt?s.types.Bt-t.types.Bt:0});const l=o[0];if(l&&l.Jt){h&&"(.+)$"===l.hs.source.slice(-5)&&(e=`${e}/`);const t=e.match(l.hs);let s=1;const n=[];return n.us=i,l.Jt.forEach(i=>{const h={};i.names.forEach(name=>{h[name]=t[s++]}),n.push(new u(i.pt,h,i.names.length>0))}),n}}}),(function(t){t[t.fs=0]="none",t[t.loaded=1]="loaded",t[t.ps=2]="initialized",t[t.ds=3]="entered",t[t.ws=4]="added"})(g||(g={}));class y{constructor(t=null,s=null,i=null,h=null){this.content=t,this.i=s,this.vs=i,this.component=null,this.ms=0,this.gs=0,null!==this.content&&"string"==typeof this.content&&null!==h&&(this.content=this.ys(h))}$s(t){return"string"==typeof t.content&&this.bs()!==t.content||"string"!=typeof t.content&&this.content!==t.content||this.i!==t.i||!this.vs||this.vs.st!==t.vs.st}Cs(t){return("string"==typeof t.content&&this.bs()===t.content||"string"!=typeof t.content&&this.content===t.content)&&this.i===t.i}loadComponent(t,s){return this.gs||(this.component=this.Es(t),this.component.Ss(0,t,s)),this.ms=1,Promise.resolve()}Rs(){1===this.ms&&(this.ms=0)}Os(){this.gs||this.component.ks(2560,null),this.ms=2}Hs(t=0){2===this.ms&&(t||this.component.js(5120),this.ms=1)}addComponent(t){if(this.component.Ps(512),this.gs){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)if(t.hasAttribute("au-element-scroll")){const[s,i]=t.getAttribute("au-element-scroll").split(",");t.removeAttribute("au-element-scroll"),t.scrollTo(+i,+s)}}this.ms=4}Vs(t,s=0){if(4===this.ms){if(s){const s=Array.from(t.getElementsByTagName("*"));for(const t of s)(t.scrollTop>0||t.scrollLeft)&&t.setAttribute("au-element-scroll",`${t.scrollTop},${t.scrollLeft}`)}this.component.Ns(1024),this.ms=4}}async As(t,s=0){switch(this.ms){case 4:this.Vs(t,s);case 3:this.component.xs&&await this.component.xs(),this.ms=2;case 2:this.Hs(s);case 1:this.Rs()}this.ms=0}bs(){return null===this.content?null:"string"==typeof this.content?this.content:this.content.description.name}ys(t){if(null===this.content)return null;if("string"!=typeof this.content)return this.content;{const s=t.get(IContainer),i=s.Ts(CustomElementResource.Is(this.content));return null!==i?i.zs(s).qs:null}}Es(t){if(null===this.content)return null;const component=this.bs();return t.get(IContainer).get("string"!=typeof component?component:CustomElementResource.Is(component))}}class ${constructor(router,name,t,s,i,h,e){this.router=router,this.name=name,this.Ds=t,this.context=s,this.Ls=i,this.scope=h,this.options=e,this.clear=0,this.content=new y,this.Us=null,this.Js=null,this.Bs=null,this.cache=[],this.enabled=1}Fs(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.At.clear)this.clear=1,t=null;else{const s=t.split(this.router.At.i);t=s.shift(),i=s.length?s.join(this.router.At.i):null}if(this.Us=new y(t,i,s,this.context),this.options.Gs){const t=this.cache.find(t=>this.Us.Cs(t));t?(this.Us=t,this.Us.gs=1):this.cache.push(this.Us)}return this.content.$s(this.Us)||s.F}_s(t,s,i){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.Ds&&(this.scope.Ds=t),this.Ds!==t&&(this.Bs=Object.assign({},this),this.Qs(),this.Ds=t,i&&i.Ms&&(this.options.Ms=i.Ms),i&&i.default&&(this.options.default=i.default),i&&i.Ws&&(this.options.Ws=i.Ws),i&&i.Ks&&(this.options.Ks=i.Ks),i&&i.Gs&&(this.options.Gs=i.Gs),this.Js&&this.Js()),this.context!==s&&(this.context=s),this.content.component||this.Us&&this.Us.component||!this.options.default||this.router.Xs(this.options.default,this)}remove(t,s){return this.Ds===t&&this.context===s?(this.content.component&&this.content.As(this.Ds,this.options.Gs).catch(t=>{throw t}),1):0}async Ys(){if(!this.content.component)return 1;const component=this.content.component;return component.Ys?(Reporter.write(1e4,"viewport canLeave",component.Ys(this.content.vs,this.Us.vs)),component.Ys(this.content.vs,this.Us.vs)):1}async Zs(){if(this.clear)return 1;if(!this.Us.content)return 0;if(await this.ti(),await this.Us.loadComponent(this.context,this.Ds),!this.Us.component)return 0;const component=this.Us.component;if(!component.Zs)return 1;const t=component.Zs(this.Us.vs,this.content.vs);return Reporter.write(1e4,"viewport canEnter",t),"boolean"==typeof t?t:"string"==typeof t?[{component:t,viewport:this}]:t}async si(){if(Reporter.write(1e4,"Viewport enter",this.name),this.clear)return 1;if(!this.Us.component)return 0;if(this.Us.component.si){const t=(function(t,i,h){const e=s(i),n=s(t),r=Object.assign({},e.i,n.i),o=[...e.list,...n.list];if(o.length&&h&&h.length)for(const t of h)r[t]=o.shift();let l;return o.length&&Object.keys(r).length&&(r["ii"]=o.splice(0,o.length)),{hi:r,ei:o,ni:l=o.length?o:r}})(this.Us.i,this.Us.vs.st,this.Us.content.i);this.Us.vs.i=t.hi,this.Us.vs.ei=t.ei,await this.Us.component.si(t.ni,this.Us.vs,this.content.vs),this.Us.ms=3}return this.Us.Os(),1}async ri(){return Reporter.write(1e4,"Viewport loadContent",this.name),this.content.component&&(this.content.component.xs&&await this.content.component.xs(this.content.vs,this.Us.vs),this.Us.component||(this.content.Vs(this.Ds,this.options.Gs),this.content.Hs(this.options.Gs),this.content.Rs())),this.Us.component&&(this.content.component&&(this.content.Vs(this.Ds,this.options.Gs),this.content.Hs(this.options.Gs),this.content.Rs()),this.Us.addComponent(this.Ds),this.content=this.Us),this.clear&&(this.content=new y(null,null,this.Us.vs)),this.Us=null,1}oi(){this.Bs=null}async li(){await this.Us.As(this.Ds,this.options.Gs),this.Bs&&Object.assign(this,this.Bs)}description(t=0){if(this.content.content){const component=this.content.bs(),s=this.scope?this.router.At.ci:"",i=this.content.i?this.router.At.i+this.content.i:"";if(t||s.length||this.options.ai)return`${component}${this.router.At.viewport}${this.name}${s}${i}`;const h={};return h[component]=component,this.Ls.ui(h)?`${component}${i}`:`${component}${this.router.At.viewport}${this.name}${s}${i}`}}fi(t=0){return[this.Ls.pi(t),this.description(t)].filter(value=>value&&value.length).join(this.router.At.scope)}di(component){let t=this.options.Ms||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}wi(component){if("-"===component||null===component)return 1;let t=this.options.Ms;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}vi(t){this.content.component&&this.content.Os()}mi(t){Reporter.write(1e4,"ATTACHING viewport",this.name,this.content,this.Us),this.enabled=1,this.content.component&&this.content.addComponent(this.Ds)}gi(t){Reporter.write(1e4,"DETACHING viewport",this.name),this.content.component&&this.content.Vs(this.Ds,this.options.Gs),this.enabled=0}yi(t){this.content.component&&this.content.Hs(this.options.Gs)}Qs(){this.options={},this.content=new y,this.cache=[]}async ti(){return this.Ds?Promise.resolve():new Promise(t=>{this.Js=t})}}t("Viewport",$);class Scope{constructor(router,t,s,i){this.router=router,this.Ds=t,this.context=s,this.parent=i,this.viewport=null,this.children=[],this.$i=[],this.bi={},this.Ci=null,this.parent&&this.parent.Ei(this)}Si(){return this.$i.filter(t=>t.enabled).reduce((t,s)=>(t[s.name]=s,t),{})}ui(t){const s=[];let i=0;t&&(this.Ci={},this.bi={}),this.Ci=Object.assign({},this.Si(),this.Ci);for(const s in t){const parts=s.split(this.router.At.scope),t=parts.shift();this.bi[t]||(this.bi[t]=[]),this.bi[t].push(parts)}for(const h in this.bi){const e=h.split(this.router.At.i),component=e.shift().split(this.router.At.viewport).shift(),n=component+(e.length?this.router.At.i+e.join(this.router.At.i):"");for(const name in this.Ci){const e=this.Ci[name];if(e&&e.di(component)){const r=this.Ri(t,this.bi,h,n,e);s.push(...r.Oi),i=i||r.ki,this.Ci[name]=null,Reflect.deleteProperty(this.bi,h);break}}}for(const h in this.bi){const e=h.split(this.router.At.i),parts=e.shift().split(this.router.At.viewport),component=parts.shift(),n=component+(e.length?this.router.At.i+e.join(this.router.At.i):"");let name=parts.shift();if(!name||!name.length||name.startsWith("?"))continue;let r=0;name.endsWith(this.router.At.ci)&&(r=1,name=name.substring(0,name.length-1)),this.Si()[name]||(this.Hi(name,null,null,{scope:r,ai:1}),this.Ci[name]=this.Si()[name]);const o=this.Ci[name];if(o&&o.wi(component)){const e=this.Ri(t,this.bi,h,n,o);s.push(...e.Oi),i=i||e.ki,this.Ci[name]=null,Reflect.deleteProperty(this.bi,h)}}for(const h in this.bi){const e=h.split(this.router.At.i),component=e.shift().split(this.router.At.viewport).shift(),n=component+(e.length?this.router.At.i+e.join(this.router.At.i):""),r=[];for(const name in this.Ci){const t=this.Ci[name];t&&t.wi(component)&&r.push(t)}if(1===r.length){const e=r.shift(),o=this.Ri(t,this.bi,h,n,e);s.push(...o.Oi),i=i||o.ki,this.Ci[e.name]=null,Reflect.deleteProperty(this.bi,h);break}}if(i=i||Object.keys(this.bi).length>0,!t)for(const t of this.children){const h=t.ui();s.push(...h.Oi),i=i||h.ki}return{Oi:s,ki:i}}Ri(t,s,i,component,h){const e=[{component,viewport:h}];let n=0;if(s[i].length){const r=h.scope||h.Ls;for(const h of s[i])if(h.length){const s=h.join(this.router.At.scope),o={};o[s]=t[i+this.router.At.scope+s];const l=r.ui(o);e.push(...l.Oi),n=n||l.ki}}return{Oi:e,ki:n}}Hi(name,t,s,i){let h=this.Si()[name];if(t&&h&&null!==h.Ds&&h.Ds!==t&&(h.enabled=0,(h=this.$i.find(s=>s.name===name&&s.Ds===t))&&(h.enabled=1)),!h){let e;i.scope&&(e=new Scope(this.router,t,s,this),this.router.ji.push(e)),h=new $(this.router,name,null,null,this,e,i),this.$i.push(h)}return(t||s)&&h._s(t,s,i),h}Pi(t,s,i){return(!s&&!i||t.remove(s,i))&&(t.scope&&this.router.Vi(t.scope),this.$i.splice(this.$i.indexOf(t),1)),Object.keys(this.$i).length}Vi(){for(const t of this.children)t.Vi();const t=this.Si();for(const name in t)this.router.Pi(t[name],null,null)}Ni(t){return t.Zs().then(()=>t.ri())}Ei(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}Ai(t=0,s=0){const i=[];for(const h in this.Si()){const e=this.Si()[h];(e.options.Ks||e.options.Ws&&!t)&&!s||i.push(e.fi(t))}for(const s of this.children)i.push(...s.Ai(t));return i.filter(value=>value&&value.length)}xi(){const t=this.$i.filter(t=>t.enabled);for(const s of this.children)t.push(...s.xi());return t}pi(t=0){if(!this.Ds||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent.Ti(this.context.get(IContainer).parent);for(;i&&i.Ls===this.parent;)s.unshift(i.description(t)),i=this.Ti(i.context.get(IContainer).parent);return s.unshift(this.parent.pi(t)),s.filter(value=>value&&value.length).join(this.router.At.scope)}Ti(t){const s=Object.values(this.Si());for(;t;){const i=s.find(s=>s.context.get(IContainer)===t);if(i)return i;t=t.parent}return null}}t("Scope",Scope);class b{constructor(t){this.Ot=t,this.ji=[],this.Ii={},this.xt=[],this.qi=[],this.u=0,this.zi=0,this.Di=[],this.Li=null,this.Ui=null,this.Ji=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substring(1)),!s.startsWith("/")){const i=this.Bi(t.anchor).pi();i&&(s=`/${i}${this.At.scope}${s}`)}this.Fi.at(s)}),this.Fi=new e,this.Gi=new n}get _i(){return null!==this.Li}m(t){if(this.u)throw Reporter.error(2001);return this.u=1,this.options=Object.assign({v:t=>{this.Qi(t)}},t),this.At=Object.assign({viewport:"@",qt:"+",scope:"/",ci:"!",i:"=",add:"+",clear:"-",action:"."},this.options.At),this.Gi.m({v:this.Ji}),this.Fi.m(this.options).catch(t=>{throw t})}C(){if(!this.u)throw Reporter.error(2e3);this.Gi.C(),this.Fi.C()}Qi(t){this.Di.push(t),this.Mi().catch(t=>{throw t})}async Mi(){if(null!==this.Li||!this.Di.length)return Promise.resolve();const t=this.Di.shift();if(this.Li=t,this.options.Wi&&this.options.Wi(t),t.J)return this.Li=null,this.Mi();let i=0,h=0;(t.Y||t.X)&&t.tt&&(t.path=t.tt,h=1);let e=t.path;this.options.Ki&&!h&&(e=this.options.Ki(e,this),Array.isArray(e)&&(e=this.Xi(e))),(e===this.At.clear||e.startsWith(this.At.clear+this.At.add))&&(i=1,e.startsWith(this.At.clear)&&(e=e.substring(1)));const n=s(t.st);t.i=n.i,t.ei=n.list;const r=this.Yi(e);if(!r&&!Object.keys(r).length&&!i)return this.Li=null,this.Mi();const o=i?this.xi().filter(value=>null!==value.content.component):[],l=this.xi().filter(value=>value.options.default&&null===value.content.component),c=[];let{Oi:a,ki:u}=this.Zi.ui(r),f=100;for(;a.length||u||l.length;){if(!f--)throw Reporter.error(2002);const s=[];for(const i of a){const{component,viewport:h}=i;h.Fs(component,t)&&s.push(h);const e=o.findIndex(value=>value===h);0>e||o.splice(e,1);const n=l.findIndex(value=>value===h);0>n||l.splice(n,1)}for(const i of o)i.Fs(this.At.clear,t)&&s.push(i);let i;for(;i=l.shift();)i.Fs(i.options.default,t)&&s.push(i);if(!s.length&&this.zi){const i=this.th([...s,...c],t);return this.zi=0,await this.Mi(),i}let h=await Promise.all(s.map(value=>value.Ys()));if(h.findIndex(value=>0==value)>=0)return this.th([...s,...c],t);if((h=await Promise.all(s.map(async value=>{const t=await value.Zs();if("boolean"==typeof t)return t?value.si():0;for(const s of t)this.Xs(s.component,s.viewport);return value.li().catch(t=>{throw t}),1}))).some(t=>0==t))return this.th([...s,...c],t);for(const t of s)c.find(value=>value===t)||c.push(t);const e=this.Zi.ui();let n;for(a=[];n=this.qi.shift();)e.Oi.find(value=>value.viewport===n.viewport)||a.push(n);a=[...a,...e.Oi],u=e.ki}await Promise.all(c.map(value=>value.ri())),await this.sh(t),t.Z||t.ih||!c.every(t=>t.options.Ks)||await this.Fi.pop(),c.forEach(t=>{t.oi()}),this.Ui=this.Li,this.Ui.ih&&(this.Ui.ih=0),this.Li=null,this.Mi().catch(t=>{throw t})}Xs(component,t){this.Li?("string"==typeof t&&(t=this.xi().find(s=>s.name===t)),this.qi.push({viewport:t,component})):this.Ui&&(this.Di.unshift({path:"",tt:"",ih:1}),this.Mi().catch(t=>{throw t}))}Yi(t){const s={};t.startsWith("/")&&(t=t.substring(1));const i=t.split(this.At.qt);let h=0;for(;i.length;){const t=i.shift().split(this.At.scope),parts=t.pop().split(this.At.viewport),component=parts[0];t.push(parts.length?parts.join(this.At.viewport):`?${h++}`);const name=t.join(this.At.scope);component&&(s[name]=component)}return s}hh(t){return this.eh(),this.Bi(t)}Hi(name,t,s,i){return Reporter.write(1e4,"Viewport added",name,t),this.hh(t).Hi(name,t,s,i)}Pi(t,s,i){const h=t.Ls;h.Pi(t,s,i)||this.Vi(h)}xi(){return this.eh(),this.Zi.xi()}Vi(t){if(t!==this.Zi){t.Vi();const s=this.ji.indexOf(t);0>s||this.ji.splice(s,1)}}rt(t,s,i){if("string"==typeof t)return this.Fi.rt(t,s,i)}replace(t,s,i){if("string"==typeof t)return this.Fi.replace(t,s,i)}refresh(){return this.Fi.refresh()}back(){return this.Fi.back()}forward(){return this.Fi.forward()}Xi(t){const s=[];for(const i of t){let t=i.component;if(i.viewport&&(t+=this.At.viewport+i.viewport),i.i)for(const s in i.i)t+=this.At.i+i.i[s];s.push(t)}return s.join(this.At.qt)}nh(t){const s=[],i=t.split(this.At.qt);for(const t of i){let component,i,h;const[e,n]=t.split(this.At.viewport);void 0===n?[component,h]=e.split(this.At.i):(component=e,[i,h]=n.split(this.At.i));const r={component};i&&(r.viewport=i),h&&(r.i={id:h}),s.push(r)}return s}rh(name,t){const s=this.oh(name);s&&(s.zt=[]),this.lh(name,t)}lh(name,t){let s=this.Ii[name];s||(s=this.Ii[name]=new o(this,name)),s.Dt(t)}oh(name){return this.Ii[name]}async th(t,s){t.forEach(t=>{t.li().catch(t=>{throw t})}),s.T?await this.Fi.pop():await this.Fi.cancel(),this.Li=null,this.Mi().catch(t=>{throw t})}eh(){if(!this.Zi){const t=this.Ot.get(Aurelia).root();this.Zi=new Scope(this,t.ah,t.$context,null),this.ji.push(this.Zi)}}Bi(t){let s=(function(t){for(;t&&!t.$customElement;)t=t.parentElement;return t})(t).$customElement.$context.get(IContainer);for(;s;){const t=this.ji.find(t=>t.context.get(IContainer)===s);if(t)return t;s=s.parent}}uh(t){let s=t.slice().sort((t,s)=>s.split(this.At.scope).length-t.split(this.At.scope).length),i=[];if((s=s.map(value=>`${this.At.scope}${value}${this.At.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.At.scope).length-s.split(this.At.scope).length),i}sh(t){this.xt=this.Zi.Ai(1,1),this.xt=this.uh(this.xt);let s=this.Zi.Ai(),i=(s=this.uh(s)).join(this.At.qt);this.options.fh&&(i=this.options.fh(this.nh(i),this));let h=this.Zi.Ai(1);(h=this.uh(h)).unshift(this.At.clear);const e=t.st&&t.st.length?`?${t.st}`:"";return this.Fi.ct(i+e,h.join(this.At.qt)+e,t)}}t("Router",b),b.inject=[IContainer];class C{constructor(router,t,s){this.router=router,this.Ds=t,this.ph=s,this.name="default",this.scope=null,this.Ms=null,this.default=null,this.Ws=null,this.Ks=null,this.Gs=null,this.viewport=null}dh(t,host,parts,s){const i=this.constructor,dom=s.get(IDOM),template=this.ph.wh(dom,i.description,s,i);template.vh=createRenderContext(dom,s,i.description.dependencies,i),template.dh(this,host,parts)}bound(){this.connect()}mh(){this.disconnect()}connect(){const t={scope:this.Ds.hasAttribute("scope")};this.Ms&&this.Ms.length&&(t.Ms=this.Ms),this.default&&this.default.length&&(t.default=this.default),this.Ds.hasAttribute("no-link")&&(t.Ws=1),this.Ds.hasAttribute("no-history")&&(t.Ks=1),this.Ds.hasAttribute("stateful")&&(t.Gs=1),this.viewport=this.router.Hi(this.name,this.Ds,this.$context,t)}disconnect(){this.router.Pi(this.viewport,this.Ds,this.$context)}vi(t){this.viewport&&this.viewport.vi(t)}mi(t){this.viewport&&this.viewport.mi(t)}gi(t){this.viewport&&this.viewport.gi(t)}yi(t){this.viewport&&this.viewport.yi(t)}}t("ViewportCustomElement",C),C.inject=[b,INode,IRenderingEngine],i([bindable],C.prototype,"name",void 0),i([bindable],C.prototype,"scope",void 0),i([bindable],C.prototype,"usedBy",void 0),i([bindable],C.prototype,"default",void 0),i([bindable],C.prototype,"noLink",void 0),i([bindable],C.prototype,"noHistory",void 0),i([bindable],C.prototype,"stateful",void 0),CustomElementResource.gh({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> </div></template>'},C);let E=t("NavCustomElement",class{constructor(router){this.router=router,this.name=null,this.zt=null,this.level=0}get yh(){const t=this.router.oh(this.name);return t?t.zt:[]}active(t){return"Active"}});i([bindable],E.prototype,"name",void 0),i([bindable],E.prototype,"routes",void 0),i([bindable],E.prototype,"level",void 0),E=t("NavCustomElement",i([inject(b,Element),customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],E))}}});
