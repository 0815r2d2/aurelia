this.au=this.au||{},this.au.router=(function(t,runtime,kernel){"use strict";function s(t){const s={},i=[];if(!t||!t.length)return{t:s,list:i};const h=t.replace("+"," ").split("&");for(const t of h){const h=t.split("="),e=decodeURIComponent(h.shift());if(!h.length){i.push(e);continue}const value=decodeURIComponent(h.shift());s[e]=value}return{t:s,list:i}}function i(t,s,i,h){var e,n,o=arguments.length,r=3>o?s:null===h?h=Object.getOwnPropertyDescriptor(s,i):h;if("object"==typeof Reflect&&"function"==typeof Reflect.s)r=Reflect.s(t,s,i,h);else for(n=t.length-1;n>=0;n--)(e=t[n])&&(r=(3>o?e(r):o>3?e(s,i,r):e(s,i))||r);return o>3&&r&&Object.defineProperty(s,i,r),r}class h{constructor(){this.i=null,this.h=0,this.o=0,this.l=0,this.u=0,this.m=(()=>{const t=this.p(),s=this.v(),i={};let h=this.$("HistoryEntry");if(this.i&&this.i.path===t){i.P=1;const t=this.l?this.O.index:this.history.length-this.j;this.O=this.i,this.O.index=t,this.l?(this.k=0,this.S[this.O.index]=this.O,this.o?(i.V=1,this.o=0):this.u?(i.H=1,this.u=0):i.C=1,this.l=0):(this.k=1,this.S=this.S.slice(0,this.O.index),this.S.push(this.O)),this.N({A:this.S,J:this.j,D:this.O})}else this.S=this.S||this.$("HistoryEntries")||[],this.j=this.j||this.$("HistoryOffset")||0,h||this.O?h?this.O?h.index>this.O.index?i._=1:this.O.index>h.index&&(i.I=1):i.H=1:i.P=1:(i.P=1,i.L=1,this.j=this.history.length),h||(this.S=this.S.slice(0,(h={path:t,T:null,index:this.history.length-this.j,U:s}).index),this.S.push(h),this.N({A:this.S,J:this.j,D:h})),this.k=this.O?h.index-this.O.index:0,this.O=h,this.o&&(i.V=1,this.o=0);this.i=null,this.g&&this.g--,this.q(this.O,i)}),this.location=window.location,this.history=window.history}G(t){if(this.h)throw Error("History has already been activated.");return this.h=1,this.options=Object.assign({},t),window.addEventListener("popstate",this.m),Promise.resolve().then(()=>{this.K(this.p(),1)})}X(){window.removeEventListener("popstate",this.m),this.h=0}Y(t,s,i){this.i={path:t,T:null,title:s,data:i},this.K(t)}replace(t,s,i){this.l=1,this.i={path:t,T:null,title:s,data:i},this.K(t,1)}Z(t,s,i){this.g=this.k+1,this.replace(t,s,i)}refresh(){this.O&&(this.u=1,this.replace(this.O.path,this.O.title,this.O.data))}back(){this.history.go(-1)}forward(){this.history.go(1)}cancel(){this.o=1;const t=this.k||this.g;t?this.history.go(-t):this.replace(this.B.path,this.B.title,this.B.data)}N(t,value){const{pathname:s,search:i,hash:h}=this.location;let e=Object.assign({},this.history.state);"string"==typeof t?e[t]=JSON.parse(JSON.stringify(value)):e=Object.assign({},e,JSON.parse(JSON.stringify(t))),this.history.replaceState(e,null,`${s}${i}${h}`)}$(t){return Object.assign({},this.history.state)[t]}R(t){this.O.title=t,this.S[this.O.index]=this.O,this.N({A:this.S,D:this.O})}W(t,s,i){if(i.index!==this.O.index)return;const h=`#/${t}`,{pathname:e,search:n,hash:o}=this.location;if(h===o)return;this.O.path=t,this.O.T=s;const r=Object.assign({},this.history.state,{D:this.O,A:this.S});this.history.replaceState(r,null,`${e}${n}${h}`)}M(t){t.startsWith("#")||(t=`#${t}`),this.location.hash=t}get F(){return this.S?this.S.slice(0,this.O.index+1).map(value=>value.title):[]}p(){return this.location.hash.substr(1).split("?")[0]}K(t,s=0){if(this.O&&this.O.path===t&&!this.u)return;const{pathname:i,search:h}=this.location,e=`#${t}`;s?(this.B=this.O,this.history.replaceState({},null,`${i}${h}${e}`)):this.history.pushState({},null,`${i}${h}${e}`),this.m()}v(){const t=this.location.hash.substr(1).split("?");return t.shift(),t.length>0?t.shift():""}q(t,s){const i=Object.assign({},t,s);this.options.q&&this.options.q(i)}}class e{constructor(){this.h=0,this.tt=(t=>{const s=e.st(t);s.it&&(t.preventDefault(),this.options.q(s))}),this.document=document}static st(t){const s={it:0,href:null,anchor:null},i=e.ht(t.target);if(!i||!e.et(i))return s;if(i.hasAttribute("external"))return s;if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return s;const h=i.getAttribute("href");return s.anchor=i,s.href=h,s.it=1===t.which,s}static ht(t){for(;t;){if("A"===t.tagName)return t;t=t.parentNode}}static et(t){const s=t.getAttribute("target");return!s||s===e.window.name||"_self"===s}G(t){if(this.h)throw Error("LinkHandler has already been activated.");this.h=1,this.options=Object.assign({},t),this.document.addEventListener("click",this.tt,1)}X(){this.document.removeEventListener("click",this.tt),this.h=0}}class n{constructor(t,s){this.active="",this.nt=t,Object.assign(this,{ot:s.ot,title:s.title,rt:s.rt,active:""}),this.link=this.lt(),this.ct=this.nt.router.at.get(runtime.IObserverLocator),this.ut=this.ct.ft(this.nt.router,"activeComponents"),this.ut.subscribe(this)}get dt(){return this.children&&this.children.length?"nav-has-children":""}pt(){this.active=this.link&&this.link.length?this.bt():"nav-active"===this.active?"nav-active":this.vt()?"nav-active-child":""}bt(){const t=this.link.split(this.nt.router.wt.add),s=this.nt.router.$t;for(let component of t)if(0>component.indexOf(this.nt.router.wt.viewport)){if(component+=this.nt.router.wt.viewport,0>s.findIndex(value=>value.startsWith(component)))return""}else if(0>s.indexOf(component))return"";return"nav-active"}Pt(){this.active=this.active.startsWith("nav-active")?"":"nav-active"}lt(){return Array.isArray(this.ot)?this.ot.map(value=>this.Ot(value)).join(this.nt.router.wt.jt):this.Ot(this.ot)}vt(){if(this.children)for(const t of this.children)if(t.active.startsWith("nav-active")||t.vt())return 1;return 0}Ot(component){return component?"string"==typeof component?component:component.description?component.description.name:component.component?this.Ot(component.component)+(component.viewport?`@${component.viewport}`:""):void 0:""}}class o{constructor(router,name){this.kt=[],this.router=router,this.name=name}St(t){for(const s of t)this.Vt(this.kt,s)}Vt(t,s){const i=new n(this,s);if(t.push(i),s.children){i.children=[];for(const t of s.children)this.Vt(i.children,t)}}}class r{constructor(router,name,t,s,i,h){this.router=router,this.name=name,this.Ht=t,this.Ct=s,this.scope=i,this.options=h,this.clear=0,this.content=null,this.Nt=null,this.t=null,this.At=null,this.Jt=null,this.Dt=null,this.component=null,this._t=null,this.It=null}Lt(t,s){let i;if(this.clear=0,"string"==typeof t)if(t===this.router.wt.clear)this.clear=1,t=null;else{const s=t.split(this.router.wt.t);t=s.shift(),i=s.length?s.join(this.router.wt.t):null;const h=this.router.at.Tt(runtime.CustomElementResource.Ut(t));null!==h&&(t=h.qt(this.router.at).gt)}return this.Nt=t,this.Dt=s,this.At=i,this.content!==t||this.t!==i||!this.Jt||this.Jt.U!==s.U||s.H?1:0}yt(t,s){this.scope&&this.scope.parent&&!this.scope.viewport&&(this.scope.viewport=this),this.scope&&!this.scope.Ht&&(this.scope.Ht=t),this.Ht||(this.Ht=t,s&&s.zt&&(this.options.zt=s.zt),this.It&&this.It())}Gt(){if(!this.component)return Promise.resolve(1);const component=this.component;if(!component.Gt)return Promise.resolve(1);const t=component.Gt(this.Jt,this.Dt);return"boolean"==typeof t?Promise.resolve(t):t}Kt(){if(this.clear)return Promise.resolve(1);if(!this.Nt)return Promise.resolve(0);if(this.loadComponent(this.Nt),!this._t)return Promise.resolve(0);const component=this._t;if(!component.Kt)return Promise.resolve(1);const t=component.Kt(this.Dt,this.Jt);return"boolean"==typeof t?Promise.resolve(t):t}async Qt(){if(this.component&&(this.component.Xt&&await this.component.Xt(this.Jt,this.Dt),this._t||this.Yt(this.component)),this._t){if(this._t.Zt){const t=(function(t,i,h){const e=s(i),n=s(t),o=Object.assign({},e.t,n.t),r=[...e.list,...n.list];if(r.length&&h&&h.length)for(const t of h)o[t]=r.shift();let l;return r.length&&Object.keys(o).length&&(o["Bt"]=r.splice(0,r.length)),{t:o,list:r,Rt:l=r.length?r:o}})(this.At,this.Dt.U,this.Nt.t);this.Dt.t=t.t,this.Dt.Wt=t.list,await this._t.Zt(t.Rt,this.Dt,this.Jt)}if(!this.Ht&&(await this.Mt(),!this.Ht))return Promise.resolve(0);this.component&&this.Yt(this.component),this.Et(this._t),this.content=this.Nt,this.t=this.At,this.Jt=this.Dt,this.component=this._t}return this.clear&&(this.content=this.t=this.component=null,this.Jt=this.Dt),this.Nt=this.At=this.Dt=this._t=null,Promise.resolve(1)}description(t=0){if(this.content){const component=this.content.description.name,s=this.scope?this.router.wt.Ft:"",i=this.t?this.router.wt.t+this.t:"";if(t||s.length||this.options.xt)return`${component}${this.router.wt.viewport}${this.name}${s}${i}`;const h={};return h[component]=component,this.Ct.ts(h)?`${component}${i}`:`${component}${this.router.wt.viewport}${this.name}${s}${i}`}}ss(t=0){return[this.Ct.context(t),this.description(t)].filter(value=>value&&value.length).join(this.router.wt.scope)}hs(component){let t=this.options.zt||[];return"string"==typeof t&&(t=t.split(",")),t.indexOf(component)>=0}es(component){if("-"===component||null===component)return 1;let t=this.options.zt;return t&&t.length?("string"==typeof t&&(t=t.split(",")),0>t.indexOf(component)?t.filter(value=>value.indexOf("*")>=0).length?1:0:1):1}ns(t){this.component&&this.component.os(t)}rs(t){this.component&&this.component.ls(t)}cs(t){this.component&&this.component.as(t)}us(t){this.component&&this.component.fs(t)}loadComponent(component){this._t=this.router.at.get(runtime.CustomElementResource.Ut(component.description.name))}Et(component){const host=this.Ht,t=this.router.at,dom=t.get(runtime.IDOM),s=t.get(runtime.IProjectorLocator),i=t.get(runtime.IRenderingEngine);component.ds(dom,s,i,host,null),component.os(runtime.LifecycleFlags.ms|runtime.LifecycleFlags.ps,null),component.ls(runtime.LifecycleFlags.ms)}Yt(component){component.as(runtime.LifecycleFlags.bs),component.fs(runtime.LifecycleFlags.bs|runtime.LifecycleFlags.vs)}async Mt(){return this.Ht?Promise.resolve():new Promise(t=>{this.It=t})}}class Scope{constructor(router,t,s){this.children=[],this.ws={},this.$s={},this.router=router,this.Ht=t,this.parent=s,this.viewport=null,this.children=[],this.ws={},this.$s={},this.Ps=null,this.parent&&this.parent.Os(this)}ts(t){const s=[];let i=0;t&&(this.Ps={},this.$s={}),this.Ps=Object.assign({},this.ws,this.Ps);for(const s in t){const parts=s.split(this.router.wt.scope),t=parts.shift();this.$s[t]||(this.$s[t]=[]),this.$s[t].push(parts)}for(const h in this.$s){const e=h.split(this.router.wt.t),component=e.shift().split(this.router.wt.viewport).shift(),n=component+(e.length?this.router.wt.t+e.join(this.router.wt.t):"");for(const name in this.Ps){const e=this.Ps[name];if(e&&e.hs(component)){const o=this.js(t,this.$s,h,n,e);s.push(...o.ks),i=i||o.Ss,this.Ps[name]=null,delete this.$s[h];break}}}for(const h in this.$s){const e=h.split(this.router.wt.t),parts=e.shift().split(this.router.wt.viewport),component=parts.shift(),n=component+(e.length?this.router.wt.t+e.join(this.router.wt.t):"");let name=parts.shift();if(!name||!name.length||name.startsWith("?"))continue;let o=0;name.endsWith(this.router.wt.Ft)&&(o=1,name=name.substr(0,name.length-1)),this.ws[name]||(this.Vs(name,null,{scope:o,xt:1}),this.Ps[name]=this.ws[name]);const r=this.Ps[name];if(r&&r.es(component)){const e=this.js(t,this.$s,h,n,r);s.push(...e.ks),i=i||e.Ss,this.Ps[name]=null,delete this.$s[h]}}for(const h in this.$s){const e=h.split(this.router.wt.t),component=e.shift().split(this.router.wt.viewport).shift(),n=component+(e.length?this.router.wt.t+e.join(this.router.wt.t):""),o=[];for(const name in this.Ps){const t=this.Ps[name];t&&t.es(component)&&o.push(t)}if(1===o.length){const e=o.shift(),r=this.js(t,this.$s,h,n,e);s.push(...r.ks),i=i||r.Ss,this.Ps[e.name]=null,delete this.$s[h];break}}if(i=i||Object.keys(this.$s).length>0,!t)for(const t of this.children){const h=t.ts();s.push(...h.ks),i=i||h.Ss}return{ks:s,Ss:i}}js(t,s,i,component,h){const e=[{component,viewport:h}];let n=0;if(s[i].length){const o=h.scope||h.Ct;for(const h of s[i])if(h.length){const s=h.join(this.router.wt.scope),r={};r[s]=t[i+this.router.wt.scope+s];const l=o.ts(r);e.push(...l.ks),n=n||l.Ss}}return{ks:e,Ss:n}}Vs(name,t,s){let i=this.ws[name];if(!i){let h;s.scope&&(h=new Scope(this.router,t,this),this.router.Hs.push(h)),i=this.ws[name]=new r(this.router,name,t,this,h,s)}return t&&i.yt(t,s),i}Cs(t){return t.scope&&this.router.Ns(t.scope),delete this.ws[t.name],Object.keys(this.ws).length}Ns(){for(const t of this.children)t.Ns();for(const t in this.ws)this.router.Cs(this.ws[t])}As(t){return t.Kt().then(()=>t.Qt())}Os(t){0>this.children.indexOf(t)&&this.children.push(t)}removeChild(t){this.children.splice(this.children.indexOf(t),1)}Js(t=0){const s=[];for(const i in this.ws)s.push(this.ws[i].ss(t));for(const i of this.children)s.push(...i.Js(t));return s.filter(value=>value&&value.length)}Ds(){const t=[];for(const s in this.ws)t.push(this.ws[s]);for(const s of this.children)t.push(...s.Ds());return t}context(t=0){if(!this.Ht||!this.parent)return"";const s=[];this.viewport&&s.unshift(this.viewport.description(t));let i=this.parent._s(this.Ht.parentElement);for(;i&&i.Ct===this.parent;)s.unshift(i.description(t)),i=this._s(i.Ht.parentElement);return s.unshift(this.parent.context(t)),s.filter(value=>value&&value.length).join(this.router.wt.scope)}Is(component){if("string"==typeof component){const t=this.router.at.Tt(runtime.CustomElementResource.Ut(component));null!==t&&(component=t.qt(this.router.at).gt)}return component}_s(t){let s,i=Number.MAX_SAFE_INTEGER;for(const h in this.ws){const e=this.ws[h].Ht;let n=t,o=0;for(;n&&n!==e;)o++,n=n.parentElement;i>o&&(i=o,s=this.ws[h])}return s}}class l{constructor(t){this.at=t,this.kt=[],this.ws={},this.Hs=[],this.Ls={},this.$t=[],this.h=0,this.Ts=0,this.Us=[],this.gs=null,this.qs=(t=>{let s=t.href;if(s.startsWith("#")&&(s=s.substr(1)),!s.startsWith("/")){const i=this.ys(t.anchor).context();i&&(s=`/${i}${this.wt.scope}${s}`)}this.zs.M(s)}),this.zs=new h,this.Gs=new e}G(t){if(this.h)throw Error("Router has already been activated.");return this.h=1,this.options=Object.assign({q:t=>{this.Ks(t)}},t),this.wt=Object.assign({viewport:"@",jt:"+",scope:"/",Ft:"!",t:"=",add:"+",clear:"-",action:"."},this.options.wt),this.Gs.G({q:this.qs}),this.zs.G(this.options).catch(t=>{throw t})}X(){if(!this.h)throw Error("Router has not been activated.");this.Gs.X(),this.zs.X()}Ks(t){this.Us.push(t),this.Qs().catch(t=>{throw t})}async Qs(){if(null!==this.gs||!this.Us.length)return Promise.resolve();const t=this.Us.shift();if(this.gs=t,this.options.Xs&&this.options.Xs(t),t.V)return this.gs=null,Promise.resolve();let i=0;(t.I||t._)&&t.T&&(t.path=t.T);const h=t.path;(h===this.wt.clear||h.startsWith(this.wt.clear+this.wt.add))&&(i=1,h.startsWith(this.wt.clear)&&(t.path=h.substr(1)));const e=s(t.U);let n,o;t.t=e.t,t.Wt=e.list;let r=this.Ys(t);if(r){if(r.Z)return r=this.Zs(r,t.data),this.Ts=1,this.zs.Z(r.path,r.title,t.data),this.gs=null,Promise.resolve();r.title&&(n=r.title),o=r.ws}else o=this.Bs(t);if(!o&&!Object.keys(o).length&&!i)return this.gs=null,Promise.resolve();n&&this.zs.R(n);const l=i?this.Rs.Ds().filter(value=>null!==value.component):[];let{ks:c,Ss:a}=this.Rs.ts(o),u=100;for(;(c.length||a)&&u--;){const s=[];for(const i of c){const{component,viewport:h}=i;h.Lt(component,t)&&s.push(h);const e=l.findIndex(value=>value===h);0>e||l.splice(e,1)}for(const i of l)i.Lt(this.wt.clear,t)&&s.push(i);!s.length&&this.Ts&&(this.zs.cancel(),this.Ts=0);let i=await Promise.all(s.map(value=>value.Gt()));if(i.findIndex(value=>0==value)>=0)return this.zs.cancel(),this.gs=null,Promise.resolve();if((i=await Promise.all(s.map(value=>value.Kt()))).findIndex(value=>0==value)>=0)return this.zs.cancel(),this.gs=null,Promise.resolve();await Promise.all(s.map(value=>value.Qt()));const h=this.Rs.ts();c=h.ks,a=h.Ss}this.Ws(t),this.gs=null,this.Us.length&&this.Qs().catch(t=>{throw t})}Ys(t){return this.kt.find(value=>value.path===t.path)}Zs(t,s){for(;t.Z;){const i=this.Ys({path:t.Z,T:null,data:s});if(!i)break;t=i}return t}Bs(t){const s={};let i=t.path;i.startsWith("/")&&(i=i.substr(1));const h=i.split(this.wt.jt);let e=0;for(;h.length;){const t=h.shift().split(this.wt.scope),parts=t.pop().split(this.wt.viewport),component=parts[0];t.push(parts.length?parts.join(this.wt.viewport):`?${e++}`);const name=t.join(this.wt.scope);component&&(s[name]=component)}return s}Ms(t){if(!this.Rs){const t=this.at.get(runtime.Aurelia).root().Es;this.Rs=new Scope(this,t,null),this.Hs.push(this.Rs)}return this.ys(t)}Vs(name,t,s){return this.Ms(t).Vs(name,t,s)}Cs(t){const s=t.Ct;s.Cs(t)||this.Ns(s)}Ns(t){if(t!==this.Rs){t.Ns();const s=this.Hs.indexOf(t);0>s||this.Hs.splice(s,1)}}Vt(t){this.kt.push(t)}Y(t,s,i){"string"==typeof t&&this.zs.Y(t,s,i)}replace(t,s,i){"string"==typeof t&&this.zs.replace(t,s,i)}refresh(){this.zs.refresh()}back(){this.zs.back()}forward(){this.zs.forward()}Fs(name,t){let s=this.Ls[name];s||(s=this.Ls[name]=new o(this,name)),s.St(t)}xs(name){return this.Ls[name]}ys(t){let s,i=Number.MAX_SAFE_INTEGER;for(const h of this.Hs){let e=t,n=0;for(;e&&e!==h.Ht;)n++,e=e.parentElement;i>n&&(i=n,s=h)}return s}ti(t){let s=t.slice().sort((t,s)=>s.split(this.wt.scope).length-t.split(this.wt.scope).length),i=[];if((s=s.map(value=>`${this.wt.scope}${value}${this.wt.scope}`)).length)for(i.push(s.shift());s.length;){const t=s.shift();i.find(value=>-1===value.indexOf(t))&&i.push(t)}return(i=i.map(value=>value.substring(1,value.length-1))).sort((t,s)=>t.split(this.wt.scope).length-s.split(this.wt.scope).length),i}Ws(t){let s=this.Rs.Js();s=this.ti(s);let i=this.Rs.Js(1);i=this.ti(i),this.$t=i,i.unshift(this.wt.clear);const h=t.U&&t.U.length?`?${t.U}`:"";this.zs.W(s.join(this.wt.jt)+h,i.join(this.wt.jt)+h,t)}}l.inject=[kernel.IContainer];class c{constructor(router,t){this.router=router,this.Ht=t,this.name="default",this.scope=null,this.zt=null,this.viewport=null}si(){const t={scope:this.Ht.hasAttribute("scope")};this.zt&&this.zt.length&&(t.zt=this.zt),this.viewport=this.router.Vs(this.name,this.Ht,t)}ii(){this.router.Cs(this.viewport)}ns(t){this.viewport&&this.viewport.ns(t)}rs(t){this.viewport&&this.viewport.rs(t)}cs(t){this.viewport&&this.viewport.cs(t)}us(t){this.viewport&&this.viewport.us(t)}}return c.inject=[l,runtime.INode],i([runtime.bindable],c.prototype,"name",void 0),i([runtime.bindable],c.prototype,"scope",void 0),i([runtime.bindable],c.prototype,"usedBy",void 0),runtime.CustomElementResource.hi({name:"au-viewport",template:'<template><div class="viewport-header"> Viewport: <b>${name}</b> </div></template>'},c),t.ei=class{constructor(router){this.router=router,this.name=null,this.kt=null,this.level=0}get ni(){const t=this.router.xs(this.name);return t?t.kt:[]}active(t){return"Active"}},i([runtime.bindable],t.ei.prototype,"name",void 0),i([runtime.bindable],t.ei.prototype,"routes",void 0),i([runtime.bindable],t.ei.prototype,"level",void 0),t.ei=i([kernel.inject(l,Element),runtime.customElement({name:"au-nav",template:'<template>\n  <nav if.bind="name" class="${name}">\n    <au-nav routes.bind="navRoutes" containerless></au-nav>\n  </nav>\n  <ul if.bind="routes" class="nav-level-${level}">\n    <li repeat.for="route of routes" class="${route.active} ${route.hasChildren}">\n      <a if.bind="route.link && route.link.length" href="${route.link}">${route.title}</a>\n      <a if.bind="!route.link || !route.link.length" click.delegate="route.toggleActive()" href="">${route.title}</a>\n      <au-nav if.bind="route.children" routes.bind="route.children" level.bind="level + 1" containerless></au-nav>\n    </li>\n  </ul>\n</template>'})],t.ei),t.oi=h,t.ri=e,t.li=o,t.ci=l,t.Scope=Scope,t.ai=r,t.ui=c,t})({},runtime,kernel);
