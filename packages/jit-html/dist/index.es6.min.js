function processInterpolationText(e){const t=e.t,n=t.parentNode;for(;null!==t.nextSibling&&3===t.nextSibling.nodeType;)n.removeChild(t.nextSibling);t.textContent="",n.insertBefore(e.marker,t)}function processTemplateControllers(dom,e,t){const n=t.t;let i,r=e;for(;r!==t;)r.template===t?(n.parentNode.replaceChild(r.marker,n),"TEMPLATE"===n.nodeName?(r.t=n,n.remove()):(i=r.t=dom.i()).content.appendChild(n)):(i=r.t=dom.i()).content.appendChild(r.marker),n.removeAttribute(r.l.o),r=r.template}function processReplacePart(dom,e,t){let n,i;"TEMPLATE"===(n=512&t.flags?t.marker:t.t).nodeName?e.t=n:(i=e.t=dom.i()).content.appendChild(n)}function parseMultiAttributeBinding(e){const t=[],n=new ParserState(e),i=n.length;let name,value;for(;i>n.index;){if(0===(name=scanAttributeName(n)).length)return t;value=scanAttributeValue(n),t.push({name,value})}return t}function scanAttributeName(e){const t=e.index,{length:n,input:i}=e;for(;n>e.index&&58!==i.charCodeAt(++e.index););return i.slice(t,e.index).trim()}function scanAttributeValue(e){++e.index;const{length:t,input:n}=e;let i="",r=0;for(;t>e.index;){switch(r=n.charCodeAt(e.index)){case 59:return++e.index,i.trim();case 47:r=n.charCodeAt(++e.index),i+=`\\${fromCharCode(r)}`;break;case 39:i+="'";break;default:i+=fromCharCode(r)}++e.index}return i.trim()}function stringifyDOM(e,t){let n=" ".repeat(t);if(n+=`Node: ${e.nodeName}`,3===e.nodeType&&(n+=` "${e.textContent}"`),1===e.nodeType){let t,i=0;const r=e.attributes,o=r.length;for(;o>i;++i)n+=` ${(t=r[i]).name}=${t.value}`}if(n+="\n",1===e.nodeType){let i=0,childNodes=e.childNodes,r=childNodes.length;for(;r>i;++i)n+=stringifyDOM(childNodes[i],t+1);if("TEMPLATE"===e.nodeName)for(i=0,r=(childNodes=e.content.childNodes).length;r>i;++i)n+=stringifyDOM(childNodes[i],t+1)}return n}function stringifyInstructions(e,t){let n=" ".repeat(t);switch(e.type){case"ha":n+="textBinding\n";break;case"rh":n+="callBinding\n";break;case"rk":n+="iteratorBinding\n";break;case"hb":n+="listenerBinding\n";break;case"rg":n+="propertyBinding\n";break;case"rj":n+="refBinding\n";break;case"hc":n+="stylePropertyBinding\n";break;case"re":n+="setProperty\n";break;case"hd":n+="setAttribute\n";break;case"rf":n+="interpolation\n";break;case"rd":n+="hydrateLetElement\n",e.instructions.forEach(e=>{n+=stringifyInstructions(e,t+1)});break;case"rb":n+=`hydrateAttribute: ${e.res}\n`,e.instructions.forEach(e=>{n+=stringifyInstructions(e,t+1)});break;case"ra":n+=`hydrateElement: ${e.res}\n`,e.instructions.forEach(e=>{n+=stringifyInstructions(e,t+1)});break;case"rc":n+=`hydrateTemplateController: ${e.res}\n`,n+=stringifyTemplateDefinition(e.def,t+1),e.instructions.forEach(e=>{n+=stringifyInstructions(e,t+1)})}return n}function stringifyTemplateDefinition(def,e){const t=" ".repeat(e);let n=t;return n+=`TemplateDefinition: ${def.name}\n`,n+=stringifyDOM(def.template,e+1),n+=`${t} Instructions:\n`,def.instructions.forEach(i=>{n+=`${t}  Row:\n`,i.forEach(t=>{n+=stringifyInstructions(t,e+3)})}),n}import{getTarget,BindingCommandResource,PlainElementSymbol,CustomElementSymbol,LetElementSymbol,BindableInfo,BindingSymbol,TextSymbol,TemplateControllerSymbol,CustomAttributeSymbol,PlainAttributeSymbol,ReplacePartSymbol,ResourceModel,IAttributeParser,DefaultComponents,DefaultBindingSyntax,DefaultBindingLanguage}from"@aurelia/jit";import{TriggerBindingInstruction,DelegateBindingInstruction,CaptureBindingInstruction,TextBindingInstruction,SetAttributeInstruction,BasicConfiguration}from"@aurelia/runtime-html";import{Profiler,PLATFORM,DI,Registration}from"@aurelia/kernel";import{BindingMode,IDOM,ITemplateCompiler,LetBindingInstruction,LetElementInstruction,HydrateElementInstruction,HydrateTemplateController,SetPropertyInstruction,InterpolationInstruction,HydrateAttributeInstruction,RefBindingInstruction,IExpressionParser}from"@aurelia/runtime";class TriggerBindingCommand{constructor(){this.s=86}compile(e){return new TriggerBindingInstruction(e.u,getTarget(e,0))}}BindingCommandResource.m("trigger",TriggerBindingCommand);class DelegateBindingCommand{constructor(){this.s=88}compile(e){return new DelegateBindingInstruction(e.u,getTarget(e,0))}}BindingCommandResource.m("delegate",DelegateBindingCommand);class CaptureBindingCommand{constructor(){this.s=87}compile(e){return new CaptureBindingInstruction(e.u,getTarget(e,0))}}BindingCommandResource.m("capture",CaptureBindingCommand);const{h:enter,g:leave}=Profiler.C("TemplateBinder"),invalidSurrogateAttribute={id:1,T:1,B:1},attributesToIgnore={p:1,T:1,B:1};class TemplateBinder{constructor(dom,e,t,n){this.dom=dom,this.I=e,this.A=t,this.D=n,this.L=null,this.manifest=null,this.M=null,this.$=null,this.R=null}bind(e){const t=this.L,n=this.$,i=this.M,r=this.manifest,o=this.L=this.manifest=new PlainElementSymbol(e),l=e.attributes;let s=0;for(;l.length>s;){const e=l[s],t=this.A.parse(e.name,e.value);if(1==invalidSurrogateAttribute[t.target])throw Error(`Invalid surrogate attribute: ${t.target}`);const n=this.I.k(t);if(null===n)this.P(t);else{if(n.isTemplateController)throw Error("Cannot have template controller on surrogate element.");this.F(t,n)}++s}return this.O(e),this.L=t,this.$=n,this.M=i,this.manifest=r,o}S(e,t){switch(t.nodeName){case"LET":return void this.v(e,t);case"SLOT":return void(this.L.hasSlots=1)}const n=this.$,i=this.M,r=this.manifest;let o;this.R=t.getAttribute("part");let name=t.getAttribute("as-element");null===name&&(name=t.nodeName.toLowerCase());const l=this.I.H(name);null===l?this.manifest=new PlainElementSymbol(t):(this.$=this.M,o=this.M=this.manifest=new CustomElementSymbol(this.dom,t,l)),this.O(t),this.q(t,e),void 0!==o&&o.G?t.parentNode.replaceChild(o.marker,t):this.manifest.J&&t.classList.add("au"),this.$=n,this.M=i,this.manifest=r}v(e,t){const n=new LetElementSymbol(this.dom,t);e.childNodes.push(n);const i=t.attributes;let r=0;for(;i.length>r;){const e=i[r];if("to-view-model"===e.name){t.removeAttribute("to-view-model"),n.toViewModel=1;continue}const o=this.A.parse(e.name,e.value),l=this.I.K(o),s=this.D.parse(o.U,null===l?2048:l.s),to=PLATFORM.W(o.target),a=new BindableInfo(to,BindingMode.X);n.Y.push(new BindingSymbol(l,a,s,o.U,to)),++r}t.parentNode.replaceChild(n.marker,t)}q(e,t){const{$:n,M:i,manifest:r}=this;let o=r;const l=this.Z(e);let s,a;const u=e.attributes;let m=0;for(;u.length>m;){const e=u[m];if(++m,1==attributesToIgnore[e.name])continue;const t=this.A.parse(e.name,e.value),n=this.I.k(t);null===n?this.P(t):n.isTemplateController?(a=r.templateController=this._(t,n),o===r?(a.template=r,o=a):(a.templateController=s,a.template=s.template,s.template=a),s=a):this.F(t,n)}processTemplateControllers(this.dom,o,r),null===l?t.childNodes.push(o):(l.parent=t,l.template=o,(r===i?n:i).parts.push(l),processReplacePart(this.dom,l,o))}O(e){let t,n;for(t="TEMPLATE"===e.nodeName?e.content.firstChild:e.firstChild;null!==t;)switch(t.nodeType){case 1:n=t.nextSibling,this.S(this.manifest,t),t=n;break;case 3:t=this.N(t).nextSibling;break;case 4:case 7:case 8:case 10:t=t.nextSibling;break;case 9:case 11:t=t.firstChild}}N(e){const t=this.D.parse(e.wholeText,2048);if(null!==t){const n=new TextSymbol(this.dom,e,t);this.manifest.childNodes.push(n),processInterpolationText(n)}for(;null!==e.nextSibling&&3===e.nextSibling.nodeType;)e=e.nextSibling;return e}_(e,t){let n;const i=this.I.K(e);if(null===i&&t.V)n=new TemplateControllerSymbol(this.dom,e,t,this.R),this.R=null,this.j(n,t,e.U);else{n=new TemplateControllerSymbol(this.dom,e,t,this.R);const r=this.D.parse(e.U,null===i?2048:i.s);n.Y.push(new BindingSymbol(i,t.bindable,r,e.U,e.target)),this.R=null}return n}F(e,t){const n=this.I.K(e);let i;if(null===n&&t.V)i=new CustomAttributeSymbol(e,t),this.j(i,t,e.U);else{i=new CustomAttributeSymbol(e,t);const r=this.D.parse(e.U,null===n?2048:n.s);i.Y.push(new BindingSymbol(n,t.bindable,r,e.U,e.target))}this.manifest.attributes.push(i),this.manifest.J=1}j(e,t,value){const n=parseMultiAttributeBinding(value);let i;for(let r=0,o=n.length;o>r;++r){const o=this.A.parse((i=n[r]).name,i.value),l=this.I.K(o),s=this.D.parse(o.U,null===l?2048:l.s);let bindable=t.bindables[o.target];void 0===bindable&&(bindable=t.bindables[o.target]=new BindableInfo(o.target,BindingMode.X)),e.Y.push(new BindingSymbol(l,bindable,s,o.U,o.target))}}P(e){if(0===e.U.length)return;const t=this.I.K(e),n=this.manifest,i=this.D.parse(e.U,null===t?2048:t.s);if(16&n.flags){const bindable=n.bindables[e.target];void 0!==bindable?(n.Y.push(new BindingSymbol(t,bindable,i,e.U,e.target)),n.J=1):null===i&&"ref"!==e.target||(n.attributes.push(new PlainAttributeSymbol(e,t,i)),n.J=1)}else null!==i||"ref"===e.target?(n.attributes.push(new PlainAttributeSymbol(e,t,i)),n.J=1):n===this.L&&n.attributes.push(new PlainAttributeSymbol(e,t,i))}Z(e){const name=e.getAttribute("replace-part");return null===name?null:(e.removeAttribute("replace-part"),new ReplacePartSymbol(name))}}class ParserState{constructor(e){this.input=e,this.index=0,this.length=e.length}}const fromCharCode=String.fromCharCode;var Char;(function(e){e[e.ee=34]="DoubleQuote",e[e.te=39]="SingleQuote",e[e.ne=47]="Slash",e[e.ie=59]="Semicolon",e[e.re=58]="Colon"})(Char||(Char={}));const ITemplateElementFactory=DI.le("ITemplateElementFactory").oe(),{h:enter$1,g:leave$1}=Profiler.C("TemplateElementFactory");class HTMLTemplateElementFactory{constructor(dom){this.dom=dom,this.template=dom.i()}static register(e){return Registration.singleton(ITemplateElementFactory,this).register(e)}i(e){if("string"==typeof e){const template=this.template;template.innerHTML=e;const t=template.content.firstElementChild;return null===t||"TEMPLATE"!==t.nodeName||null!==t.nextElementSibling?(this.template=this.dom.i(),template):(template.content.removeChild(t),t)}if("TEMPLATE"!==e.nodeName){const template=this.dom.i();return template.content.appendChild(e),template}return null!==e.parentNode&&e.parentNode.removeChild(e),e}}HTMLTemplateElementFactory.inject=[IDOM];const buildNotRequired=Object.freeze({required:0,compiler:"default"}),{h:enter$2,g:leave$2}=Profiler.C("TemplateCompiler");class TemplateCompiler{constructor(e,t,n){this.se=e,this.A=t,this.D=n,this.ae=null}get name(){return"default"}static register(e){return Registration.singleton(ITemplateCompiler,this).register(e)}compile(dom,e,t){const n=new TemplateBinder(dom,new ResourceModel(t),this.A,this.D),template=e.template=this.se.i(e.template),i=n.bind(template);void 0!==e.instructions&&e.instructions!==PLATFORM.ue||(e.instructions=[]),1==i.hasSlots&&(e.hasSlots=1),this.ae=e.instructions;const r=i.attributes,o=r.length;if(o>0){let surrogates;void 0!==e.surrogates&&e.surrogates!==PLATFORM.ue||(e.surrogates=Array(o)),surrogates=e.surrogates;for(let e=0;o>e;++e)surrogates[e]=this.me(r[e])}return this.ce(i),this.ae=null,e}ce(e){if(8192&e.flags){const{childNodes}=e;let t;const n=childNodes.length;for(let e=0;n>e;++e)if(128&(t=childNodes[e]).flags)this.ae.push([new TextBindingInstruction(t.he)]);else if(32&t.flags){const e=t.Y,instructions=[];let n;const i=e.length;for(let t=0;i>t;++t)instructions[t]=new LetBindingInstruction((n=e[t]).u,n.target);this.ae.push([new LetElementInstruction(instructions,t.toViewModel)])}else this.ge(t)}}de(e){const t=this.fe(e,1);t[0]=new HydrateElementInstruction(e.res,this.Ce(e),this.Te(e)),this.ae.push(t)}Be(e){const t=this.fe(e,0);t.length>0&&this.ae.push(t),this.ce(e)}ge(e){switch(511&e.flags){case 16:this.de(e);break;case 64:this.Be(e);break;case 1:this.pe(e)}}pe(e){const t=this.Ce(e),n=this.ae,i=this.ae=[];this.ge(e.template),this.ae=n,this.ae.push([new HydrateTemplateController({name:null===e.R?e.res:e.R,template:e.t,instructions:i,build:buildNotRequired},e.res,t,"else"===e.res)])}Ce(e){let t;if(4096&e.flags){const{Y:n}=e,i=n.length;t=Array(i);let r=0;for(;i>r;++r)t[r]=this.Ee(n[r])}else t=PLATFORM.ue;return t}Ee(e){return null===e.command?null===e.u?new SetPropertyInstruction(e.U,e.bindable.Ie):new InterpolationInstruction(e.u,e.bindable.Ie):e.command.compile(e)}fe(e,t){let n;if(2048&e.flags){const{attributes:i}=e,r=i.length;n=Array(t+r);for(let e=0;r>e;++e)n[e+t]=this.me(i[e])}else n=t>0?Array(t):PLATFORM.ue;return n}ye(e){const t=this.Ce(e);return new HydrateAttributeInstruction(e.res,t)}Ae(e){return null===e.command?null===e.u?new SetAttributeInstruction(e.l.U,e.l.target):new InterpolationInstruction(e.u,e.l.target):e.command.compile(e)}me(e){return"ref"===e.l.target?new RefBindingInstruction(e.l.U):4&e.flags?this.ye(e):this.Ae(e)}Te(e){let parts;if(16384&e.flags){parts={};const t=e.parts,n=t.length;let i,r,o;for(let e=0;n>e;++e)o=t[e],i=this.ae,r=this.ae=[],this.ge(o.template),parts[o.name]={name:o.name,template:o.t,instructions:r,build:buildNotRequired},this.ae=i}else parts=PLATFORM.De;return parts}}TemplateCompiler.inject=[ITemplateElementFactory,IAttributeParser,IExpressionParser];const ITemplateCompilerRegistration=TemplateCompiler,ITemplateElementFactoryRegistration=HTMLTemplateElementFactory,DefaultComponents$1=[TemplateCompiler,HTMLTemplateElementFactory],TriggerBindingCommandRegistration=TriggerBindingCommand,DelegateBindingCommandRegistration=DelegateBindingCommand,CaptureBindingCommandRegistration=CaptureBindingCommand,DefaultBindingLanguage$1=[TriggerBindingCommand,DelegateBindingCommand,CaptureBindingCommand],BasicConfiguration$1={register:e=>BasicConfiguration.register(e).register(...DefaultComponents,...DefaultBindingSyntax,...DefaultBindingLanguage,...DefaultComponents$1,...DefaultBindingLanguage$1),Le(){return this.register(DI.Le())}};export{TriggerBindingCommand,DelegateBindingCommand,CaptureBindingCommand,ITemplateCompilerRegistration,ITemplateElementFactoryRegistration,DefaultComponents$1 as DefaultComponents,TriggerBindingCommandRegistration,DelegateBindingCommandRegistration,CaptureBindingCommandRegistration,DefaultBindingLanguage$1 as DefaultBindingLanguage,BasicConfiguration$1 as BasicConfiguration,stringifyDOM,stringifyInstructions,stringifyTemplateDefinition,TemplateBinder,ITemplateElementFactory};
