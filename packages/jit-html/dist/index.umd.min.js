(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@aurelia/jit"),require("@aurelia/runtime-html"),require("@aurelia/kernel"),require("@aurelia/runtime")):"function"==typeof define&&define.amd?define(["exports","@aurelia/jit","@aurelia/runtime-html","@aurelia/kernel","@aurelia/runtime"],e):e((t=t||self).jitHtml={},t.jit,t.runtimeHtml,t.kernel,t.runtime)})(this,function(t,jit,runtimeHtml,kernel,runtime){"use strict";function e(t){const e=t.index,{length:i,input:n}=t;for(;i>t.index&&58!==n.charCodeAt(++t.index););return n.slice(e,t.index).trim()}function i(t){++t.index;const{length:e,input:i}=t;let n="",s=0;for(;e>t.index;){switch(s=i.charCodeAt(t.index)){case 59:return++t.index,n.trim();case 47:s=i.charCodeAt(++t.index),n+=`\\${l(s)}`;break;case 39:n+="'";break;default:n+=l(s)}++t.index}return n.trim()}function stringifyDOM(t,e){let i=" ".repeat(e);if(i+=`Node: ${t.nodeName}`,3===t.nodeType&&(i+=` "${t.textContent}"`),1===t.nodeType){let e,n=0;const s=t.attributes,r=s.length;for(;r>n;++n)i+=` ${(e=s[n]).name}=${e.value}`}if(i+="\n",1===t.nodeType){let n=0,childNodes=t.childNodes,s=childNodes.length;for(;s>n;++n)i+=stringifyDOM(childNodes[n],e+1);if("TEMPLATE"===t.nodeName)for(n=0,s=(childNodes=t.content.childNodes).length;s>n;++n)i+=stringifyDOM(childNodes[n],e+1)}return i}function stringifyInstructions(t,e){let i=" ".repeat(e);switch(t.type){case"ha":i+="textBinding\n";break;case"rh":i+="callBinding\n";break;case"rk":i+="iteratorBinding\n";break;case"hb":i+="listenerBinding\n";break;case"rg":i+="propertyBinding\n";break;case"rj":i+="refBinding\n";break;case"hc":i+="stylePropertyBinding\n";break;case"re":i+="setProperty\n";break;case"hd":i+="setAttribute\n";break;case"rf":i+="interpolation\n";break;case"rd":i+="hydrateLetElement\n",t.instructions.forEach(t=>{i+=stringifyInstructions(t,e+1)});break;case"rb":i+=`hydrateAttribute: ${t.res}\n`,t.instructions.forEach(t=>{i+=stringifyInstructions(t,e+1)});break;case"ra":i+=`hydrateElement: ${t.res}\n`,t.instructions.forEach(t=>{i+=stringifyInstructions(t,e+1)});break;case"rc":i+=`hydrateTemplateController: ${t.res}\n`,i+=stringifyTemplateDefinition(t.def,e+1),t.instructions.forEach(t=>{i+=stringifyInstructions(t,e+1)})}return i}function stringifyTemplateDefinition(def,t){const e=" ".repeat(t);let i=e;return i+=`TemplateDefinition: ${def.name}\n`,i+=stringifyDOM(def.template,t+1),i+=`${e} Instructions:\n`,def.instructions.forEach(n=>{i+=`${e}  Row:\n`,n.forEach(e=>{i+=stringifyInstructions(e,t+3)})}),i}class TriggerBindingCommand{constructor(){this.t=86}compile(t){return new runtimeHtml.TriggerBindingInstruction(t.i,jit.getTarget(t,0))}}jit.BindingCommandResource.s("trigger",TriggerBindingCommand);class DelegateBindingCommand{constructor(){this.t=88}compile(t){return new runtimeHtml.DelegateBindingInstruction(t.i,jit.getTarget(t,0))}}jit.BindingCommandResource.s("delegate",DelegateBindingCommand);class CaptureBindingCommand{constructor(){this.t=87}compile(t){return new runtimeHtml.CaptureBindingInstruction(t.i,jit.getTarget(t,0))}}jit.BindingCommandResource.s("capture",CaptureBindingCommand),kernel.Profiler.l("TemplateBinder");const n={id:1,o:1,h:1},s={u:1,o:1,h:1};class TemplateBinder{constructor(dom,t,e,i){this.dom=dom,this.m=t,this.p=e,this.g=i,this.T=null,this.manifest=null,this.k=null,this.A=null,this.v=null}bind(t){const e=this.T,i=this.A,s=this.k,r=this.manifest,l=this.T=this.manifest=new jit.PlainElementSymbol(t),o=t.attributes;let c=0;for(;o.length>c;){const t=o[c],e=this.p.parse(t.name,t.value);if(1==n[e.target])throw Error(`Invalid surrogate attribute: ${e.target}`);const i=this.m.P(e);if(null===i)this.C(e,t);else{if(i.isTemplateController)throw Error("Cannot have template controller on surrogate element.");this.$(e,i)}++c}return this.B(t),this.T=e,this.A=i,this.k=s,this.manifest=r,l}L(t,e){switch(e.nodeName){case"LET":return void this.M(t,e);case"SLOT":return void(this.T.hasSlots=1)}const i=this.A,n=this.k,s=this.manifest;let r;this.v=e.getAttribute("part");let name=e.getAttribute("as-element");null===name&&(name=e.nodeName.toLowerCase());const l=this.m.j(name);null===l?this.manifest=new jit.PlainElementSymbol(e):(this.A=this.k,r=this.k=this.manifest=new jit.CustomElementSymbol(this.dom,e,l)),this.B(e),this.q(e,t),void 0!==r&&r.N?e.parentNode.replaceChild(r.marker,e):this.manifest.S&&e.classList.add("au"),this.A=i,this.k=n,this.manifest=s}M(t,e){const i=new jit.LetElementSymbol(this.dom,e);t.childNodes.push(i);const n=e.attributes;let s=0;for(;n.length>s;){const t=n[s];if("to-view-model"===t.name){e.removeAttribute("to-view-model"),i.toViewModel=1;continue}const r=this.p.parse(t.name,t.value),l=this.m.R(r),o=this.g.parse(r.I,null===l?2048:l.t),to=kernel.PLATFORM.O(r.target),c=new jit.BindableInfo(to,runtime.BindingMode.D);i.F.push(new jit.BindingSymbol(l,c,o,r.I,to)),++s}e.parentNode.replaceChild(i.marker,e)}q(t,e){const{A:i,k:n,manifest:r}=this;let l=r;const o=this._(t);let c,h;const a=t.attributes;let u=0;for(;a.length>u;){const t=a[u];if(++u,1==s[t.name])continue;const e=this.p.parse(t.name,t.value),i=this.m.P(e);null===i?this.C(e,t):i.isTemplateController?(h=r.templateController=this.G(e,i),l===r?(h.template=r,l=h):(h.templateController=c,h.template=c.template,c.template=h),c=h):this.$(e,i)}(function(dom,t,e){const i=e.H;let n,s=t;for(;s!==e;)s.template===e?(i.parentNode.replaceChild(s.marker,i),"TEMPLATE"===i.nodeName?(s.H=i,i.remove()):(n=s.H=dom.J()).content.appendChild(i)):(n=s.H=dom.J()).content.appendChild(s.marker),i.removeAttribute(s.U.K),s=s.template})(this.dom,l,r),null===o?e.childNodes.push(l):(o.parent=e,o.template=l,(r===n?i:n).parts.push(o),(function(dom,t,e){let i,n;"TEMPLATE"===(i=512&e.flags?e.marker:e.H).nodeName?t.H=i:(n=t.H=dom.J()).content.appendChild(i)})(this.dom,o,l))}B(t){let e,i;for(e="TEMPLATE"===t.nodeName?t.content.firstChild:t.firstChild;null!==e;)switch(e.nodeType){case 1:i=e.nextSibling,this.L(this.manifest,e),e=i;break;case 3:e=this.V(e).nextSibling;break;case 4:case 7:case 8:case 10:e=e.nextSibling;break;case 9:case 11:e=e.firstChild}}V(t){const e=this.g.parse(t.wholeText,2048);if(null!==e){const i=new jit.TextSymbol(this.dom,t,e);this.manifest.childNodes.push(i),(function(t){const e=t.H,i=e.parentNode;for(;null!==e.nextSibling&&3===e.nextSibling.nodeType;)i.removeChild(e.nextSibling);e.textContent="",i.insertBefore(t.marker,e)})(i)}for(;null!==t.nextSibling&&3===t.nextSibling.nodeType;)t=t.nextSibling;return t}G(t,e){let i;const n=this.m.R(t);if(null===n&&e.W)i=new jit.TemplateControllerSymbol(this.dom,t,e,this.v),this.v=null,this.X(i,e,t.I);else{i=new jit.TemplateControllerSymbol(this.dom,t,e,this.v);const s=this.g.parse(t.I,null===n?2048:n.t);i.F.push(new jit.BindingSymbol(n,e.bindable,s,t.I,t.target)),this.v=null}return i}$(t,e){const i=this.m.R(t);let n;if(null===i&&e.W)n=new jit.CustomAttributeSymbol(t,e),this.X(n,e,t.I);else{n=new jit.CustomAttributeSymbol(t,e);const s=this.g.parse(t.I,null===i?2048:i.t);n.F.push(new jit.BindingSymbol(i,e.bindable,s,t.I,t.target))}this.manifest.attributes.push(n),this.manifest.S=1}X(t,n,value){const s=(function(t){const n=[],s=new r(t),l=s.length;let name,value;for(;l>s.index;){if(0===(name=e(s)).length)return n;value=i(s),n.push({name,value})}return n})(value);let l;for(let e=0,i=s.length;i>e;++e){const i=this.p.parse((l=s[e]).name,l.value),r=this.m.R(i),o=this.g.parse(i.I,null===r?2048:r.t);let bindable=n.bindables[i.target];void 0===bindable&&(bindable=n.bindables[i.target]=new jit.BindableInfo(i.target,runtime.BindingMode.D)),t.F.push(new jit.BindingSymbol(r,bindable,o,i.I,i.target))}}C(t,e){if(0===t.I.length)return;const i=this.m.R(t),n=this.manifest,s=this.g.parse(t.I,null===i?2048:i.t);if(16&n.flags){const bindable=n.bindables[t.target];void 0!==bindable?(n.F.push(new jit.BindingSymbol(i,bindable,s,t.I,t.target)),n.S=1):null===s&&"ref"!==t.target||(n.attributes.push(new jit.PlainAttributeSymbol(t,i,s)),n.S=1)}else null!==s||"ref"===t.target?(n.attributes.push(new jit.PlainAttributeSymbol(t,i,s)),n.S=1):n===this.T&&n.attributes.push(new jit.PlainAttributeSymbol(t,i,s));null===i&&null!==s&&(e.value="")}_(t){const name=t.getAttribute("replace-part");return null===name?null:(t.removeAttribute("replace-part"),new jit.ReplacePartSymbol(name))}}class r{constructor(t){this.input=t,this.index=0,this.length=t.length}}const l=String.fromCharCode;var o;(function(t){t[t.Y=34]="DoubleQuote",t[t.Z=39]="SingleQuote",t[t.tt=47]="Slash",t[t.et=59]="Semicolon",t[t.it=58]="Colon"})(o||(o={}));const ITemplateElementFactory=kernel.DI.st("ITemplateElementFactory").nt();kernel.Profiler.l("TemplateElementFactory");class c{constructor(dom){this.dom=dom,this.template=dom.J()}static register(t){return kernel.Registration.singleton(ITemplateElementFactory,this).register(t)}J(t){if("string"==typeof t){const template=this.template;template.innerHTML=t;const e=template.content.firstElementChild;return null===e||"TEMPLATE"!==e.nodeName||null!==e.nextElementSibling?(this.template=this.dom.J(),template):(template.content.removeChild(e),e)}if("TEMPLATE"!==t.nodeName){const template=this.dom.J();return template.content.appendChild(t),template}return null!==t.parentNode&&t.parentNode.removeChild(t),t}}c.inject=[runtime.IDOM];const h=Object.freeze({required:0,compiler:"default"});kernel.Profiler.l("TemplateCompiler");class a{constructor(t,e,i){this.rt=t,this.p=e,this.g=i,this.lt=null}get name(){return"default"}static register(t){return kernel.Registration.singleton(runtime.ITemplateCompiler,this).register(t)}compile(dom,t,e){const i=new TemplateBinder(dom,new jit.ResourceModel(e),this.p,this.g),template=t.template=this.rt.J(t.template),n=i.bind(template);void 0!==t.instructions&&t.instructions!==kernel.PLATFORM.ot||(t.instructions=[]),1==n.hasSlots&&(t.hasSlots=1),this.lt=t.instructions;const s=n.attributes,r=s.length;if(r>0){let surrogates;void 0!==t.surrogates&&t.surrogates!==kernel.PLATFORM.ot||(t.surrogates=Array(r)),surrogates=t.surrogates;for(let t=0;r>t;++t)surrogates[t]=this.ct(s[t])}return this.ht(n),this.lt=null,t}ht(t){if(8192&t.flags){const{childNodes}=t;let e;const i=childNodes.length;for(let t=0;i>t;++t)if(128&(e=childNodes[t]).flags)this.lt.push([new runtimeHtml.TextBindingInstruction(e.at)]);else if(32&e.flags){const t=e.F,instructions=[];let i;const n=t.length;for(let e=0;n>e;++e)instructions[e]=new runtime.LetBindingInstruction((i=t[e]).i,i.target);this.lt.push([new runtime.LetElementInstruction(instructions,e.toViewModel)])}else this.ut(e)}}ft(t){const e=this.dt(t,1);e[0]=new runtime.HydrateElementInstruction(t.res,this.pt(t),this.bt(t)),this.lt.push(e)}wt(t){const e=this.dt(t,0);e.length>0&&this.lt.push(e),this.ht(t)}ut(t){switch(511&t.flags){case 16:this.ft(t);break;case 64:this.wt(t);break;case 1:this.gt(t)}}gt(t){const e=this.pt(t),i=this.lt,n=this.lt=[];this.ut(t.template),this.lt=i,this.lt.push([new runtime.HydrateTemplateController({name:null===t.v?t.res:t.v,template:t.H,instructions:n,build:h},t.res,e,"else"===t.res)])}pt(t){let e;if(4096&t.flags){const{F:i}=t,n=i.length;e=Array(n);let s=0;for(;n>s;++s)e[s]=this.Tt(i[s])}else e=kernel.PLATFORM.ot;return e}Tt(t){return null===t.command?null===t.i?new runtime.SetPropertyInstruction(t.I,t.bindable.kt):new runtime.InterpolationInstruction(t.i,t.bindable.kt):t.command.compile(t)}dt(t,e){let i;if(2048&t.flags){const{attributes:n}=t,s=n.length;i=Array(e+s);for(let t=0;s>t;++t)i[t+e]=this.ct(n[t])}else i=e>0?Array(e):kernel.PLATFORM.ot;return i}Et(t){const e=this.pt(t);return new runtime.HydrateAttributeInstruction(t.res,e)}At(t){return null===t.command?null===t.i?new runtimeHtml.SetAttributeInstruction(t.U.I,t.U.target):new runtime.InterpolationInstruction(t.i,t.U.target):t.command.compile(t)}ct(t){return"ref"===t.U.target?new runtime.RefBindingInstruction(t.U.I):4&t.flags?this.Et(t):this.At(t)}bt(t){let parts;if(16384&t.flags){parts={};const e=t.parts,i=e.length;let n,s,r;for(let t=0;i>t;++t)r=e[t],n=this.lt,s=this.lt=[],this.ut(r.template),parts[r.name]={name:r.name,template:r.H,instructions:s,build:h},this.lt=n}else parts=kernel.PLATFORM.yt;return parts}}a.inject=[ITemplateElementFactory,jit.IAttributeParser,runtime.IExpressionParser];const ITemplateCompilerRegistration=a,ITemplateElementFactoryRegistration=c,DefaultComponents=[ITemplateCompilerRegistration,ITemplateElementFactoryRegistration],TriggerBindingCommandRegistration=TriggerBindingCommand,DelegateBindingCommandRegistration=DelegateBindingCommand,CaptureBindingCommandRegistration=CaptureBindingCommand,DefaultBindingLanguage=[TriggerBindingCommandRegistration,DelegateBindingCommandRegistration,CaptureBindingCommandRegistration],BasicConfiguration={register:t=>runtimeHtml.BasicConfiguration.register(t).register(...jit.DefaultComponents,...jit.DefaultBindingSyntax,...jit.DefaultBindingLanguage,...DefaultComponents,...DefaultBindingLanguage),vt(){return this.register(kernel.DI.vt())}};t.TriggerBindingCommand=TriggerBindingCommand,t.DelegateBindingCommand=DelegateBindingCommand,t.CaptureBindingCommand=CaptureBindingCommand,t.ITemplateCompilerRegistration=ITemplateCompilerRegistration,t.ITemplateElementFactoryRegistration=ITemplateElementFactoryRegistration,t.DefaultComponents=DefaultComponents,t.TriggerBindingCommandRegistration=TriggerBindingCommandRegistration,t.DelegateBindingCommandRegistration=DelegateBindingCommandRegistration,t.CaptureBindingCommandRegistration=CaptureBindingCommandRegistration,t.DefaultBindingLanguage=DefaultBindingLanguage,t.BasicConfiguration=BasicConfiguration,t.stringifyDOM=stringifyDOM,t.stringifyInstructions=stringifyInstructions,t.stringifyTemplateDefinition=stringifyTemplateDefinition,t.TemplateBinder=TemplateBinder,t.ITemplateElementFactory=ITemplateElementFactory,Object.defineProperty(t,"Pt",{value:1})});
